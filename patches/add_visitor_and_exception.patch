diff --git a/diagrams/cpp.dia b/diagrams/cpp.dia
index dbaba4d..e57b3b6 100644
--- a/diagrams/cpp.dia
+++ b/diagrams/cpp.dia
@@ -20487,7 +20487,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="341,-46"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="340.95,-46.05;385.825,-38.35"/>
+        <dia:rectangle val="340.95,-46.05;385.825,-37.55"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
         <dia:point val="341,-46"/>
@@ -20496,7 +20496,7 @@ main, or from another initialiser.#</dia:string>
         <dia:real val="44.774999999999999"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="7.5999999999999996"/>
+        <dia:real val="8.4000000000000004"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#registrar#</dia:string>
@@ -20669,7 +20669,7 @@ main, or from another initialiser.#</dia:string>
                 <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::object&gt;&gt;#</dia:string>
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::concept&gt;&gt;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -20717,7 +20717,7 @@ main, or from another initialiser.#</dia:string>
                 <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::concept&gt;&gt;#</dia:string>
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::primitive&gt;&gt;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -20765,7 +20765,7 @@ main, or from another initialiser.#</dia:string>
                 <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::exception&gt;&gt;#</dia:string>
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::enumeration&gt;&gt;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -20813,7 +20813,7 @@ main, or from another initialiser.#</dia:string>
                 <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::enumeration&gt;&gt;#</dia:string>
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::object&gt;&gt;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -20861,7 +20861,55 @@ main, or from another initialiser.#</dia:string>
                 <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::primitive&gt;&gt;#</dia:string>
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::exception&gt;&gt;#</dia:string>
+              </dia:attribute>
+              <dia:attribute name="value">
+                <dia:string>##</dia:string>
+              </dia:attribute>
+              <dia:attribute name="comment">
+                <dia:string>##</dia:string>
+              </dia:attribute>
+              <dia:attribute name="kind">
+                <dia:enum val="0"/>
+              </dia:attribute>
+            </dia:composite>
+          </dia:attribute>
+        </dia:composite>
+        <dia:composite type="umloperation">
+          <dia:attribute name="name">
+            <dia:string>#register_provider#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="stereotype">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="inheritance_type">
+            <dia:enum val="2"/>
+          </dia:attribute>
+          <dia:attribute name="query">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="parameters">
+            <dia:composite type="umlparameter">
+              <dia:attribute name="name">
+                <dia:string>#p#</dia:string>
+              </dia:attribute>
+              <dia:attribute name="type">
+                <dia:string>#boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::visitor&gt;&gt;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -20920,16 +20968,16 @@ main, or from another initialiser.#</dia:string>
         <dia:boolean val="false"/>
       </dia:attribute>
       <dia:attribute name="obj_pos">
-        <dia:point val="341,-38.4"/>
+        <dia:point val="341,-37.6"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="334.17,-39.15;341.75,-3.95"/>
+        <dia:rectangle val="334.17,-38.35;341.75,-3.95"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
       </dia:attribute>
       <dia:attribute name="orth_points">
-        <dia:point val="341,-38.4"/>
+        <dia:point val="341,-37.6"/>
         <dia:point val="341,-4"/>
         <dia:point val="334.22,-4"/>
         <dia:point val="334.22,-8.8"/>
@@ -20956,19 +21004,19 @@ main, or from another initialiser.#</dia:string>
     </dia:object>
     <dia:object type="UML - Class" version="0" id="O172">
       <dia:attribute name="obj_pos">
-        <dia:point val="401,-29"/>
+        <dia:point val="402,-29"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="400.95,-29.05;454.295,-21.35"/>
+        <dia:rectangle val="401.95,-29.05;455.295,-20.55"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
-        <dia:point val="401,-29"/>
+        <dia:point val="402,-29"/>
       </dia:attribute>
       <dia:attribute name="elem_width">
         <dia:real val="53.245000000000005"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="7.5999999999999996"/>
+        <dia:real val="8.4000000000000004"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#container#</dia:string>
@@ -21091,13 +21139,13 @@ main, or from another initialiser.#</dia:string>
         </dia:composite>
         <dia:composite type="umloperation">
           <dia:attribute name="name">
-            <dia:string>#object_providers#</dia:string>
+            <dia:string>#concept_providers#</dia:string>
           </dia:attribute>
           <dia:attribute name="stereotype">
             <dia:string>##</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
-            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::object&gt;&gt;#</dia:string>
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::concept&gt;&gt;#</dia:string>
           </dia:attribute>
           <dia:attribute name="visibility">
             <dia:enum val="0"/>
@@ -21121,13 +21169,13 @@ main, or from another initialiser.#</dia:string>
         </dia:composite>
         <dia:composite type="umloperation">
           <dia:attribute name="name">
-            <dia:string>#concept_providers#</dia:string>
+            <dia:string>#primitive_providers#</dia:string>
           </dia:attribute>
           <dia:attribute name="stereotype">
             <dia:string>##</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
-            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::concept&gt;&gt;#</dia:string>
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::primitive&gt;&gt;#</dia:string>
           </dia:attribute>
           <dia:attribute name="visibility">
             <dia:enum val="0"/>
@@ -21151,13 +21199,13 @@ main, or from another initialiser.#</dia:string>
         </dia:composite>
         <dia:composite type="umloperation">
           <dia:attribute name="name">
-            <dia:string>#exception_providers#</dia:string>
+            <dia:string>#enumeration_providers#</dia:string>
           </dia:attribute>
           <dia:attribute name="stereotype">
             <dia:string>##</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
-            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::exception&gt;&gt;#</dia:string>
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::enumeration&gt;&gt;#</dia:string>
           </dia:attribute>
           <dia:attribute name="visibility">
             <dia:enum val="0"/>
@@ -21181,13 +21229,13 @@ main, or from another initialiser.#</dia:string>
         </dia:composite>
         <dia:composite type="umloperation">
           <dia:attribute name="name">
-            <dia:string>#enumeration_providers#</dia:string>
+            <dia:string>#object_providers#</dia:string>
           </dia:attribute>
           <dia:attribute name="stereotype">
             <dia:string>##</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
-            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::enumeration&gt;&gt;#</dia:string>
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::object&gt;&gt;#</dia:string>
           </dia:attribute>
           <dia:attribute name="visibility">
             <dia:enum val="0"/>
@@ -21211,13 +21259,43 @@ main, or from another initialiser.#</dia:string>
         </dia:composite>
         <dia:composite type="umloperation">
           <dia:attribute name="name">
-            <dia:string>#primitive_providers#</dia:string>
+            <dia:string>#exception_providers#</dia:string>
           </dia:attribute>
           <dia:attribute name="stereotype">
             <dia:string>##</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
-            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::primitive&gt;&gt;#</dia:string>
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::exception&gt;&gt;#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="inheritance_type">
+            <dia:enum val="2"/>
+          </dia:attribute>
+          <dia:attribute name="query">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="parameters"/>
+        </dia:composite>
+        <dia:composite type="umloperation">
+          <dia:attribute name="name">
+            <dia:string>#visitor_providers#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="stereotype">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>#std::forward_list&lt;boost::shared_ptr&lt;formattables::inclusion_dependencies_provider_interface&lt;yarn::visitor&gt;&gt;#</dia:string>
           </dia:attribute>
           <dia:attribute name="visibility">
             <dia:enum val="0"/>
@@ -21287,7 +21365,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="341,-46"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="340.25,-54.75;427.63,-28.2"/>
+        <dia:rectangle val="340.25,-54.75;428.822,-28.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -21295,8 +21373,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="341,-46"/>
         <dia:point val="341,-54"/>
-        <dia:point val="427.43,-54"/>
-        <dia:point val="427.43,-29"/>
+        <dia:point val="428.623,-54"/>
+        <dia:point val="428.623,-29"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -21356,17 +21434,17 @@ main, or from another initialiser.#</dia:string>
         <dia:boolean val="false"/>
       </dia:attribute>
       <dia:attribute name="obj_pos">
-        <dia:point val="453.86,-29"/>
+        <dia:point val="455.245,-29"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="334.17,-57.75;454.61,-13.2"/>
+        <dia:rectangle val="334.17,-57.75;455.995,-13.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
       </dia:attribute>
       <dia:attribute name="orth_points">
-        <dia:point val="453.86,-29"/>
-        <dia:point val="453.86,-57"/>
+        <dia:point val="455.245,-29"/>
+        <dia:point val="455.245,-57"/>
         <dia:point val="334.22,-57"/>
         <dia:point val="334.22,-14"/>
       </dia:attribute>
@@ -21467,7 +21545,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="412,-14"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="411.95,-14.05;443.35,4.65"/>
+        <dia:rectangle val="411.95,-14.05;443.35,6.25"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
         <dia:point val="412,-14"/>
@@ -21476,7 +21554,7 @@ main, or from another initialiser.#</dia:string>
         <dia:real val="31.300000000000001"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="18.600000000000005"/>
+        <dia:real val="20.200000000000006"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#inclusion_dependencies_factory#</dia:string>
@@ -21798,10 +21876,10 @@ main, or from another initialiser.#</dia:string>
           <dia:attribute name="parameters">
             <dia:composite type="umlparameter">
               <dia:attribute name="name">
-                <dia:string>#o#</dia:string>
+                <dia:string>#c#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#const yarn::object&amp;#</dia:string>
+                <dia:string>#const yarn::concept&amp;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -21838,7 +21916,7 @@ main, or from another initialiser.#</dia:string>
             <dia:enum val="2"/>
           </dia:attribute>
           <dia:attribute name="query">
-            <dia:boolean val="true"/>
+            <dia:boolean val="false"/>
           </dia:attribute>
           <dia:attribute name="class_scope">
             <dia:boolean val="false"/>
@@ -21846,10 +21924,10 @@ main, or from another initialiser.#</dia:string>
           <dia:attribute name="parameters">
             <dia:composite type="umlparameter">
               <dia:attribute name="name">
-                <dia:string>#c#</dia:string>
+                <dia:string>#e#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#const yarn::concept&amp;#</dia:string>
+                <dia:string>#const yarn::enumeration&amp;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -21894,10 +21972,10 @@ main, or from another initialiser.#</dia:string>
           <dia:attribute name="parameters">
             <dia:composite type="umlparameter">
               <dia:attribute name="name">
-                <dia:string>#e#</dia:string>
+                <dia:string>#p#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#const yarn::exception&amp;#</dia:string>
+                <dia:string>#const yarn::primitive&amp;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -21934,7 +22012,7 @@ main, or from another initialiser.#</dia:string>
             <dia:enum val="2"/>
           </dia:attribute>
           <dia:attribute name="query">
-            <dia:boolean val="false"/>
+            <dia:boolean val="true"/>
           </dia:attribute>
           <dia:attribute name="class_scope">
             <dia:boolean val="false"/>
@@ -21942,10 +22020,10 @@ main, or from another initialiser.#</dia:string>
           <dia:attribute name="parameters">
             <dia:composite type="umlparameter">
               <dia:attribute name="name">
-                <dia:string>#e#</dia:string>
+                <dia:string>#o#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#const yarn::enumeration&amp;#</dia:string>
+                <dia:string>#const yarn::object&amp;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -21990,10 +22068,58 @@ main, or from another initialiser.#</dia:string>
           <dia:attribute name="parameters">
             <dia:composite type="umlparameter">
               <dia:attribute name="name">
-                <dia:string>#p#</dia:string>
+                <dia:string>#e#</dia:string>
               </dia:attribute>
               <dia:attribute name="type">
-                <dia:string>#const yarn::primitive&amp;#</dia:string>
+                <dia:string>#const yarn::exception&amp;#</dia:string>
+              </dia:attribute>
+              <dia:attribute name="value">
+                <dia:string>##</dia:string>
+              </dia:attribute>
+              <dia:attribute name="comment">
+                <dia:string>##</dia:string>
+              </dia:attribute>
+              <dia:attribute name="kind">
+                <dia:enum val="0"/>
+              </dia:attribute>
+            </dia:composite>
+          </dia:attribute>
+        </dia:composite>
+        <dia:composite type="umloperation">
+          <dia:attribute name="name">
+            <dia:string>#name#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="stereotype">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>#std::unordered_map&lt;std::string, std::list&lt;std::string&gt;&gt;#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="inheritance_type">
+            <dia:enum val="2"/>
+          </dia:attribute>
+          <dia:attribute name="query">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="parameters">
+            <dia:composite type="umlparameter">
+              <dia:attribute name="name">
+                <dia:string>#v#</dia:string>
+              </dia:attribute>
+              <dia:attribute name="type">
+                <dia:string>#const yarn::visitor&amp;#</dia:string>
               </dia:attribute>
               <dia:attribute name="value">
                 <dia:string>##</dia:string>
@@ -22055,7 +22181,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="443.3,-14"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="442.55,-21.45;454.06,-13.2"/>
+        <dia:rectangle val="442.55,-20.65;455.445,-13.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -22063,8 +22189,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="443.3,-14"/>
         <dia:point val="443.3,-18"/>
-        <dia:point val="453.86,-18"/>
-        <dia:point val="453.86,-21.4"/>
+        <dia:point val="455.245,-18"/>
+        <dia:point val="455.245,-20.6"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -22235,17 +22361,17 @@ main, or from another initialiser.#</dia:string>
         <dia:boolean val="false"/>
       </dia:attribute>
       <dia:attribute name="obj_pos">
-        <dia:point val="385.39,-46"/>
+        <dia:point val="385.775,-46"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="384.64,-51.75;395.775,-45.2"/>
+        <dia:rectangle val="385.025,-51.75;395.775,-45.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
       </dia:attribute>
       <dia:attribute name="orth_points">
-        <dia:point val="385.39,-46"/>
-        <dia:point val="385.39,-51"/>
+        <dia:point val="385.775,-46"/>
+        <dia:point val="385.775,-51"/>
         <dia:point val="395.575,-51"/>
         <dia:point val="395.575,-46.0496"/>
       </dia:attribute>
@@ -22798,7 +22924,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="376.725,-29"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="363.145,-38.45;377.475,-28.2"/>
+        <dia:rectangle val="363.337,-37.65;377.475,-28.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -22806,8 +22932,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="376.725,-29"/>
         <dia:point val="376.725,-34"/>
-        <dia:point val="363.195,-34"/>
-        <dia:point val="363.195,-38.4"/>
+        <dia:point val="363.387,-34"/>
+        <dia:point val="363.387,-37.6"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -22870,7 +22996,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="390.45,-29"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="389.7,-34.75;401.2,-28.2"/>
+        <dia:rectangle val="389.7,-34.75;402.2,-28.2"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -22878,8 +23004,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="390.45,-29"/>
         <dia:point val="390.45,-34"/>
-        <dia:point val="401,-34"/>
-        <dia:point val="401,-29"/>
+        <dia:point val="402,-34"/>
+        <dia:point val="402,-29"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -24746,7 +24872,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="229.43,-40"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="224.867,-40.05;229.63,-28.249"/>
+        <dia:rectangle val="224.864,-40.05;229.63,-28.249"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -24754,8 +24880,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="229.43,-40"/>
         <dia:point val="229.43,-34"/>
-        <dia:point val="225.629,-34"/>
-        <dia:point val="225.619,-29.049"/>
+        <dia:point val="225.619,-34"/>
+        <dia:point val="225.615,-29.049"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -30328,7 +30454,7 @@ main, or from another initialiser.#</dia:string>
         <dia:point val="148.917,134.2"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="140.909,133.45;149.667,146.75"/>
+        <dia:rectangle val="140.906,133.45;149.667,146.75"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -30336,8 +30462,8 @@ main, or from another initialiser.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="148.917,134.2"/>
         <dia:point val="148.917,141"/>
-        <dia:point val="140.972,141"/>
-        <dia:point val="140.959,145.95"/>
+        <dia:point val="140.959,141"/>
+        <dia:point val="140.956,145.95"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
diff --git a/diagrams/yarn.dia b/diagrams/yarn.dia
index b3c539a..0e2388b 100644
--- a/diagrams/yarn.dia
+++ b/diagrams/yarn.dia
@@ -6509,7 +6509,7 @@ expansion.#</dia:string>
         <dia:point val="-29,92"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="-29.05,91.95;-18.44,101.25"/>
+        <dia:rectangle val="-29.05,91.95;-18.44,99.65"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
         <dia:point val="-29,92"/>
@@ -6518,7 +6518,7 @@ expansion.#</dia:string>
         <dia:real val="10.51"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="9.2000000000000011"/>
+        <dia:real val="7.6000000000000005"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#object_types#</dia:string>
@@ -6636,29 +6636,6 @@ etc.#</dia:string>
         </dia:composite>
         <dia:composite type="umlattribute">
           <dia:attribute name="name">
-            <dia:string>#visitor#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="type">
-            <dia:string>##</dia:string>
-          </dia:attribute>
-          <dia:attribute name="value">
-            <dia:string>##</dia:string>
-          </dia:attribute>
-          <dia:attribute name="comment">
-            <dia:string>#The service is a system generated visitor.#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="visibility">
-            <dia:enum val="0"/>
-          </dia:attribute>
-          <dia:attribute name="abstract">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-          <dia:attribute name="class_scope">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-        </dia:composite>
-        <dia:composite type="umlattribute">
-          <dia:attribute name="name">
             <dia:string>#user_defined_value_object#</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
@@ -6682,29 +6659,6 @@ etc.#</dia:string>
         </dia:composite>
         <dia:composite type="umlattribute">
           <dia:attribute name="name">
-            <dia:string>#exception#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="type">
-            <dia:string>##</dia:string>
-          </dia:attribute>
-          <dia:attribute name="value">
-            <dia:string>##</dia:string>
-          </dia:attribute>
-          <dia:attribute name="comment">
-            <dia:string>#Value represents an exception type.#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="visibility">
-            <dia:enum val="0"/>
-          </dia:attribute>
-          <dia:attribute name="abstract">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-          <dia:attribute name="class_scope">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-        </dia:composite>
-        <dia:composite type="umlattribute">
-          <dia:attribute name="name">
             <dia:string>#smart_pointer#</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
@@ -7596,7 +7550,7 @@ etc.#</dia:string>
         <dia:point val="62.3025,89"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="54.95,74.95;63.0525,89.8"/>
+        <dia:rectangle val="54.95,76.55;63.0525,89.8"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -7605,7 +7559,7 @@ etc.#</dia:string>
         <dia:point val="62.3025,89"/>
         <dia:point val="62.3025,81"/>
         <dia:point val="55,81"/>
-        <dia:point val="55,75"/>
+        <dia:point val="55,76.6"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -11252,7 +11206,7 @@ from inputs and generates yarn types off of them.#</dia:string>
         <dia:point val="148.06,55.2"/>
         <dia:point val="148.06,81"/>
         <dia:point val="78.215,81"/>
-        <dia:point val="78.215,75"/>
+        <dia:point val="78.215,76.6"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
@@ -13649,7 +13603,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
         <dia:point val="55,65"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="54.95,64.95;78.265,75.05"/>
+        <dia:rectangle val="54.95,64.95;78.265,76.65"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
         <dia:point val="55,65"/>
@@ -13658,7 +13612,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
         <dia:real val="23.215"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="10"/>
+        <dia:real val="11.6"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#intermediate_model#</dia:string>
@@ -13913,6 +13867,52 @@ Leaves are types concrete types which have a parent.#</dia:string>
         </dia:composite>
         <dia:composite type="umlattribute">
           <dia:attribute name="name">
+            <dia:string>#exceptions#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>#std::unordered_map&lt;std::string, exception&gt;#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="value">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>#All exceptions in this model.#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+        </dia:composite>
+        <dia:composite type="umlattribute">
+          <dia:attribute name="name">
+            <dia:string>#visitors#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>#std::unordered_map&lt;std::string, visitor&gt;#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="value">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>#All visitors in this model.#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+        </dia:composite>
+        <dia:composite type="umlattribute">
+          <dia:attribute name="name">
             <dia:string>#is_target#</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
@@ -15615,7 +15615,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
         <dia:point val="-180,-1"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="-180.05,-1.05;-167.515,5.05"/>
+        <dia:rectangle val="-180.05,-1.05;-167.515,4.25"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
         <dia:point val="-180,-1"/>
@@ -15624,7 +15624,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
         <dia:real val="12.434999999999999"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="6.0000000000000009"/>
+        <dia:real val="5.2000000000000011"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#Visitable#</dia:string>
@@ -15766,30 +15766,7 @@ Set to false if no parent exists, or if the parent is not visitable. #</dia:stri
         </dia:composite>
         <dia:composite type="umlattribute">
           <dia:attribute name="name">
-            <dia:string>#visits#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="type">
-            <dia:string>#std::list&lt;name&gt;#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="value">
-            <dia:string>##</dia:string>
-          </dia:attribute>
-          <dia:attribute name="comment">
-            <dia:string>#Elements that are visited by the visitor.#</dia:string>
-          </dia:attribute>
-          <dia:attribute name="visibility">
-            <dia:enum val="0"/>
-          </dia:attribute>
-          <dia:attribute name="abstract">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-          <dia:attribute name="class_scope">
-            <dia:boolean val="false"/>
-          </dia:attribute>
-        </dia:composite>
-        <dia:composite type="umlattribute">
-          <dia:attribute name="name">
-            <dia:string>#visited_by#</dia:string>
+            <dia:string>#visitable_by#</dia:string>
           </dia:attribute>
           <dia:attribute name="type">
             <dia:string>#std::list&lt;name&gt;#</dia:string>
@@ -16461,16 +16438,16 @@ This is used to break cycles where required.#</dia:string>
     </dia:object>
     <dia:object type="UML - Generalization" version="1" id="O140">
       <dia:attribute name="obj_pos">
-        <dia:point val="-173.782,5"/>
+        <dia:point val="-173.782,4.2"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="-174.632,4.95;-149.557,14.0004"/>
+        <dia:rectangle val="-174.632,4.15;-149.557,14.0004"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
       </dia:attribute>
       <dia:attribute name="orth_points">
-        <dia:point val="-173.782,5"/>
+        <dia:point val="-173.782,4.2"/>
         <dia:point val="-173.782,9"/>
         <dia:point val="-149.607,9"/>
         <dia:point val="-149.607,13.9504"/>
@@ -16502,19 +16479,19 @@ This is used to break cycles where required.#</dia:string>
     </dia:object>
     <dia:object type="UML - Class" version="0" id="O141">
       <dia:attribute name="obj_pos">
-        <dia:point val="-7,92"/>
+        <dia:point val="-10,92"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="-7.05,91.95;-3.575,94.25"/>
+        <dia:rectangle val="-10.05,91.95;-0.21,94.85"/>
       </dia:attribute>
       <dia:attribute name="elem_corner">
-        <dia:point val="-7,92"/>
+        <dia:point val="-10,92"/>
       </dia:attribute>
       <dia:attribute name="elem_width">
-        <dia:real val="3.375"/>
+        <dia:real val="9.7400000000000002"/>
       </dia:attribute>
       <dia:attribute name="elem_height">
-        <dia:real val="2.1999999999999997"/>
+        <dia:real val="2.7999999999999998"/>
       </dia:attribute>
       <dia:attribute name="name">
         <dia:string>#visitor#</dia:string>
@@ -16603,7 +16580,31 @@ This is used to break cycles where required.#</dia:string>
       <dia:attribute name="comment_font_height">
         <dia:real val="0.69999999999999996"/>
       </dia:attribute>
-      <dia:attribute name="attributes"/>
+      <dia:attribute name="attributes">
+        <dia:composite type="umlattribute">
+          <dia:attribute name="name">
+            <dia:string>#visits#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="type">
+            <dia:string>#std::list&lt;name&gt;#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="value">
+            <dia:string>##</dia:string>
+          </dia:attribute>
+          <dia:attribute name="comment">
+            <dia:string>#Elements that are visitable by the visitor.#</dia:string>
+          </dia:attribute>
+          <dia:attribute name="visibility">
+            <dia:enum val="0"/>
+          </dia:attribute>
+          <dia:attribute name="abstract">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+          <dia:attribute name="class_scope">
+            <dia:boolean val="false"/>
+          </dia:attribute>
+        </dia:composite>
+      </dia:attribute>
       <dia:attribute name="operations"/>
       <dia:attribute name="template">
         <dia:boolean val="false"/>
@@ -16725,7 +16726,7 @@ This is used to break cycles where required.#</dia:string>
         <dia:point val="-0.515,68.0496"/>
       </dia:attribute>
       <dia:attribute name="obj_bb">
-        <dia:rectangle val="-5.3625,67.9996;0.335,92.05"/>
+        <dia:rectangle val="-5.18,67.9996;0.335,92.05"/>
       </dia:attribute>
       <dia:attribute name="meta">
         <dia:composite type="dict"/>
@@ -16733,8 +16734,8 @@ This is used to break cycles where required.#</dia:string>
       <dia:attribute name="orth_points">
         <dia:point val="-0.515,68.0496"/>
         <dia:point val="-0.515,73"/>
-        <dia:point val="-5.3125,73"/>
-        <dia:point val="-5.3125,92"/>
+        <dia:point val="-5.13,73"/>
+        <dia:point val="-5.13,92"/>
       </dia:attribute>
       <dia:attribute name="orth_orient">
         <dia:enum val="1"/>
diff --git a/doc/agile/sprint_backlog_76.org b/doc/agile/sprint_backlog_76.org
index 840fb86..ad8cf39 100644
--- a/doc/agile/sprint_backlog_76.org
+++ b/doc/agile/sprint_backlog_76.org
@@ -13,17 +13,17 @@
 ** Active
 
 #+begin: clocktable :maxlevel 3 :scope subtree :indent nil :emphasize nil :scope file :narrow 75
-#+CAPTION: Clock summary at [2015-12-10 Thu 07:31]
+#+CAPTION: Clock summary at [2015-12-10 Thu 23:19]
 | <75>                                                                        |        |      |      |
 | Headline                                                                    | Time   |      |      |
 |-----------------------------------------------------------------------------+--------+------+------|
-| *Total time*                                                                | *5:15* |      |      |
+| *Total time*                                                                | *8:01* |      |      |
 |-----------------------------------------------------------------------------+--------+------+------|
-| Stories                                                                     | 5:15   |      |      |
-| Active                                                                      |        | 5:15 |      |
+| Stories                                                                     | 8:01   |      |      |
+| Active                                                                      |        | 8:01 |      |
 | STARTED Sprint and product backlog grooming                                 |        |      | 0:39 |
 | STARTED Remove =service= stereotype                                         |        |      | 0:18 |
-| STARTED Create visitor and exception yarn types                             |        |      | 3:59 |
+| STARTED Create visitor and exception yarn types                             |        |      | 6:45 |
 | STARTED Update copyright notices                                            |        |      | 0:19 |
 #+end:
 
@@ -383,7 +383,9 @@ all facets except for types. A few points:
   profiles" to go with "enablement profiles".
 
 *** STARTED Create visitor and exception yarn types                   :story:
-    CLOCK: [2015-12-10 Thu 07:11]--[2015-12-10 Thu 07:31] =>  0:20
+    CLOCK: [2015-12-10 Thu 21:34]--[2015-12-10 Thu 23:20] =>  1:46
+    CLOCK: [2015-12-10 Thu 17:57]--[2015-12-10 Thu 18:37] =>  0:40
+    CLOCK: [2015-12-10 Thu 07:11]--[2015-12-10 Thu 07:51] =>  0:40
     CLOCK: [2015-12-09 Wed 21:04]--[2015-12-09 Wed 23:38] =>  2:34
     CLOCK: [2015-12-08 Tue 23:48]--[2015-12-09 Wed 00:13] =>  0:25
     CLOCK: [2015-12-08 Tue 22:55]--[2015-12-08 Tue 23:35] =>  0:40
@@ -631,9 +633,16 @@ non-target names that are in use and return those.
 
 *** Handle enumeration type dynamically                               :story:
 
-- add some enumeration post-processing that assigns it a underlying
-  type. Should be done with merged model (look for a primitive type with
-  property =is_default_enumeration_type=).
+Add some enumeration post-processing that assigns it a underlying
+type. Should be done with merged model (look for a primitive type with
+property =is_default_enumeration_type=).
+
+This should be done as part of resolution perhaps; user provides a raw
+type, we expand it during expansion and resolve it during
+resolution. If the string is empty, we should use the default
+enumeration type. It is chosen from the collection of
+primitives. There can only be one type marked as
+default. =is_enumeration_default_type=? Read from JSON file.
 
 *** Services and leaves are not properly handled                      :story:
 
diff --git a/patches/add_visitor_and_exception.patch b/patches/add_visitor_and_exception.patch
index 345891e..e69de29 100644
--- a/patches/add_visitor_and_exception.patch
+++ b/patches/add_visitor_and_exception.patch
@@ -1,1539 +0,0 @@
-diff --git a/diagrams/yarn.dia b/diagrams/yarn.dia
-index b3c539a..0e2388b 100644
---- a/diagrams/yarn.dia
-+++ b/diagrams/yarn.dia
-@@ -6509,7 +6509,7 @@ expansion.#</dia:string>
-         <dia:point val="-29,92"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="-29.05,91.95;-18.44,101.25"/>
-+        <dia:rectangle val="-29.05,91.95;-18.44,99.65"/>
-       </dia:attribute>
-       <dia:attribute name="elem_corner">
-         <dia:point val="-29,92"/>
-@@ -6518,7 +6518,7 @@ expansion.#</dia:string>
-         <dia:real val="10.51"/>
-       </dia:attribute>
-       <dia:attribute name="elem_height">
--        <dia:real val="9.2000000000000011"/>
-+        <dia:real val="7.6000000000000005"/>
-       </dia:attribute>
-       <dia:attribute name="name">
-         <dia:string>#object_types#</dia:string>
-@@ -6636,29 +6636,6 @@ etc.#</dia:string>
-         </dia:composite>
-         <dia:composite type="umlattribute">
-           <dia:attribute name="name">
--            <dia:string>#visitor#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="type">
--            <dia:string>##</dia:string>
--          </dia:attribute>
--          <dia:attribute name="value">
--            <dia:string>##</dia:string>
--          </dia:attribute>
--          <dia:attribute name="comment">
--            <dia:string>#The service is a system generated visitor.#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="visibility">
--            <dia:enum val="0"/>
--          </dia:attribute>
--          <dia:attribute name="abstract">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--          <dia:attribute name="class_scope">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--        </dia:composite>
--        <dia:composite type="umlattribute">
--          <dia:attribute name="name">
-             <dia:string>#user_defined_value_object#</dia:string>
-           </dia:attribute>
-           <dia:attribute name="type">
-@@ -6682,29 +6659,6 @@ etc.#</dia:string>
-         </dia:composite>
-         <dia:composite type="umlattribute">
-           <dia:attribute name="name">
--            <dia:string>#exception#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="type">
--            <dia:string>##</dia:string>
--          </dia:attribute>
--          <dia:attribute name="value">
--            <dia:string>##</dia:string>
--          </dia:attribute>
--          <dia:attribute name="comment">
--            <dia:string>#Value represents an exception type.#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="visibility">
--            <dia:enum val="0"/>
--          </dia:attribute>
--          <dia:attribute name="abstract">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--          <dia:attribute name="class_scope">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--        </dia:composite>
--        <dia:composite type="umlattribute">
--          <dia:attribute name="name">
-             <dia:string>#smart_pointer#</dia:string>
-           </dia:attribute>
-           <dia:attribute name="type">
-@@ -7596,7 +7550,7 @@ etc.#</dia:string>
-         <dia:point val="62.3025,89"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="54.95,74.95;63.0525,89.8"/>
-+        <dia:rectangle val="54.95,76.55;63.0525,89.8"/>
-       </dia:attribute>
-       <dia:attribute name="meta">
-         <dia:composite type="dict"/>
-@@ -7605,7 +7559,7 @@ etc.#</dia:string>
-         <dia:point val="62.3025,89"/>
-         <dia:point val="62.3025,81"/>
-         <dia:point val="55,81"/>
--        <dia:point val="55,75"/>
-+        <dia:point val="55,76.6"/>
-       </dia:attribute>
-       <dia:attribute name="orth_orient">
-         <dia:enum val="1"/>
-@@ -11252,7 +11206,7 @@ from inputs and generates yarn types off of them.#</dia:string>
-         <dia:point val="148.06,55.2"/>
-         <dia:point val="148.06,81"/>
-         <dia:point val="78.215,81"/>
--        <dia:point val="78.215,75"/>
-+        <dia:point val="78.215,76.6"/>
-       </dia:attribute>
-       <dia:attribute name="orth_orient">
-         <dia:enum val="1"/>
-@@ -13649,7 +13603,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
-         <dia:point val="55,65"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="54.95,64.95;78.265,75.05"/>
-+        <dia:rectangle val="54.95,64.95;78.265,76.65"/>
-       </dia:attribute>
-       <dia:attribute name="elem_corner">
-         <dia:point val="55,65"/>
-@@ -13658,7 +13612,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
-         <dia:real val="23.215"/>
-       </dia:attribute>
-       <dia:attribute name="elem_height">
--        <dia:real val="10"/>
-+        <dia:real val="11.6"/>
-       </dia:attribute>
-       <dia:attribute name="name">
-         <dia:string>#intermediate_model#</dia:string>
-@@ -13913,6 +13867,52 @@ Leaves are types concrete types which have a parent.#</dia:string>
-         </dia:composite>
-         <dia:composite type="umlattribute">
-           <dia:attribute name="name">
-+            <dia:string>#exceptions#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="type">
-+            <dia:string>#std::unordered_map&lt;std::string, exception&gt;#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="value">
-+            <dia:string>##</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="comment">
-+            <dia:string>#All exceptions in this model.#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="visibility">
-+            <dia:enum val="0"/>
-+          </dia:attribute>
-+          <dia:attribute name="abstract">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+          <dia:attribute name="class_scope">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+        </dia:composite>
-+        <dia:composite type="umlattribute">
-+          <dia:attribute name="name">
-+            <dia:string>#visitors#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="type">
-+            <dia:string>#std::unordered_map&lt;std::string, visitor&gt;#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="value">
-+            <dia:string>##</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="comment">
-+            <dia:string>#All visitors in this model.#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="visibility">
-+            <dia:enum val="0"/>
-+          </dia:attribute>
-+          <dia:attribute name="abstract">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+          <dia:attribute name="class_scope">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+        </dia:composite>
-+        <dia:composite type="umlattribute">
-+          <dia:attribute name="name">
-             <dia:string>#is_target#</dia:string>
-           </dia:attribute>
-           <dia:attribute name="type">
-@@ -15615,7 +15615,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
-         <dia:point val="-180,-1"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="-180.05,-1.05;-167.515,5.05"/>
-+        <dia:rectangle val="-180.05,-1.05;-167.515,4.25"/>
-       </dia:attribute>
-       <dia:attribute name="elem_corner">
-         <dia:point val="-180,-1"/>
-@@ -15624,7 +15624,7 @@ Leaves are types concrete types which have a parent.#</dia:string>
-         <dia:real val="12.434999999999999"/>
-       </dia:attribute>
-       <dia:attribute name="elem_height">
--        <dia:real val="6.0000000000000009"/>
-+        <dia:real val="5.2000000000000011"/>
-       </dia:attribute>
-       <dia:attribute name="name">
-         <dia:string>#Visitable#</dia:string>
-@@ -15766,30 +15766,7 @@ Set to false if no parent exists, or if the parent is not visitable. #</dia:stri
-         </dia:composite>
-         <dia:composite type="umlattribute">
-           <dia:attribute name="name">
--            <dia:string>#visits#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="type">
--            <dia:string>#std::list&lt;name&gt;#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="value">
--            <dia:string>##</dia:string>
--          </dia:attribute>
--          <dia:attribute name="comment">
--            <dia:string>#Elements that are visited by the visitor.#</dia:string>
--          </dia:attribute>
--          <dia:attribute name="visibility">
--            <dia:enum val="0"/>
--          </dia:attribute>
--          <dia:attribute name="abstract">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--          <dia:attribute name="class_scope">
--            <dia:boolean val="false"/>
--          </dia:attribute>
--        </dia:composite>
--        <dia:composite type="umlattribute">
--          <dia:attribute name="name">
--            <dia:string>#visited_by#</dia:string>
-+            <dia:string>#visitable_by#</dia:string>
-           </dia:attribute>
-           <dia:attribute name="type">
-             <dia:string>#std::list&lt;name&gt;#</dia:string>
-@@ -16461,16 +16438,16 @@ This is used to break cycles where required.#</dia:string>
-     </dia:object>
-     <dia:object type="UML - Generalization" version="1" id="O140">
-       <dia:attribute name="obj_pos">
--        <dia:point val="-173.782,5"/>
-+        <dia:point val="-173.782,4.2"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="-174.632,4.95;-149.557,14.0004"/>
-+        <dia:rectangle val="-174.632,4.15;-149.557,14.0004"/>
-       </dia:attribute>
-       <dia:attribute name="meta">
-         <dia:composite type="dict"/>
-       </dia:attribute>
-       <dia:attribute name="orth_points">
--        <dia:point val="-173.782,5"/>
-+        <dia:point val="-173.782,4.2"/>
-         <dia:point val="-173.782,9"/>
-         <dia:point val="-149.607,9"/>
-         <dia:point val="-149.607,13.9504"/>
-@@ -16502,19 +16479,19 @@ This is used to break cycles where required.#</dia:string>
-     </dia:object>
-     <dia:object type="UML - Class" version="0" id="O141">
-       <dia:attribute name="obj_pos">
--        <dia:point val="-7,92"/>
-+        <dia:point val="-10,92"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="-7.05,91.95;-3.575,94.25"/>
-+        <dia:rectangle val="-10.05,91.95;-0.21,94.85"/>
-       </dia:attribute>
-       <dia:attribute name="elem_corner">
--        <dia:point val="-7,92"/>
-+        <dia:point val="-10,92"/>
-       </dia:attribute>
-       <dia:attribute name="elem_width">
--        <dia:real val="3.375"/>
-+        <dia:real val="9.7400000000000002"/>
-       </dia:attribute>
-       <dia:attribute name="elem_height">
--        <dia:real val="2.1999999999999997"/>
-+        <dia:real val="2.7999999999999998"/>
-       </dia:attribute>
-       <dia:attribute name="name">
-         <dia:string>#visitor#</dia:string>
-@@ -16603,7 +16580,31 @@ This is used to break cycles where required.#</dia:string>
-       <dia:attribute name="comment_font_height">
-         <dia:real val="0.69999999999999996"/>
-       </dia:attribute>
--      <dia:attribute name="attributes"/>
-+      <dia:attribute name="attributes">
-+        <dia:composite type="umlattribute">
-+          <dia:attribute name="name">
-+            <dia:string>#visits#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="type">
-+            <dia:string>#std::list&lt;name&gt;#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="value">
-+            <dia:string>##</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="comment">
-+            <dia:string>#Elements that are visitable by the visitor.#</dia:string>
-+          </dia:attribute>
-+          <dia:attribute name="visibility">
-+            <dia:enum val="0"/>
-+          </dia:attribute>
-+          <dia:attribute name="abstract">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+          <dia:attribute name="class_scope">
-+            <dia:boolean val="false"/>
-+          </dia:attribute>
-+        </dia:composite>
-+      </dia:attribute>
-       <dia:attribute name="operations"/>
-       <dia:attribute name="template">
-         <dia:boolean val="false"/>
-@@ -16725,7 +16726,7 @@ This is used to break cycles where required.#</dia:string>
-         <dia:point val="-0.515,68.0496"/>
-       </dia:attribute>
-       <dia:attribute name="obj_bb">
--        <dia:rectangle val="-5.3625,67.9996;0.335,92.05"/>
-+        <dia:rectangle val="-5.18,67.9996;0.335,92.05"/>
-       </dia:attribute>
-       <dia:attribute name="meta">
-         <dia:composite type="dict"/>
-@@ -16733,8 +16734,8 @@ This is used to break cycles where required.#</dia:string>
-       <dia:attribute name="orth_points">
-         <dia:point val="-0.515,68.0496"/>
-         <dia:point val="-0.515,73"/>
--        <dia:point val="-5.3125,73"/>
--        <dia:point val="-5.3125,92"/>
-+        <dia:point val="-5.13,73"/>
-+        <dia:point val="-5.13,92"/>
-       </dia:attribute>
-       <dia:attribute name="orth_orient">
-         <dia:enum val="1"/>
-diff --git a/doc/agile/sprint_backlog_76.org b/doc/agile/sprint_backlog_76.org
-index 840fb86..0df525b 100644
---- a/doc/agile/sprint_backlog_76.org
-+++ b/doc/agile/sprint_backlog_76.org
-@@ -13,17 +13,17 @@
- ** Active
- 
- #+begin: clocktable :maxlevel 3 :scope subtree :indent nil :emphasize nil :scope file :narrow 75
--#+CAPTION: Clock summary at [2015-12-10 Thu 07:31]
-+#+CAPTION: Clock summary at [2015-12-10 Thu 18:37]
- | <75>                                                                        |        |      |      |
- | Headline                                                                    | Time   |      |      |
- |-----------------------------------------------------------------------------+--------+------+------|
--| *Total time*                                                                | *5:15* |      |      |
-+| *Total time*                                                                | *5:55* |      |      |
- |-----------------------------------------------------------------------------+--------+------+------|
--| Stories                                                                     | 5:15   |      |      |
--| Active                                                                      |        | 5:15 |      |
-+| Stories                                                                     | 5:55   |      |      |
-+| Active                                                                      |        | 5:55 |      |
- | STARTED Sprint and product backlog grooming                                 |        |      | 0:39 |
- | STARTED Remove =service= stereotype                                         |        |      | 0:18 |
--| STARTED Create visitor and exception yarn types                             |        |      | 3:59 |
-+| STARTED Create visitor and exception yarn types                             |        |      | 4:39 |
- | STARTED Update copyright notices                                            |        |      | 0:19 |
- #+end:
- 
-@@ -383,6 +383,7 @@ all facets except for types. A few points:
-   profiles" to go with "enablement profiles".
- 
- *** STARTED Create visitor and exception yarn types                   :story:
-+    CLOCK: [2015-12-10 Thu 17:57]--[2015-12-10 Thu 18:37] =>  0:40
-     CLOCK: [2015-12-10 Thu 07:11]--[2015-12-10 Thu 07:31] =>  0:20
-     CLOCK: [2015-12-09 Wed 21:04]--[2015-12-09 Wed 23:38] =>  2:34
-     CLOCK: [2015-12-08 Tue 23:48]--[2015-12-09 Wed 00:13] =>  0:25
-diff --git a/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp b/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
-index 9a69147..9356414 100644
---- a/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
-+++ b/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
-@@ -260,7 +260,7 @@ public:
-     /**
-      * @brief Create an exception.
-      */
--    object make_exception(const unsigned int i, const name& model_name,
-+    exception make_exception(const unsigned int i, const name& model_name,
-         const unsigned int module_n = 0) const;
- 
-     /**
-diff --git a/projects/yarn/include/dogen/yarn/types/injector.hpp b/projects/yarn/include/dogen/yarn/types/injector.hpp
-index 3647e73..7de14e3 100644
---- a/projects/yarn/include/dogen/yarn/types/injector.hpp
-+++ b/projects/yarn/include/dogen/yarn/types/injector.hpp
-@@ -26,7 +26,6 @@
- #endif
- 
- #include <list>
--#include <memory>
- #include "dogen/yarn/types/intermediate_model.hpp"
- 
- namespace dogen {
-@@ -51,24 +50,11 @@ namespace yarn {
-  *
-  */
- class injector {
--public:
--    injector() = default;
--    injector(const injector&) = default;
--    ~injector() = default;
--    injector(injector&&) = default;
--    injector& operator=(const injector&) = default;
--
--private:
--    class context;
--
- private:
-     /**
--     * @brief Inserts the object into the model's object container.
--     *
--     * @return True if the object did not exist in container, false
--     * otherwise.
-+     * @brief Creates the module to represent the global namespace.
-      */
--    bool insert(const object& o);
-+    module create_global_module() const;
- 
-     /**
-      * @brief Create a visitor for the object o.
-@@ -78,26 +64,26 @@ private:
-      *
-      * @pre leaves must not be empty.
-      */
--    object create_visitor(const object& o,
-+    visitor create_visitor(const object& o,
-         const std::list<name>& leaves) const;
- 
-     /**
-      * @brief Injects an accept operation for the given visitor, to
-      * the supplied object and all its leaves.
-      */
--    void inject_visited_by(object& root, const std::list<name>& leaves,
--        const name& visitor) const;
-+    void inject_visitable_by(object& root, const std::list<name>& leaves,
-+        const name& visitor, intermediate_model& m) const;
- 
-     /**
-      * @brief Injects visitors for objects that require them.
-      */
--    void inject_visitors();
-+    void inject_visitors(intermediate_model& m);
- 
-     /**
-      * @brief Injects the global module, and makes all modules that do
-      * not have a containing namespace be contained by it.
-      */
--    void inject_global_module();
-+    void inject_global_module(intermediate_model& m);
- 
- public:
- 
-@@ -107,9 +93,6 @@ public:
-      * @param m Yarn model to operate on.
-      */
-     void inject(intermediate_model& m);
--
--private:
--    mutable std::shared_ptr<context> context_;
- };
- 
- } }
-diff --git a/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp b/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
-index 1d53082..fc46675 100644
---- a/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
-+++ b/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
-@@ -33,7 +33,9 @@
- #include "dogen/yarn/types/module.hpp"
- #include "dogen/yarn/types/object.hpp"
- #include "dogen/yarn/types/concept.hpp"
-+#include "dogen/yarn/types/visitor.hpp"
- #include "dogen/yarn/hash/name_hash.hpp"
-+#include "dogen/yarn/types/exception.hpp"
- #include "dogen/yarn/types/primitive.hpp"
- #include "dogen/yarn/types/enumeration.hpp"
- #include "dogen/yarn/types/origin_types.hpp"
-@@ -68,6 +70,8 @@ public:
-         const std::unordered_map<std::string, dogen::yarn::primitive>& primitives,
-         const std::unordered_map<std::string, dogen::yarn::enumeration>& enumerations,
-         const std::unordered_map<std::string, dogen::yarn::object>& objects,
-+        const std::unordered_map<std::string, dogen::yarn::exception>& exceptions,
-+        const std::unordered_map<std::string, dogen::yarn::visitor>& visitors,
-         const bool is_target,
-         const bool has_generatable_types);
- 
-@@ -189,6 +193,26 @@ public:
-     /**@}*/
- 
-     /**
-+     * @brief All exceptions in this model.
-+     */
-+    /**@{*/
-+    const std::unordered_map<std::string, dogen::yarn::exception>& exceptions() const;
-+    std::unordered_map<std::string, dogen::yarn::exception>& exceptions();
-+    void exceptions(const std::unordered_map<std::string, dogen::yarn::exception>& v);
-+    void exceptions(const std::unordered_map<std::string, dogen::yarn::exception>&& v);
-+    /**@}*/
-+
-+    /**
-+     * @brief All visitors in this model.
-+     */
-+    /**@{*/
-+    const std::unordered_map<std::string, dogen::yarn::visitor>& visitors() const;
-+    std::unordered_map<std::string, dogen::yarn::visitor>& visitors();
-+    void visitors(const std::unordered_map<std::string, dogen::yarn::visitor>& v);
-+    void visitors(const std::unordered_map<std::string, dogen::yarn::visitor>&& v);
-+    /**@}*/
-+
-+    /**
-      * @brief If true, this intermediate model is the target model.
-      */
-     /**@{*/
-@@ -226,6 +250,8 @@ private:
-     std::unordered_map<std::string, dogen::yarn::primitive> primitives_;
-     std::unordered_map<std::string, dogen::yarn::enumeration> enumerations_;
-     std::unordered_map<std::string, dogen::yarn::object> objects_;
-+    std::unordered_map<std::string, dogen::yarn::exception> exceptions_;
-+    std::unordered_map<std::string, dogen::yarn::visitor> visitors_;
-     bool is_target_;
-     bool has_generatable_types_;
- };
-diff --git a/projects/yarn/include/dogen/yarn/types/object.hpp b/projects/yarn/include/dogen/yarn/types/object.hpp
-index 27dc79c..ae59ba3 100644
---- a/projects/yarn/include/dogen/yarn/types/object.hpp
-+++ b/projects/yarn/include/dogen/yarn/types/object.hpp
-@@ -77,8 +77,7 @@ public:
-         const std::list<dogen::yarn::name>& weak_associations,
-         const bool is_visitable,
-         const bool is_root_parent_visitable,
--        const std::list<dogen::yarn::name>& visits,
--        const std::list<dogen::yarn::name>& visited_by,
-+        const std::list<dogen::yarn::name>& visitable_by,
-         const dogen::yarn::object_types object_type,
-         const std::list<dogen::yarn::name>& modeled_concepts,
-         const std::list<dogen::yarn::name>& hash_container_keys);
-@@ -264,23 +263,13 @@ public:
-     /**@}*/
- 
-     /**
--     * @brief Elements that are visited by the visitor.
--     */
--    /**@{*/
--    const std::list<dogen::yarn::name>& visits() const;
--    std::list<dogen::yarn::name>& visits();
--    void visits(const std::list<dogen::yarn::name>& v);
--    void visits(const std::list<dogen::yarn::name>&& v);
--    /**@}*/
--
--    /**
-      * @brief Elements that visit current type.
-      */
-     /**@{*/
--    const std::list<dogen::yarn::name>& visited_by() const;
--    std::list<dogen::yarn::name>& visited_by();
--    void visited_by(const std::list<dogen::yarn::name>& v);
--    void visited_by(const std::list<dogen::yarn::name>&& v);
-+    const std::list<dogen::yarn::name>& visitable_by() const;
-+    std::list<dogen::yarn::name>& visitable_by();
-+    void visitable_by(const std::list<dogen::yarn::name>& v);
-+    void visitable_by(const std::list<dogen::yarn::name>&& v);
-     /**@}*/
- 
-     /**
-@@ -340,8 +329,7 @@ private:
-     std::list<dogen::yarn::name> weak_associations_;
-     bool is_visitable_;
-     bool is_root_parent_visitable_;
--    std::list<dogen::yarn::name> visits_;
--    std::list<dogen::yarn::name> visited_by_;
-+    std::list<dogen::yarn::name> visitable_by_;
-     dogen::yarn::object_types object_type_;
-     std::list<dogen::yarn::name> modeled_concepts_;
-     std::list<dogen::yarn::name> hash_container_keys_;
-diff --git a/projects/yarn/include/dogen/yarn/types/object_types.hpp b/projects/yarn/include/dogen/yarn/types/object_types.hpp
-index da5f964..afe5b86 100644
---- a/projects/yarn/include/dogen/yarn/types/object_types.hpp
-+++ b/projects/yarn/include/dogen/yarn/types/object_types.hpp
-@@ -37,13 +37,11 @@ namespace yarn {
- enum class object_types : unsigned int {
-     invalid = 0, ///< Represents an uninitialised enum
-     user_defined_service = 1, ///< The service has been defined by the user.
--    visitor = 2, ///< The service is a system generated visitor.
--    user_defined_value_object = 3, ///< Regular value object with no distinguishing features.
--    exception = 4, ///< Value represents an exception type.
--    smart_pointer = 5, ///< Value is a smart pointer.
--    hash_container = 6, ///< Type is a hash-based container.
--    sequence_container = 7, ///< Type is a sequence container.
--    ordered_container = 8 ///< Type is a ordered container.
-+    user_defined_value_object = 2, ///< Regular value object with no distinguishing features.
-+    smart_pointer = 3, ///< Value is a smart pointer.
-+    hash_container = 4, ///< Type is a hash-based container.
-+    sequence_container = 5, ///< Type is a sequence container.
-+    ordered_container = 6 ///< Type is a ordered container.
- };
- 
- } }
-diff --git a/projects/yarn/include/dogen/yarn/types/visitor.hpp b/projects/yarn/include/dogen/yarn/types/visitor.hpp
-index 7c58154..100f31b 100644
---- a/projects/yarn/include/dogen/yarn/types/visitor.hpp
-+++ b/projects/yarn/include/dogen/yarn/types/visitor.hpp
-@@ -25,8 +25,10 @@
- #pragma once
- #endif
- 
-+#include <list>
- #include <iosfwd>
- #include <algorithm>
-+#include "dogen/yarn/types/name.hpp"
- #include "dogen/yarn/types/element.hpp"
- #include "dogen/yarn/serialization/visitor_fwd_ser.hpp"
- 
-@@ -50,7 +52,8 @@ public:
-         const dogen::yarn::origin_types origin_type,
-         const std::string& original_model_name,
-         const boost::optional<dogen::yarn::name>& contained_by,
--        const bool in_global_module);
-+        const bool in_global_module,
-+        const std::list<dogen::yarn::name>& visits);
- 
- private:
-     template<typename Archive>
-@@ -80,6 +83,17 @@ public:
-     void to_stream(std::ostream& s) const override;
- 
- public:
-+    /**
-+     * @brief Elements that are visitable by the visitor.
-+     */
-+    /**@{*/
-+    const std::list<dogen::yarn::name>& visits() const;
-+    std::list<dogen::yarn::name>& visits();
-+    void visits(const std::list<dogen::yarn::name>& v);
-+    void visits(const std::list<dogen::yarn::name>&& v);
-+    /**@}*/
-+
-+public:
-     bool operator==(const visitor& rhs) const;
-     bool operator!=(const visitor& rhs) const {
-         return !this->operator==(rhs);
-@@ -92,6 +106,8 @@ public:
-     void swap(visitor& other) noexcept;
-     visitor& operator=(visitor other);
- 
-+private:
-+    std::list<dogen::yarn::name> visits_;
- };
- 
- } }
-diff --git a/projects/yarn/src/hash/intermediate_model_hash.cpp b/projects/yarn/src/hash/intermediate_model_hash.cpp
-index 7a1b13d..61db4d2 100644
---- a/projects/yarn/src/hash/intermediate_model_hash.cpp
-+++ b/projects/yarn/src/hash/intermediate_model_hash.cpp
-@@ -22,6 +22,8 @@
- #include "dogen/yarn/hash/module_hash.hpp"
- #include "dogen/yarn/hash/object_hash.hpp"
- #include "dogen/yarn/hash/concept_hash.hpp"
-+#include "dogen/yarn/hash/visitor_hash.hpp"
-+#include "dogen/yarn/hash/exception_hash.hpp"
- #include "dogen/yarn/hash/primitive_hash.hpp"
- #include "dogen/yarn/hash/enumeration_hash.hpp"
- #include "dogen/yarn/hash/origin_types_hash.hpp"
-@@ -98,6 +100,24 @@ inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_object(const std
-     return seed;
- }
- 
-+inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_exception(const std::unordered_map<std::string, dogen::yarn::exception>& v) {
-+    std::size_t seed(0);
-+    for (const auto i : v) {
-+        combine(seed, i.first);
-+        combine(seed, i.second);
-+    }
-+    return seed;
-+}
-+
-+inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_visitor(const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
-+    std::size_t seed(0);
-+    for (const auto i : v) {
-+        combine(seed, i.first);
-+        combine(seed, i.second);
-+    }
-+    return seed;
-+}
-+
- }
- 
- namespace dogen {
-@@ -117,6 +137,8 @@ std::size_t intermediate_model_hasher::hash(const intermediate_model& v) {
-     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_primitive(v.primitives()));
-     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_enumeration(v.enumerations()));
-     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_object(v.objects()));
-+    combine(seed, hash_std_unordered_map_std_string_dogen_yarn_exception(v.exceptions()));
-+    combine(seed, hash_std_unordered_map_std_string_dogen_yarn_visitor(v.visitors()));
-     combine(seed, v.is_target());
-     combine(seed, v.has_generatable_types());
- 
-diff --git a/projects/yarn/src/hash/object_hash.cpp b/projects/yarn/src/hash/object_hash.cpp
-index 183ca28..1f7a5dd 100644
---- a/projects/yarn/src/hash/object_hash.cpp
-+++ b/projects/yarn/src/hash/object_hash.cpp
-@@ -82,8 +82,7 @@ std::size_t object_hasher::hash(const object& v) {
-     combine(seed, hash_std_list_dogen_yarn_name(v.weak_associations()));
-     combine(seed, v.is_visitable());
-     combine(seed, v.is_root_parent_visitable());
--    combine(seed, hash_std_list_dogen_yarn_name(v.visits()));
--    combine(seed, hash_std_list_dogen_yarn_name(v.visited_by()));
-+    combine(seed, hash_std_list_dogen_yarn_name(v.visitable_by()));
-     combine(seed, v.object_type());
-     combine(seed, hash_std_list_dogen_yarn_name(v.modeled_concepts()));
-     combine(seed, hash_std_list_dogen_yarn_name(v.hash_container_keys()));
-diff --git a/projects/yarn/src/hash/visitor_hash.cpp b/projects/yarn/src/hash/visitor_hash.cpp
-index 500338f..9d623e4 100644
---- a/projects/yarn/src/hash/visitor_hash.cpp
-+++ b/projects/yarn/src/hash/visitor_hash.cpp
-@@ -18,6 +18,7 @@
-  * MA 02110-1301, USA.
-  *
-  */
-+#include "dogen/yarn/hash/name_hash.hpp"
- #include "dogen/yarn/hash/element_hash.hpp"
- #include "dogen/yarn/hash/visitor_hash.hpp"
- 
-@@ -29,6 +30,14 @@ inline void combine(std::size_t& seed, const HashableType& value) {
-     seed ^= hasher(value) + 0x9e3779b9 + (seed << 6) + (seed >> 2);
- }
- 
-+inline std::size_t hash_std_list_dogen_yarn_name(const std::list<dogen::yarn::name>& v) {
-+    std::size_t seed(0);
-+    for (const auto i : v) {
-+        combine(seed, i);
-+    }
-+    return seed;
-+}
-+
- }
- 
- namespace dogen {
-@@ -38,6 +47,8 @@ std::size_t visitor_hasher::hash(const visitor& v) {
-     std::size_t seed(0);
- 
-     combine(seed, dynamic_cast<const dogen::yarn::element&>(v));
-+
-+    combine(seed, hash_std_list_dogen_yarn_name(v.visits()));
-     return seed;
- }
- 
-diff --git a/projects/yarn/src/io/intermediate_model_io.cpp b/projects/yarn/src/io/intermediate_model_io.cpp
-index 01ecf4b..b864b48 100644
---- a/projects/yarn/src/io/intermediate_model_io.cpp
-+++ b/projects/yarn/src/io/intermediate_model_io.cpp
-@@ -25,6 +25,8 @@
- #include "dogen/yarn/io/module_io.hpp"
- #include "dogen/yarn/io/object_io.hpp"
- #include "dogen/yarn/io/concept_io.hpp"
-+#include "dogen/yarn/io/visitor_io.hpp"
-+#include "dogen/yarn/io/exception_io.hpp"
- #include "dogen/yarn/io/primitive_io.hpp"
- #include "dogen/yarn/io/enumeration_io.hpp"
- #include "dogen/yarn/io/origin_types_io.hpp"
-@@ -160,6 +162,42 @@ inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::s
- 
- }
- 
-+namespace std {
-+
-+inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::string, dogen::yarn::exception>& v) {
-+    s << "[";
-+    for (auto i(v.begin()); i != v.end(); ++i) {
-+        if (i != v.begin()) s << ", ";
-+        s << "[ { " << "\"__type__\": " << "\"key\"" << ", " << "\"data\": ";
-+        s << "\"" << tidy_up_string(i->first) << "\"";
-+        s << " }, { " << "\"__type__\": " << "\"value\"" << ", " << "\"data\": ";
-+        s << i->second;
-+        s << " } ]";
-+    }
-+    s << " ] ";
-+    return s;
-+}
-+
-+}
-+
-+namespace std {
-+
-+inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
-+    s << "[";
-+    for (auto i(v.begin()); i != v.end(); ++i) {
-+        if (i != v.begin()) s << ", ";
-+        s << "[ { " << "\"__type__\": " << "\"key\"" << ", " << "\"data\": ";
-+        s << "\"" << tidy_up_string(i->first) << "\"";
-+        s << " }, { " << "\"__type__\": " << "\"value\"" << ", " << "\"data\": ";
-+        s << i->second;
-+        s << " } ]";
-+    }
-+    s << " ] ";
-+    return s;
-+}
-+
-+}
-+
- namespace dogen {
- namespace yarn {
- 
-@@ -183,6 +221,8 @@ std::ostream& operator<<(std::ostream& s, const intermediate_model& v) {
-       << "\"primitives\": " << v.primitives() << ", "
-       << "\"enumerations\": " << v.enumerations() << ", "
-       << "\"objects\": " << v.objects() << ", "
-+      << "\"exceptions\": " << v.exceptions() << ", "
-+      << "\"visitors\": " << v.visitors() << ", "
-       << "\"is_target\": " << v.is_target() << ", "
-       << "\"has_generatable_types\": " << v.has_generatable_types()
-       << " }";
-diff --git a/projects/yarn/src/io/object_types_io.cpp b/projects/yarn/src/io/object_types_io.cpp
-index fdcc533..cde9da8 100644
---- a/projects/yarn/src/io/object_types_io.cpp
-+++ b/projects/yarn/src/io/object_types_io.cpp
-@@ -37,15 +37,9 @@ std::ostream& operator<<(std::ostream& s, const object_types& v) {
-     case object_types::user_defined_service:
-         attr = "\"user_defined_service\"";
-         break;
--    case object_types::visitor:
--        attr = "\"visitor\"";
--        break;
-     case object_types::user_defined_value_object:
-         attr = "\"user_defined_value_object\"";
-         break;
--    case object_types::exception:
--        attr = "\"exception\"";
--        break;
-     case object_types::smart_pointer:
-         attr = "\"smart_pointer\"";
-         break;
-diff --git a/projects/yarn/src/io/visitor_io.cpp b/projects/yarn/src/io/visitor_io.cpp
-index bb791dc..3b4460b 100644
---- a/projects/yarn/src/io/visitor_io.cpp
-+++ b/projects/yarn/src/io/visitor_io.cpp
-@@ -19,6 +19,7 @@
-  *
-  */
- #include <ostream>
-+#include "dogen/yarn/io/name_io.hpp"
- #include "dogen/yarn/io/element_io.hpp"
- #include "dogen/yarn/io/visitor_io.hpp"
- 
-diff --git a/projects/yarn/src/serialization/intermediate_model_ser.cpp b/projects/yarn/src/serialization/intermediate_model_ser.cpp
-index 6c05dbd..6ff2886 100644
---- a/projects/yarn/src/serialization/intermediate_model_ser.cpp
-+++ b/projects/yarn/src/serialization/intermediate_model_ser.cpp
-@@ -32,6 +32,8 @@
- #include "dogen/yarn/serialization/module_ser.hpp"
- #include "dogen/yarn/serialization/object_ser.hpp"
- #include "dogen/yarn/serialization/concept_ser.hpp"
-+#include "dogen/yarn/serialization/visitor_ser.hpp"
-+#include "dogen/yarn/serialization/exception_ser.hpp"
- #include "dogen/yarn/serialization/primitive_ser.hpp"
- #include "dogen/yarn/serialization/enumeration_ser.hpp"
- #include "dogen/utility/serialization/unordered_map.hpp"
-@@ -58,6 +60,8 @@ void save(Archive& ar,
-     ar << make_nvp("primitives", v.primitives_);
-     ar << make_nvp("enumerations", v.enumerations_);
-     ar << make_nvp("objects", v.objects_);
-+    ar << make_nvp("exceptions", v.exceptions_);
-+    ar << make_nvp("visitors", v.visitors_);
-     ar << make_nvp("is_target", v.is_target_);
-     ar << make_nvp("has_generatable_types", v.has_generatable_types_);
- }
-@@ -77,6 +81,8 @@ void load(Archive& ar,
-     ar >> make_nvp("primitives", v.primitives_);
-     ar >> make_nvp("enumerations", v.enumerations_);
-     ar >> make_nvp("objects", v.objects_);
-+    ar >> make_nvp("exceptions", v.exceptions_);
-+    ar >> make_nvp("visitors", v.visitors_);
-     ar >> make_nvp("is_target", v.is_target_);
-     ar >> make_nvp("has_generatable_types", v.has_generatable_types_);
- }
-diff --git a/projects/yarn/src/serialization/object_ser.cpp b/projects/yarn/src/serialization/object_ser.cpp
-index 2de37cf..640fe4f 100644
---- a/projects/yarn/src/serialization/object_ser.cpp
-+++ b/projects/yarn/src/serialization/object_ser.cpp
-@@ -63,8 +63,7 @@ void save(Archive& ar,
-     ar << make_nvp("weak_associations", v.weak_associations_);
-     ar << make_nvp("is_visitable", v.is_visitable_);
-     ar << make_nvp("is_root_parent_visitable", v.is_root_parent_visitable_);
--    ar << make_nvp("visits", v.visits_);
--    ar << make_nvp("visited_by", v.visited_by_);
-+    ar << make_nvp("visitable_by", v.visitable_by_);
-     ar << make_nvp("object_type", v.object_type_);
-     ar << make_nvp("modeled_concepts", v.modeled_concepts_);
-     ar << make_nvp("hash_container_keys", v.hash_container_keys_);
-@@ -91,8 +90,7 @@ void load(Archive& ar,
-     ar >> make_nvp("weak_associations", v.weak_associations_);
-     ar >> make_nvp("is_visitable", v.is_visitable_);
-     ar >> make_nvp("is_root_parent_visitable", v.is_root_parent_visitable_);
--    ar >> make_nvp("visits", v.visits_);
--    ar >> make_nvp("visited_by", v.visited_by_);
-+    ar >> make_nvp("visitable_by", v.visitable_by_);
-     ar >> make_nvp("object_type", v.object_type_);
-     ar >> make_nvp("modeled_concepts", v.modeled_concepts_);
-     ar >> make_nvp("hash_container_keys", v.hash_container_keys_);
-diff --git a/projects/yarn/src/serialization/visitor_ser.cpp b/projects/yarn/src/serialization/visitor_ser.cpp
-index 866063c..7b82af7 100644
---- a/projects/yarn/src/serialization/visitor_ser.cpp
-+++ b/projects/yarn/src/serialization/visitor_ser.cpp
-@@ -19,6 +19,7 @@
-  *
-  */
- #include <boost/serialization/nvp.hpp>
-+#include <boost/serialization/list.hpp>
- #include <boost/archive/xml_iarchive.hpp>
- #include <boost/archive/xml_oarchive.hpp>
- #include <boost/archive/text_iarchive.hpp>
-@@ -27,6 +28,7 @@
- #include <boost/archive/binary_oarchive.hpp>
- #include <boost/archive/polymorphic_iarchive.hpp>
- #include <boost/archive/polymorphic_oarchive.hpp>
-+#include "dogen/yarn/serialization/name_ser.hpp"
- #include "dogen/yarn/serialization/element_ser.hpp"
- #include "dogen/yarn/serialization/visitor_ser.hpp"
- 
-@@ -42,6 +44,8 @@ void save(Archive& ar,
-     const dogen::yarn::visitor& v,
-     const unsigned int /*version*/) {
-     ar << make_nvp("element", base_object<dogen::yarn::element>(v));
-+
-+    ar << make_nvp("visits", v.visits_);
- }
- 
- template<typename Archive>
-@@ -49,6 +53,8 @@ void load(Archive& ar,
-     dogen::yarn::visitor& v,
-     const unsigned int /*version*/) {
-     ar >> make_nvp("element", base_object<dogen::yarn::element>(v));
-+
-+    ar >> make_nvp("visits", v.visits_);
- }
- 
- } }
-diff --git a/projects/yarn/src/test/mock_intermediate_model_factory.cpp b/projects/yarn/src/test/mock_intermediate_model_factory.cpp
-index a747bee..e8beccf 100644
---- a/projects/yarn/src/test/mock_intermediate_model_factory.cpp
-+++ b/projects/yarn/src/test/mock_intermediate_model_factory.cpp
-@@ -541,7 +541,7 @@ make_enumeration(const unsigned int i, const name& model_name,
-     return r;
- }
- 
--object mock_intermediate_model_factory::make_exception(const unsigned int i,
-+exception mock_intermediate_model_factory::make_exception(const unsigned int i,
-     const name& model_name, const unsigned int module_n) const {
- 
-     const auto sn(type_name(i));
-@@ -550,11 +550,10 @@ object mock_intermediate_model_factory::make_exception(const unsigned int i,
-     dogen::yarn::name_factory nf;
-     dogen::yarn::name n(nf.build_element_in_model(model_name, sn, ipp));
- 
--    object r;
-+    exception r;
-     r.name(n);
-     r.generation_type(generation_types::full_generation);
-     r.documentation(documentation);
--    r.object_type(dogen::yarn::object_types::exception);
- 
-     if (flags_.tagged())
-         dynamic_extension_function_(r.extensions());
-@@ -646,7 +645,7 @@ make_multi_type_model(const unsigned int n, const unsigned int type_n,
-     case object_types::exception:
-         for (unsigned int i(0); i < type_n; ++i) {
-             const auto e(make_exception(i, r.name(), mod_n));
--            insert_object(r, e);
-+            insert_nameable(r.exceptions(), e);
-         }
-         break;
-     default:
-diff --git a/projects/yarn/src/test_data/intermediate_model_td.cpp b/projects/yarn/src/test_data/intermediate_model_td.cpp
-index 28c2316..60076b1 100644
---- a/projects/yarn/src/test_data/intermediate_model_td.cpp
-+++ b/projects/yarn/src/test_data/intermediate_model_td.cpp
-@@ -23,6 +23,8 @@
- #include "dogen/yarn/test_data/module_td.hpp"
- #include "dogen/yarn/test_data/object_td.hpp"
- #include "dogen/yarn/test_data/concept_td.hpp"
-+#include "dogen/yarn/test_data/visitor_td.hpp"
-+#include "dogen/yarn/test_data/exception_td.hpp"
- #include "dogen/yarn/test_data/primitive_td.hpp"
- #include "dogen/yarn/test_data/enumeration_td.hpp"
- #include "dogen/yarn/test_data/origin_types_td.hpp"
-@@ -133,6 +135,32 @@ std::unordered_map<std::string, dogen::yarn::object> create_std_unordered_map_st
-     return r;
- }
- 
-+dogen::yarn::exception
-+create_dogen_yarn_exception(const unsigned int position) {
-+    return dogen::yarn::exception_generator::create(position);
-+}
-+
-+std::unordered_map<std::string, dogen::yarn::exception> create_std_unordered_map_std_string_dogen_yarn_exception(unsigned int position) {
-+    std::unordered_map<std::string, dogen::yarn::exception> r;
-+    for (unsigned int i(0); i < 4; ++i) {
-+        r.insert(std::make_pair(create_std_string(position + i), create_dogen_yarn_exception(position + i)));
-+    }
-+    return r;
-+}
-+
-+dogen::yarn::visitor
-+create_dogen_yarn_visitor(const unsigned int position) {
-+    return dogen::yarn::visitor_generator::create(position);
-+}
-+
-+std::unordered_map<std::string, dogen::yarn::visitor> create_std_unordered_map_std_string_dogen_yarn_visitor(unsigned int position) {
-+    std::unordered_map<std::string, dogen::yarn::visitor> r;
-+    for (unsigned int i(0); i < 4; ++i) {
-+        r.insert(std::make_pair(create_std_string(position + i), create_dogen_yarn_visitor(position + i)));
-+    }
-+    return r;
-+}
-+
- bool create_bool(const unsigned int position) {
-     return (position % 2) == 0;
- }
-@@ -157,8 +185,10 @@ populate(const unsigned int position, result_type& v) {
-     v.primitives(create_std_unordered_map_std_string_dogen_yarn_primitive(position + 8));
-     v.enumerations(create_std_unordered_map_std_string_dogen_yarn_enumeration(position + 9));
-     v.objects(create_std_unordered_map_std_string_dogen_yarn_object(position + 10));
--    v.is_target(create_bool(position + 11));
--    v.has_generatable_types(create_bool(position + 12));
-+    v.exceptions(create_std_unordered_map_std_string_dogen_yarn_exception(position + 11));
-+    v.visitors(create_std_unordered_map_std_string_dogen_yarn_visitor(position + 12));
-+    v.is_target(create_bool(position + 13));
-+    v.has_generatable_types(create_bool(position + 14));
- }
- 
- intermediate_model_generator::result_type
-diff --git a/projects/yarn/src/test_data/object_td.cpp b/projects/yarn/src/test_data/object_td.cpp
-index 4f70aca..c0857c4 100644
---- a/projects/yarn/src/test_data/object_td.cpp
-+++ b/projects/yarn/src/test_data/object_td.cpp
-@@ -94,11 +94,10 @@ populate(const unsigned int position, result_type& v) {
-     v.weak_associations(create_std_list_dogen_yarn_name(position + 12));
-     v.is_visitable(create_bool(position + 13));
-     v.is_root_parent_visitable(create_bool(position + 14));
--    v.visits(create_std_list_dogen_yarn_name(position + 15));
--    v.visited_by(create_std_list_dogen_yarn_name(position + 16));
--    v.object_type(create_dogen_yarn_object_types(position + 17));
--    v.modeled_concepts(create_std_list_dogen_yarn_name(position + 18));
--    v.hash_container_keys(create_std_list_dogen_yarn_name(position + 19));
-+    v.visitable_by(create_std_list_dogen_yarn_name(position + 15));
-+    v.object_type(create_dogen_yarn_object_types(position + 16));
-+    v.modeled_concepts(create_std_list_dogen_yarn_name(position + 17));
-+    v.hash_container_keys(create_std_list_dogen_yarn_name(position + 18));
- }
- 
- object_generator::result_type
-diff --git a/projects/yarn/src/test_data/object_types_td.cpp b/projects/yarn/src/test_data/object_types_td.cpp
-index 2aae707..ed8395a 100644
---- a/projects/yarn/src/test_data/object_types_td.cpp
-+++ b/projects/yarn/src/test_data/object_types_td.cpp
-@@ -26,7 +26,7 @@ namespace yarn {
- object_types_generator::object_types_generator() : position_(0) { }
- void object_types_generator::
- populate(const unsigned int position, result_type& v) {
--    v = static_cast<object_types>(position % 9);
-+    v = static_cast<object_types>(position % 7);
- }
- 
- object_types_generator::result_type
-diff --git a/projects/yarn/src/test_data/visitor_td.cpp b/projects/yarn/src/test_data/visitor_td.cpp
-index 7cec9fd..cf2f1bc 100644
---- a/projects/yarn/src/test_data/visitor_td.cpp
-+++ b/projects/yarn/src/test_data/visitor_td.cpp
-@@ -18,9 +18,27 @@
-  * MA 02110-1301, USA.
-  *
-  */
-+#include "dogen/yarn/test_data/name_td.hpp"
- #include "dogen/yarn/test_data/element_td.hpp"
- #include "dogen/yarn/test_data/visitor_td.hpp"
- 
-+namespace {
-+
-+dogen::yarn::name
-+create_dogen_yarn_name(const unsigned int position) {
-+    return dogen::yarn::name_generator::create(position);
-+}
-+
-+std::list<dogen::yarn::name> create_std_list_dogen_yarn_name(unsigned int position) {
-+    std::list<dogen::yarn::name> r;
-+    for (unsigned int i(0); i < 4; ++i) {
-+        r.push_back(create_dogen_yarn_name(position + i));
-+    }
-+    return r;
-+}
-+
-+}
-+
- namespace dogen {
- namespace yarn {
- 
-@@ -29,6 +47,7 @@ visitor_generator::visitor_generator() : position_(0) { }
- void visitor_generator::
- populate(const unsigned int position, result_type& v) {
-     dogen::yarn::element_generator::populate(position, v);
-+    v.visits(create_std_list_dogen_yarn_name(position + 0));
- }
- 
- visitor_generator::result_type
-diff --git a/projects/yarn/src/types/injector.cpp b/projects/yarn/src/types/injector.cpp
-index 0591859..8edb006 100644
---- a/projects/yarn/src/types/injector.cpp
-+++ b/projects/yarn/src/types/injector.cpp
-@@ -73,25 +73,17 @@ inline void add_containing_module_to_non_contained_entities(
-     }
- }
- 
--class injector::context {
--public:
--    context(yarn::intermediate_model& m) : model_(m) { }
--
--public:
--    yarn::intermediate_model& model() { return model_; }
--
--private:
--    yarn::intermediate_model& model_;
--};
--
--bool injector::insert(const object& o) {
--    const auto i(context_->model().objects().insert(
--            std::make_pair(o.name().qualified(), o)));
--
--    return i.second;
-+module injector::create_global_module() const {
-+    name qn;
-+    module r;
-+    r.name(qn);
-+    r.generation_type(generation_types::no_generation);
-+    r.origin_type(origin_types::system);
-+    r.documentation(global_module_doc);
-+    return r;
- }
- 
--object injector::
-+visitor injector::
- create_visitor(const object& o, const std::list<name>& leaves) const {
-     name_builder b;
-     b.simple_name(o.name().simple() + "_" + visitor_name);
-@@ -109,12 +101,10 @@ create_visitor(const object& o, const std::list<name>& leaves) const {
-     const auto n(b.build());
-     BOOST_LOG_SEV(lg, debug) << "Creating visitor: " << n.qualified();
- 
--    object r;
-+    visitor r;
-     r.name(n);
--    r.is_final(true);
-     r.generation_type(o.generation_type());
-     r.origin_type(origin_types::system);
--    r.object_type(object_types::visitor);
-     r.documentation(visitor_doc + o.name().simple());
- 
-     for (const auto& l : leaves)
-@@ -124,29 +114,29 @@ create_visitor(const object& o, const std::list<name>& leaves) const {
-     return r;
- }
- 
--void injector::inject_visited_by(object& root, const std::list<name>& leaves,
--    const name& visitor) const {
-+void injector::inject_visitable_by(object& root, const std::list<name>& leaves,
-+    const name& visitor, intermediate_model& m) const {
- 
--    root.visited_by().push_back(visitor);
-+    root.visitable_by().push_back(visitor);
- 
-     for (const auto& l : leaves) {
--        auto i(context_->model().objects().find(l.qualified()));
--        if (i == context_->model().objects().end()) {
-+        auto i(m.objects().find(l.qualified()));
-+        if (i == m.objects().end()) {
-             const auto qn(l.qualified());
-             BOOST_LOG_SEV(lg, error) << leaf_not_found << qn;
-             BOOST_THROW_EXCEPTION(injection_error(leaf_not_found + qn));
-         }
- 
-         auto& leaf(i->second);
--        leaf.visited_by().push_back(visitor);
-+        leaf.visitable_by().push_back(visitor);
-     }
- }
- 
--void injector::inject_visitors() {
-+void injector::inject_visitors(intermediate_model& m) {
-     BOOST_LOG_SEV(lg, debug) << "Injecting visitors.";
- 
--    std::list<object> visitors;
--    for (auto& pair : context_->model().objects()) {
-+    std::list<visitor> visitors;
-+    for (auto& pair : m.objects()) {
-         auto& o(pair.second);
- 
-         if (!o.is_visitable())
-@@ -159,15 +149,17 @@ void injector::inject_visitors() {
-         }
- 
-         const auto v(create_visitor(o, o.leaves()));
-+        inject_visitable_by(o, o.leaves(), v.name(), m);
-         visitors.push_back(v);
--        inject_visited_by(o, o.leaves(), v.name());
-     }
- 
-     for (const auto v : visitors) {
-         BOOST_LOG_SEV(lg, debug) << "Adding visitor: "
-                                  << v.name().qualified();
- 
--        if (!insert(v)) {
-+        const auto pair(std::make_pair(v.name().qualified(), v));
-+        const auto i(m.visitors().insert(pair));
-+        if (!i.second) {
-             const auto qn(v.name().qualified());
-             BOOST_LOG_SEV(lg, error) << duplicate_name << qn;
-             BOOST_THROW_EXCEPTION(injection_error(duplicate_name + qn));
-@@ -177,37 +169,31 @@ void injector::inject_visitors() {
-     BOOST_LOG_SEV(lg, debug) << "Done injecting visitors.";
- }
- 
--void injector::inject_global_module() {
--    name qn;
-+void injector::inject_global_module(intermediate_model& m) {
-+    const auto gm(create_global_module());
- 
--    auto& model(context_->model());
--    const auto i(model.modules().find(qn.qualified()));
--    if (i != model.modules().end()) {
--        const auto qn(model.name().qualified());
-+    const auto gmn(gm.name());
-+    const auto i(m.modules().find(gmn.qualified()));
-+    if (i != m.modules().end()) {
-+        const auto qn(m.name().qualified());
-         BOOST_LOG_SEV(lg, error) << model_already_has_global_module << qn;
-         BOOST_THROW_EXCEPTION(injection_error(
-                 model_already_has_global_module + qn));
-     }
--
--    add_containing_module_to_non_contained_entities(qn, model.modules());
--    add_containing_module_to_non_contained_entities(qn, model.concepts());
--    add_containing_module_to_non_contained_entities(qn, model.primitives());
--    add_containing_module_to_non_contained_entities(qn, model.enumerations());
--    add_containing_module_to_non_contained_entities(qn, model.objects());
--
--    module global_module;
--    global_module.name(qn);
--    global_module.generation_type(generation_types::no_generation);
--    global_module.origin_type(origin_types::system);
--    global_module.documentation(global_module_doc);
--    model.modules().insert(std::make_pair(qn.qualified(), global_module));
-+    m.modules().insert(std::make_pair(gmn.qualified(), gm));
-+
-+    add_containing_module_to_non_contained_entities(gmn, m.modules());
-+    add_containing_module_to_non_contained_entities(gmn, m.concepts());
-+    add_containing_module_to_non_contained_entities(gmn, m.primitives());
-+    add_containing_module_to_non_contained_entities(gmn, m.enumerations());
-+    add_containing_module_to_non_contained_entities(gmn, m.objects());
-+    add_containing_module_to_non_contained_entities(gmn, m.exceptions());
-+    add_containing_module_to_non_contained_entities(gmn, m.visitors());
- }
- 
- void injector::inject(intermediate_model& m) {
--    context_ = std::unique_ptr<context>(new context(m));
--    inject_visitors();
--    inject_global_module();
--    context_ = std::unique_ptr<context>();
-+    inject_visitors(m);
-+    inject_global_module(m);
- }
- 
- } }
-diff --git a/projects/yarn/src/types/intermediate_model.cpp b/projects/yarn/src/types/intermediate_model.cpp
-index a0d6b23..8e3e10c 100644
---- a/projects/yarn/src/types/intermediate_model.cpp
-+++ b/projects/yarn/src/types/intermediate_model.cpp
-@@ -41,6 +41,8 @@ intermediate_model::intermediate_model(
-     const std::unordered_map<std::string, dogen::yarn::primitive>& primitives,
-     const std::unordered_map<std::string, dogen::yarn::enumeration>& enumerations,
-     const std::unordered_map<std::string, dogen::yarn::object>& objects,
-+    const std::unordered_map<std::string, dogen::yarn::exception>& exceptions,
-+    const std::unordered_map<std::string, dogen::yarn::visitor>& visitors,
-     const bool is_target,
-     const bool has_generatable_types)
-     : name_(name),
-@@ -54,6 +56,8 @@ intermediate_model::intermediate_model(
-       primitives_(primitives),
-       enumerations_(enumerations),
-       objects_(objects),
-+      exceptions_(exceptions),
-+      visitors_(visitors),
-       is_target_(is_target),
-       has_generatable_types_(has_generatable_types) { }
- 
-@@ -70,6 +74,8 @@ void intermediate_model::swap(intermediate_model& other) noexcept {
-     swap(primitives_, other.primitives_);
-     swap(enumerations_, other.enumerations_);
-     swap(objects_, other.objects_);
-+    swap(exceptions_, other.exceptions_);
-+    swap(visitors_, other.visitors_);
-     swap(is_target_, other.is_target_);
-     swap(has_generatable_types_, other.has_generatable_types_);
- }
-@@ -86,6 +92,8 @@ bool intermediate_model::operator==(const intermediate_model& rhs) const {
-         primitives_ == rhs.primitives_ &&
-         enumerations_ == rhs.enumerations_ &&
-         objects_ == rhs.objects_ &&
-+        exceptions_ == rhs.exceptions_ &&
-+        visitors_ == rhs.visitors_ &&
-         is_target_ == rhs.is_target_ &&
-         has_generatable_types_ == rhs.has_generatable_types_;
- }
-@@ -256,6 +264,38 @@ void intermediate_model::objects(const std::unordered_map<std::string, dogen::ya
-     objects_ = std::move(v);
- }
- 
-+const std::unordered_map<std::string, dogen::yarn::exception>& intermediate_model::exceptions() const {
-+    return exceptions_;
-+}
-+
-+std::unordered_map<std::string, dogen::yarn::exception>& intermediate_model::exceptions() {
-+    return exceptions_;
-+}
-+
-+void intermediate_model::exceptions(const std::unordered_map<std::string, dogen::yarn::exception>& v) {
-+    exceptions_ = v;
-+}
-+
-+void intermediate_model::exceptions(const std::unordered_map<std::string, dogen::yarn::exception>&& v) {
-+    exceptions_ = std::move(v);
-+}
-+
-+const std::unordered_map<std::string, dogen::yarn::visitor>& intermediate_model::visitors() const {
-+    return visitors_;
-+}
-+
-+std::unordered_map<std::string, dogen::yarn::visitor>& intermediate_model::visitors() {
-+    return visitors_;
-+}
-+
-+void intermediate_model::visitors(const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
-+    visitors_ = v;
-+}
-+
-+void intermediate_model::visitors(const std::unordered_map<std::string, dogen::yarn::visitor>&& v) {
-+    visitors_ = std::move(v);
-+}
-+
- bool intermediate_model::is_target() const {
-     return is_target_;
- }
-diff --git a/projects/yarn/src/types/object.cpp b/projects/yarn/src/types/object.cpp
-index d62e4af..2c273fb 100644
---- a/projects/yarn/src/types/object.cpp
-+++ b/projects/yarn/src/types/object.cpp
-@@ -109,8 +109,7 @@ object::object(
-     const std::list<dogen::yarn::name>& weak_associations,
-     const bool is_visitable,
-     const bool is_root_parent_visitable,
--    const std::list<dogen::yarn::name>& visits,
--    const std::list<dogen::yarn::name>& visited_by,
-+    const std::list<dogen::yarn::name>& visitable_by,
-     const dogen::yarn::object_types object_type,
-     const std::list<dogen::yarn::name>& modeled_concepts,
-     const std::list<dogen::yarn::name>& hash_container_keys)
-@@ -138,8 +137,7 @@ object::object(
-       weak_associations_(weak_associations),
-       is_visitable_(is_visitable),
-       is_root_parent_visitable_(is_root_parent_visitable),
--      visits_(visits),
--      visited_by_(visited_by),
-+      visitable_by_(visitable_by),
-       object_type_(object_type),
-       modeled_concepts_(modeled_concepts),
-       hash_container_keys_(hash_container_keys) { }
-@@ -171,8 +169,7 @@ void object::to_stream(std::ostream& s) const {
-       << "\"weak_associations\": " << weak_associations_ << ", "
-       << "\"is_visitable\": " << is_visitable_ << ", "
-       << "\"is_root_parent_visitable\": " << is_root_parent_visitable_ << ", "
--      << "\"visits\": " << visits_ << ", "
--      << "\"visited_by\": " << visited_by_ << ", "
-+      << "\"visitable_by\": " << visitable_by_ << ", "
-       << "\"object_type\": " << object_type_ << ", "
-       << "\"modeled_concepts\": " << modeled_concepts_ << ", "
-       << "\"hash_container_keys\": " << hash_container_keys_
-@@ -198,8 +195,7 @@ void object::swap(object& other) noexcept {
-     swap(weak_associations_, other.weak_associations_);
-     swap(is_visitable_, other.is_visitable_);
-     swap(is_root_parent_visitable_, other.is_root_parent_visitable_);
--    swap(visits_, other.visits_);
--    swap(visited_by_, other.visited_by_);
-+    swap(visitable_by_, other.visitable_by_);
-     swap(object_type_, other.object_type_);
-     swap(modeled_concepts_, other.modeled_concepts_);
-     swap(hash_container_keys_, other.hash_container_keys_);
-@@ -228,8 +224,7 @@ bool object::operator==(const object& rhs) const {
-         weak_associations_ == rhs.weak_associations_ &&
-         is_visitable_ == rhs.is_visitable_ &&
-         is_root_parent_visitable_ == rhs.is_root_parent_visitable_ &&
--        visits_ == rhs.visits_ &&
--        visited_by_ == rhs.visited_by_ &&
-+        visitable_by_ == rhs.visitable_by_ &&
-         object_type_ == rhs.object_type_ &&
-         modeled_concepts_ == rhs.modeled_concepts_ &&
-         hash_container_keys_ == rhs.hash_container_keys_;
-@@ -425,36 +420,20 @@ void object::is_root_parent_visitable(const bool v) {
-     is_root_parent_visitable_ = v;
- }
- 
--const std::list<dogen::yarn::name>& object::visits() const {
--    return visits_;
-+const std::list<dogen::yarn::name>& object::visitable_by() const {
-+    return visitable_by_;
- }
- 
--std::list<dogen::yarn::name>& object::visits() {
--    return visits_;
-+std::list<dogen::yarn::name>& object::visitable_by() {
-+    return visitable_by_;
- }
- 
--void object::visits(const std::list<dogen::yarn::name>& v) {
--    visits_ = v;
-+void object::visitable_by(const std::list<dogen::yarn::name>& v) {
-+    visitable_by_ = v;
- }
- 
--void object::visits(const std::list<dogen::yarn::name>&& v) {
--    visits_ = std::move(v);
--}
--
--const std::list<dogen::yarn::name>& object::visited_by() const {
--    return visited_by_;
--}
--
--std::list<dogen::yarn::name>& object::visited_by() {
--    return visited_by_;
--}
--
--void object::visited_by(const std::list<dogen::yarn::name>& v) {
--    visited_by_ = v;
--}
--
--void object::visited_by(const std::list<dogen::yarn::name>&& v) {
--    visited_by_ = std::move(v);
-+void object::visitable_by(const std::list<dogen::yarn::name>&& v) {
-+    visitable_by_ = std::move(v);
- }
- 
- dogen::yarn::object_types object::object_type() const {
-diff --git a/projects/yarn/src/types/visitor.cpp b/projects/yarn/src/types/visitor.cpp
-index 39d9d6d..520bb63 100644
---- a/projects/yarn/src/types/visitor.cpp
-+++ b/projects/yarn/src/types/visitor.cpp
-@@ -19,9 +19,24 @@
-  *
-  */
- #include <ostream>
-+#include "dogen/yarn/io/name_io.hpp"
- #include "dogen/yarn/io/element_io.hpp"
- #include "dogen/yarn/types/visitor.hpp"
- 
-+namespace std {
-+
-+inline std::ostream& operator<<(std::ostream& s, const std::list<dogen::yarn::name>& v) {
-+    s << "[ ";
-+    for (auto i(v.begin()); i != v.end(); ++i) {
-+        if (i != v.begin()) s << ", ";
-+        s << *i;
-+    }
-+    s << "] ";
-+    return s;
-+}
-+
-+}
-+
- namespace dogen {
- namespace yarn {
- 
-@@ -33,7 +48,8 @@ visitor::visitor(
-     const dogen::yarn::origin_types origin_type,
-     const std::string& original_model_name,
-     const boost::optional<dogen::yarn::name>& contained_by,
--    const bool in_global_module)
-+    const bool in_global_module,
-+    const std::list<dogen::yarn::name>& visits)
-     : dogen::yarn::element(
-       documentation,
-       extensions,
-@@ -42,19 +58,24 @@ visitor::visitor(
-       origin_type,
-       original_model_name,
-       contained_by,
--      in_global_module) { }
-+      in_global_module),
-+      visits_(visits) { }
- 
- void visitor::to_stream(std::ostream& s) const {
-     s << " { "
-       << "\"__type__\": " << "\"dogen::yarn::visitor\"" << ", "
-       << "\"__parent_0__\": ";
-     element::to_stream(s);
--    s << " }";
-+    s << ", "
-+      << "\"visits\": " << visits_
-+      << " }";
- }
- 
- void visitor::swap(visitor& other) noexcept {
-     element::swap(other);
- 
-+    using std::swap;
-+    swap(visits_, other.visits_);
- }
- 
- bool visitor::equals(const dogen::yarn::element& other) const {
-@@ -64,7 +85,8 @@ bool visitor::equals(const dogen::yarn::element& other) const {
- }
- 
- bool visitor::operator==(const visitor& rhs) const {
--    return element::compare(rhs);
-+    return element::compare(rhs) &&
-+        visits_ == rhs.visits_;
- }
- 
- visitor& visitor::operator=(visitor other) {
-@@ -73,4 +95,20 @@ visitor& visitor::operator=(visitor other) {
-     return *this;
- }
- 
-+const std::list<dogen::yarn::name>& visitor::visits() const {
-+    return visits_;
-+}
-+
-+std::list<dogen::yarn::name>& visitor::visits() {
-+    return visits_;
-+}
-+
-+void visitor::visits(const std::list<dogen::yarn::name>& v) {
-+    visits_ = v;
-+}
-+
-+void visitor::visits(const std::list<dogen::yarn::name>&& v) {
-+    visits_ = std::move(v);
-+}
-+
- } }
diff --git a/projects/cpp/include/dogen/cpp/types/formattables/container.hpp b/projects/cpp/include/dogen/cpp/types/formattables/container.hpp
index 9d22692..fa17cc3 100644
--- a/projects/cpp/include/dogen/cpp/types/formattables/container.hpp
+++ b/projects/cpp/include/dogen/cpp/types/formattables/container.hpp
@@ -30,6 +30,8 @@
 #include "dogen/yarn/types/model.hpp"
 #include "dogen/yarn/types/object.hpp"
 #include "dogen/yarn/types/enumeration.hpp"
+#include "dogen/yarn/types/exception.hpp"
+#include "dogen/yarn/types/visitor.hpp"
 #include "dogen/cpp/types/formattables/inclusion_dependencies_provider_interface.hpp"
 
 namespace dogen {
@@ -68,6 +70,34 @@ public:
 
     const std::forward_list<
         boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::exception>
+            >
+        >&
+    exception_providers() const;
+
+    std::forward_list<
+        boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::exception>
+            >
+        >&
+    exception_providers();
+
+    const std::forward_list<
+        boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::visitor>
+            >
+        >&
+    visitor_providers() const;
+
+    std::forward_list<
+        boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::visitor>
+            >
+        >&
+    visitor_providers();
+
+    const std::forward_list<
+        boost::shared_ptr<
             inclusion_dependencies_provider_interface<yarn::model>
             >
         >&
@@ -93,6 +123,16 @@ private:
     > enumeration_providers_;
     std::forward_list<
         boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::exception>
+            >
+    > exception_providers_;
+    std::forward_list<
+        boost::shared_ptr<
+            inclusion_dependencies_provider_interface<yarn::visitor>
+            >
+    > visitor_providers_;
+    std::forward_list<
+        boost::shared_ptr<
             inclusion_dependencies_provider_interface<yarn::model>
             >
     > model_providers_;
diff --git a/projects/cpp/include/dogen/cpp/types/formattables/inclusion_dependencies_factory.hpp b/projects/cpp/include/dogen/cpp/types/formattables/inclusion_dependencies_factory.hpp
index bb4472d..e58332f 100644
--- a/projects/cpp/include/dogen/cpp/types/formattables/inclusion_dependencies_factory.hpp
+++ b/projects/cpp/include/dogen/cpp/types/formattables/inclusion_dependencies_factory.hpp
@@ -52,16 +52,16 @@ public:
         const inclusion_dependencies_builder_factory& f, const container& c);
 public:
     /**
-     * @brief Makes inclusion dependencies for an object.
+     * @brief Makes inclusion dependencies for a module.
      */
     std::unordered_map<std::string, std::list<std::string> >
-    make(const yarn::object& o) const;
+    make(const yarn::module& m) const;
 
     /**
-     * @brief Makes inclusion dependencies for an enumeration.
+     * @brief Makes inclusion dependencies for a concept.
      */
     std::unordered_map<std::string, std::list<std::string> >
-    make(const yarn::enumeration& e) const;
+    make(const yarn::concept& c) const;
 
     /**
      * @brief Makes inclusion dependencies for a primitive.
@@ -70,16 +70,28 @@ public:
     make(const yarn::primitive& p) const;
 
     /**
-     * @brief Makes inclusion dependencies for a module.
+     * @brief Makes inclusion dependencies for an enumeration.
      */
     std::unordered_map<std::string, std::list<std::string> >
-    make(const yarn::module& m) const;
+    make(const yarn::enumeration& e) const;
 
     /**
-     * @brief Makes inclusion dependencies for a concept.
+     * @brief Makes inclusion dependencies for an object.
      */
     std::unordered_map<std::string, std::list<std::string> >
-    make(const yarn::concept& c) const;
+    make(const yarn::object& o) const;
+
+    /**
+     * @brief Makes inclusion dependencies for an exception.
+     */
+    std::unordered_map<std::string, std::list<std::string> >
+    make(const yarn::exception& e) const;
+
+    /**
+     * @brief Makes inclusion dependencies for a visitor.
+     */
+    std::unordered_map<std::string, std::list<std::string> >
+    make(const yarn::visitor& v) const;
 
     /**
      * @brief Makes inclusion dependencies for a model.
diff --git a/projects/cpp/include/dogen/cpp/types/formattables/registrar.hpp b/projects/cpp/include/dogen/cpp/types/formattables/registrar.hpp
index 473b7f7..f652888 100644
--- a/projects/cpp/include/dogen/cpp/types/formattables/registrar.hpp
+++ b/projects/cpp/include/dogen/cpp/types/formattables/registrar.hpp
@@ -29,6 +29,8 @@
 #include "dogen/yarn/types/model.hpp"
 #include "dogen/yarn/types/object.hpp"
 #include "dogen/yarn/types/enumeration.hpp"
+#include "dogen/yarn/types/exception.hpp"
+#include "dogen/yarn/types/visitor.hpp"
 #include "dogen/cpp/types/formattables/inclusion_dependencies_provider_interface.hpp"
 #include "dogen/cpp/types/formattables/container.hpp"
 
@@ -49,6 +51,14 @@ public:
         > p);
 
     void register_provider(boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::exception>
+        > p);
+
+    void register_provider(boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::visitor>
+        > p);
+
+    void register_provider(boost::shared_ptr<
         inclusion_dependencies_provider_interface<yarn::model>
         > p);
 
diff --git a/projects/cpp/include/dogen/cpp/types/formattables/transformer.hpp b/projects/cpp/include/dogen/cpp/types/formattables/transformer.hpp
index 0d88d95..d43f53e 100644
--- a/projects/cpp/include/dogen/cpp/types/formattables/transformer.hpp
+++ b/projects/cpp/include/dogen/cpp/types/formattables/transformer.hpp
@@ -34,9 +34,11 @@
 #include "dogen/yarn/hash/name_hash.hpp"
 #include "dogen/yarn/types/model.hpp"
 #include "dogen/yarn/types/module.hpp"
-#include "dogen/yarn/types/concept.hpp"
 #include "dogen/yarn/types/object.hpp"
+#include "dogen/yarn/types/visitor.hpp"
+#include "dogen/yarn/types/concept.hpp"
 #include "dogen/yarn/types/primitive.hpp"
+#include "dogen/yarn/types/exception.hpp"
 #include "dogen/yarn/types/enumeration.hpp"
 #include "dogen/yarn/types/nested_name.hpp"
 #include "dogen/cpp/types/formattables/entity.hpp"
@@ -128,11 +130,10 @@ private:
     to_namespace_info(const yarn::module& m) const;
 
     /**
-     * @brief Transforms a Yarn value containing an exception into an
-     * exception info.
+     * @brief Transforms a yarn exception into an exception info.
      */
     std::shared_ptr<exception_info>
-    to_exception_info(const yarn::object& o) const;
+    to_exception_info(const yarn::exception& e) const;
 
     /**
      * @brief Transform a Yarn object into a class info.
@@ -142,12 +143,9 @@ private:
     std::shared_ptr<class_info> to_class_info(const yarn::object& o) const;
 
     /**
-     * @brief Transform a Yarn object representing a visitor into a
-     * visitor info.
-     *
-     * @pre value object must have a visitor type.
+     * @brief Transform a yarn visitor into a visitor info.
      */
-    std::shared_ptr<visitor_info> to_visitor_info(const yarn::object& o) const;
+    std::shared_ptr<visitor_info> to_visitor_info(const yarn::visitor& v) const;
 
     /**
      * @brief Creates a forward declaration for the object.
@@ -156,6 +154,18 @@ private:
     to_forward_declarations_info(const yarn::object& o) const;
 
     /**
+     * @brief Creates a forward declaration for the exception.
+     */
+    std::shared_ptr<forward_declarations_info>
+    to_forward_declarations_info(const yarn::exception& e) const;
+
+    /**
+     * @brief Creates a forward declaration for the visitor.
+     */
+    std::shared_ptr<forward_declarations_info>
+    to_forward_declarations_info(const yarn::visitor& v) const;
+
+    /**
      * @brief Creates a forward declaration for the enumeration.
      */
     std::shared_ptr<forward_declarations_info>
@@ -192,6 +202,18 @@ public:
     std::forward_list<std::shared_ptr<formattable> >
     transform(const yarn::object& o) const;
 
+    /**
+     * @brief Transform an Yarn exception into a C++ entity.
+     */
+    std::forward_list<std::shared_ptr<formattable> >
+    transform(const yarn::exception& e) const;
+
+    /**
+     * @brief Transform an Yarn visitor into a C++ entity.
+     */
+    std::forward_list<std::shared_ptr<formattable> >
+    transform(const yarn::visitor& v) const;
+
 private:
     const settings::opaque_settings_builder& opaque_settings_builder_;
     const settings::bundle_repository& bundle_repository_;
diff --git a/projects/cpp/src/types/formattables/container.cpp b/projects/cpp/src/types/formattables/container.cpp
index 3e04db3..e7fb8e3 100644
--- a/projects/cpp/src/types/formattables/container.cpp
+++ b/projects/cpp/src/types/formattables/container.cpp
@@ -62,6 +62,42 @@ container::enumeration_providers() {
 
 const std::forward_list<
     boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::exception>
+        >
+    >&
+container::exception_providers() const {
+    return exception_providers_;
+}
+
+std::forward_list<
+    boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::exception>
+        >
+    >&
+container::exception_providers() {
+    return exception_providers_;
+}
+
+const std::forward_list<
+    boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::visitor>
+        >
+    >&
+container::visitor_providers() const {
+    return visitor_providers_;
+}
+
+std::forward_list<
+    boost::shared_ptr<
+        inclusion_dependencies_provider_interface<yarn::visitor>
+        >
+    >&
+container::visitor_providers() {
+    return visitor_providers_;
+}
+
+const std::forward_list<
+    boost::shared_ptr<
         inclusion_dependencies_provider_interface<yarn::model>
         >
     >&
diff --git a/projects/cpp/src/types/formattables/enablement_repository_factory.cpp b/projects/cpp/src/types/formattables/enablement_repository_factory.cpp
index 79659cf..cb0fcdd 100644
--- a/projects/cpp/src/types/formattables/enablement_repository_factory.cpp
+++ b/projects/cpp/src/types/formattables/enablement_repository_factory.cpp
@@ -69,15 +69,17 @@ private:
 
 public:
     using yarn::element_visitor::visit;
+    void visit(const dogen::yarn::module& m) { generate(m); }
+    void visit(const dogen::yarn::concept& c) { generate(c); }
+    void visit(const dogen::yarn::primitive& p) { generate(p); }
+    void visit(const dogen::yarn::enumeration& e) { generate(e); }
     void visit(const dogen::yarn::object& o) {
         const auto is_service(o.object_type() ==
             yarn::object_types::user_defined_service);
         generate(o, is_service);
     }
-    void visit(const dogen::yarn::enumeration& e) { generate(e); }
-    void visit(const dogen::yarn::primitive& p) { generate(p); }
-    void visit(const dogen::yarn::module& m) { generate(m); }
-    void visit(const dogen::yarn::concept& c) { generate(c); }
+    void visit(const dogen::yarn::exception& e) { generate(e); }
+    void visit(const dogen::yarn::visitor& v) { generate(v); }
 
 public:
     const enablement_repository& result() const { return result_; }
diff --git a/projects/cpp/src/types/formattables/inclusion_dependencies_factory.cpp b/projects/cpp/src/types/formattables/inclusion_dependencies_factory.cpp
index 299d72e..4bd470d 100644
--- a/projects/cpp/src/types/formattables/inclusion_dependencies_factory.cpp
+++ b/projects/cpp/src/types/formattables/inclusion_dependencies_factory.cpp
@@ -132,13 +132,15 @@ inclusion_dependencies_factory::inclusion_dependencies_factory(
     : factory_(f), provider_container_(c) {}
 
 std::unordered_map<std::string, std::list<std::string> >
-inclusion_dependencies_factory::make(const yarn::object& o) const {
-    return generate(factory_, provider_container_.object_providers(), o);
+inclusion_dependencies_factory::make(const yarn::module& /*m*/) const {
+    std::unordered_map<std::string, std::list<std::string> > r;
+    return r;
 }
 
 std::unordered_map<std::string, std::list<std::string> >
-inclusion_dependencies_factory::make(const yarn::enumeration& e) const {
-    return generate(factory_, provider_container_.enumeration_providers(), e);
+inclusion_dependencies_factory::make(const yarn::concept& /*c*/) const {
+    std::unordered_map<std::string, std::list<std::string> > r;
+    return r;
 }
 
 std::unordered_map<std::string, std::list<std::string> >
@@ -148,15 +150,23 @@ inclusion_dependencies_factory::make(const yarn::primitive& /*p*/) const {
 }
 
 std::unordered_map<std::string, std::list<std::string> >
-inclusion_dependencies_factory::make(const yarn::module& /*m*/) const {
-    std::unordered_map<std::string, std::list<std::string> > r;
-    return r;
+inclusion_dependencies_factory::make(const yarn::enumeration& e) const {
+    return generate(factory_, provider_container_.enumeration_providers(), e);
 }
 
 std::unordered_map<std::string, std::list<std::string> >
-inclusion_dependencies_factory::make(const yarn::concept& /*c*/) const {
-    std::unordered_map<std::string, std::list<std::string> > r;
-    return r;
+inclusion_dependencies_factory::make(const yarn::object& o) const {
+    return generate(factory_, provider_container_.object_providers(), o);
+}
+
+std::unordered_map<std::string, std::list<std::string> >
+inclusion_dependencies_factory::make(const yarn::exception& e) const {
+    return generate(factory_, provider_container_.exception_providers(), e);
+}
+
+std::unordered_map<std::string, std::list<std::string> >
+inclusion_dependencies_factory::make(const yarn::visitor& v) const {
+    return generate(factory_, provider_container_.visitor_providers(), v);
 }
 
 std::unordered_map<std::string, std::list<std::string> >
diff --git a/projects/cpp/src/types/formattables/inclusion_dependencies_repository_factory.cpp b/projects/cpp/src/types/formattables/inclusion_dependencies_repository_factory.cpp
index 1ac4b6f..3f25f65 100644
--- a/projects/cpp/src/types/formattables/inclusion_dependencies_repository_factory.cpp
+++ b/projects/cpp/src/types/formattables/inclusion_dependencies_repository_factory.cpp
@@ -86,11 +86,13 @@ private:
 
 public:
     using yarn::element_visitor::visit;
-    void visit(const dogen::yarn::object& o) { generate(o); }
-    void visit(const dogen::yarn::enumeration& e) { generate(e); }
-    void visit(const dogen::yarn::primitive& p) { generate(p); }
     void visit(const dogen::yarn::module& m) { generate(m); }
     void visit(const dogen::yarn::concept& c) { generate(c); }
+    void visit(const dogen::yarn::primitive& p) { generate(p); }
+    void visit(const dogen::yarn::enumeration& e) { generate(e); }
+    void visit(const dogen::yarn::object& o) { generate(o); }
+    void visit(const dogen::yarn::exception& e) { generate(e); }
+    void visit(const dogen::yarn::visitor& v) { generate(v); }
 
 public:
     const inclusion_dependencies_repository& result() const { return result_; }
diff --git a/projects/cpp/src/types/formattables/inclusion_directives_repository_factory.cpp b/projects/cpp/src/types/formattables/inclusion_directives_repository_factory.cpp
index 12d516f..38fc6b0 100644
--- a/projects/cpp/src/types/formattables/inclusion_directives_repository_factory.cpp
+++ b/projects/cpp/src/types/formattables/inclusion_directives_repository_factory.cpp
@@ -88,11 +88,13 @@ private:
 
 public:
     using yarn::element_visitor::visit;
-    void visit(const dogen::yarn::object& o) { generate(o); }
-    void visit(const dogen::yarn::enumeration& e) { generate(e); }
-    void visit(const dogen::yarn::primitive& p) { generate(p); }
     void visit(const dogen::yarn::module& m) { generate(m); }
     void visit(const dogen::yarn::concept& c) { generate(c); }
+    void visit(const dogen::yarn::primitive& p) { generate(p); }
+    void visit(const dogen::yarn::enumeration& e) { generate(e); }
+    void visit(const dogen::yarn::object& o) { generate(o); }
+    void visit(const dogen::yarn::exception& e) { generate(e); }
+    void visit(const dogen::yarn::visitor& v) { generate(v); }
 
 public:
     const inclusion_directives_repository& result() const { return result_; }
diff --git a/projects/cpp/src/types/formattables/path_derivatives_repository_factory.cpp b/projects/cpp/src/types/formattables/path_derivatives_repository_factory.cpp
index e0dffad..a490eed 100644
--- a/projects/cpp/src/types/formattables/path_derivatives_repository_factory.cpp
+++ b/projects/cpp/src/types/formattables/path_derivatives_repository_factory.cpp
@@ -66,11 +66,13 @@ public:
 
 public:
     using yarn::element_visitor::visit;
-    void visit(const dogen::yarn::object& o) { generate(o.name()); }
-    void visit(const dogen::yarn::enumeration& e) { generate(e.name()); }
-    void visit(const dogen::yarn::primitive& p) { generate(p.name()); }
     void visit(const dogen::yarn::module& m) { generate(m.name()); }
     void visit(const dogen::yarn::concept& c) { generate(c.name()); }
+    void visit(const dogen::yarn::primitive& p) { generate(p.name()); }
+    void visit(const dogen::yarn::enumeration& e) { generate(e.name()); }
+    void visit(const dogen::yarn::object& o) { generate(o.name()); }
+    void visit(const dogen::yarn::exception& e) { generate(e.name()); }
+    void visit(const dogen::yarn::visitor& v) { generate(v.name()); }
 
 public:
     const path_derivatives_repository & result() const { return result_; }
diff --git a/projects/cpp/src/types/formattables/registrar.cpp b/projects/cpp/src/types/formattables/registrar.cpp
index db008bb..995941a 100644
--- a/projects/cpp/src/types/formattables/registrar.cpp
+++ b/projects/cpp/src/types/formattables/registrar.cpp
@@ -63,6 +63,28 @@ void registrar::register_provider(boost::shared_ptr<
 }
 
 void registrar::register_provider(boost::shared_ptr<
+    inclusion_dependencies_provider_interface<yarn::exception>
+    > p) {
+
+    if (p->formatter_name().empty()) {
+        BOOST_LOG_SEV(lg, error) << empty_formatter_name;
+        BOOST_THROW_EXCEPTION(registrar_error(empty_formatter_name));
+    }
+    container_.exception_providers().push_front(p);
+}
+
+void registrar::register_provider(boost::shared_ptr<
+    inclusion_dependencies_provider_interface<yarn::visitor>
+    > p) {
+
+    if (p->formatter_name().empty()) {
+        BOOST_LOG_SEV(lg, error) << empty_formatter_name;
+        BOOST_THROW_EXCEPTION(registrar_error(empty_formatter_name));
+    }
+    container_.visitor_providers().push_front(p);
+}
+
+void registrar::register_provider(boost::shared_ptr<
     inclusion_dependencies_provider_interface<yarn::model>
     > p) {
 
diff --git a/projects/cpp/src/types/formattables/transformer.cpp b/projects/cpp/src/types/formattables/transformer.cpp
index f05b470..ff9e965 100644
--- a/projects/cpp/src/types/formattables/transformer.cpp
+++ b/projects/cpp/src/types/formattables/transformer.cpp
@@ -408,12 +408,12 @@ to_namespace_info(const yarn::module& m) const {
 }
 
 std::shared_ptr<exception_info>
-transformer::to_exception_info(const yarn::object& o) const {
+transformer::to_exception_info(const yarn::exception& e) const {
     BOOST_LOG_SEV(lg, debug) << "Transforming exception: "
-                             << o.name().qualified();
+                             << e.name().qualified();
 
     auto r(std::make_shared<exception_info>());
-    populate_entity_properties(o.name(), o.documentation(), *r);
+    populate_entity_properties(e.name(), e.documentation(), *r);
 
     BOOST_LOG_SEV(lg, debug) << "Transformed exception.";
     return r;
@@ -502,21 +502,21 @@ transformer::to_class_info(const yarn::object& o) const {
 }
 
 std::shared_ptr<visitor_info>
-transformer::to_visitor_info(const yarn::object& o) const {
+transformer::to_visitor_info(const yarn::visitor& v) const {
     BOOST_LOG_SEV(lg, debug) << "Transforming visitor: "
-                             << o.name().qualified();
+                             << v.name().qualified();
 
     auto r(std::make_shared<visitor_info>());
-    populate_entity_properties(o.name(), o.documentation(), *r);
+    populate_entity_properties(v.name(), v.documentation(), *r);
 
-    if (o.visits().empty()) {
-        const auto& qn(o.name().qualified());
+    if (v.visits().empty()) {
+        const auto& qn(v.name().qualified());
         BOOST_LOG_SEV(lg, error) << no_visitees << qn;
         BOOST_THROW_EXCEPTION(transformation_error(no_visitees + qn));
     }
 
     name_builder b;
-    for (const auto n : o.visits()) {
+    for (const auto n : v.visits()) {
         cpp::formattables::visited_type_info vti;
         vti.qualified_name(b.qualified_name(model_, n));
         vti.name(n.simple());
@@ -531,12 +531,26 @@ transformer::to_visitor_info(const yarn::object& o) const {
 std::shared_ptr<forward_declarations_info> transformer::
 to_forward_declarations_info(const yarn::object& o) const {
     auto r(std::make_shared<forward_declarations_info>());
-    r->is_exception(o.object_type() == yarn::object_types::exception);
     populate_entity_properties(o.name(), o.documentation(), *r);
     return r;
 }
 
 std::shared_ptr<forward_declarations_info> transformer::
+to_forward_declarations_info(const yarn::visitor& v) const {
+    auto r(std::make_shared<forward_declarations_info>());
+    populate_entity_properties(v.name(), v.documentation(), *r);
+    return r;
+}
+
+std::shared_ptr<forward_declarations_info> transformer::
+to_forward_declarations_info(const yarn::exception& e) const {
+    auto r(std::make_shared<forward_declarations_info>());
+    r->is_exception(true);
+    populate_entity_properties(e.name(), e.documentation(), *r);
+    return r;
+}
+
+std::shared_ptr<forward_declarations_info> transformer::
 to_forward_declarations_info(const yarn::enumeration& e) const {
     auto r(std::make_shared<forward_declarations_info>());
     populate_entity_properties(e.name(), e.documentation(), *r);
@@ -587,12 +601,6 @@ transform(const yarn::object& o) const {
     case yarn::object_types::user_defined_service:
         r.push_front(to_class_info(o));
         break;
-    case yarn::object_types::visitor:
-        r.push_front(to_visitor_info(o));
-        break;
-    case yarn::object_types::exception:
-        r.push_front(to_exception_info(o));
-        break;
     default: {
         const auto qn(o.name().qualified());
         BOOST_LOG_SEV(lg, error) << unsupported_object_type << o.object_type()
@@ -606,4 +614,20 @@ transform(const yarn::object& o) const {
     return r;
 }
 
+std::forward_list<std::shared_ptr<formattable> >
+transformer::transform(const yarn::exception& e) const {
+    std::forward_list<std::shared_ptr<formattable> > r;
+    r.push_front(to_exception_info(e));
+    r.push_front(to_forward_declarations_info(e));
+    return r;
+}
+
+std::forward_list<std::shared_ptr<formattable> >
+transformer::transform(const yarn::visitor& v) const {
+    std::forward_list<std::shared_ptr<formattable> > r;
+    r.push_front(to_visitor_info(v));
+    r.push_front(to_forward_declarations_info(v));
+    return r;
+}
+
 } } }
diff --git a/projects/cpp/src/types/formattables/workflow.cpp b/projects/cpp/src/types/formattables/workflow.cpp
index 07f4465..25fea7b 100644
--- a/projects/cpp/src/types/formattables/workflow.cpp
+++ b/projects/cpp/src/types/formattables/workflow.cpp
@@ -55,28 +55,23 @@ public:
     explicit generator(const transformer& t) : transformer_(t) { }
 
 private:
-    void add(std::forward_list<std::shared_ptr<formattables::formattable> > f) {
-        result_.splice_after(result_.before_begin(), f);
-    }
-
-    template<typename Generatable>
-    bool ignore(const Generatable& g) const {
-        return g.generation_type() == yarn::generation_types::no_generation;
-    }
-
     template<typename Transformable>
     void transform(const Transformable& t) {
-        if (!ignore(t))
-            add(transformer_.transform(t));
+        if (t.generation_type() != yarn::generation_types::no_generation) {
+            auto f(transformer_.transform(t));
+            result_.splice_after(result_.before_begin(), f);
+        }
     }
 
 public:
     using yarn::element_visitor::visit;
-    void visit(const dogen::yarn::object& o) { transform(o); }
-    void visit(const dogen::yarn::enumeration& e) { transform(e); }
-    void visit(const dogen::yarn::primitive& p) { transform(p); }
     void visit(const dogen::yarn::module& m) { transform(m); }
     void visit(const dogen::yarn::concept& c) { transform(c); }
+    void visit(const dogen::yarn::primitive& p) { transform(p); }
+    void visit(const dogen::yarn::enumeration& e) { transform(e); }
+    void visit(const dogen::yarn::object& o) { transform(o); }
+    void visit(const dogen::yarn::exception& e) { transform(e); }
+    void visit(const dogen::yarn::visitor& v) { transform(v); }
 
 public:
     const std::forward_list<std::shared_ptr<formattables::formattable> >&
diff --git a/projects/cpp/src/types/formatters/types/class_header_formatter.cpp b/projects/cpp/src/types/formatters/types/class_header_formatter.cpp
index d50fe12..ed9072b 100644
--- a/projects/cpp/src/types/formatters/types/class_header_formatter.cpp
+++ b/projects/cpp/src/types/formatters/types/class_header_formatter.cpp
@@ -86,7 +86,7 @@ provider::provide(const formattables::inclusion_dependencies_builder_factory& f,
     builder.add(o.hash_container_keys(), hash_fn);
 
     if (o.is_visitable())
-        builder.add(o.visited_by(), self_fn);
+        builder.add(o.visitable_by(), self_fn);
 
     return builder.build();
 }
diff --git a/projects/cpp/src/types/formatters/types/forward_declarations_formatter.cpp b/projects/cpp/src/types/formatters/types/forward_declarations_formatter.cpp
index b5766fa..11ae0d8 100644
--- a/projects/cpp/src/types/formatters/types/forward_declarations_formatter.cpp
+++ b/projects/cpp/src/types/formatters/types/forward_declarations_formatter.cpp
@@ -51,13 +51,13 @@ namespace types {
 namespace {
 
 class provider final : public formattables::
-        inclusion_dependencies_provider_interface<yarn::object> {
+        inclusion_dependencies_provider_interface<yarn::exception> {
 public:
     std::string formatter_name() const override;
 
     boost::optional<std::list<std::string> >
     provide(const formattables::inclusion_dependencies_builder_factory& f,
-        const yarn::object& o) const override;
+        const yarn::exception& e) const override;
 };
 
 std::string provider::formatter_name() const {
@@ -66,10 +66,7 @@ std::string provider::formatter_name() const {
 
 boost::optional<std::list<std::string> >
 provider::provide(const formattables::inclusion_dependencies_builder_factory& f,
-    const yarn::object& o) const {
-
-    if (o.object_type() != yarn::object_types::exception)
-        return boost::optional<std::list<std::string> >();
+    const yarn::exception& /*e*/) const {
 
     const auto self_fn(forward_declarations_formatter::static_formatter_name());
     auto builder(f.make());
diff --git a/projects/cpp/src/types/formatters/types/visitor_header_formatter.cpp b/projects/cpp/src/types/formatters/types/visitor_header_formatter.cpp
index ce92dec..467fd8e 100644
--- a/projects/cpp/src/types/formatters/types/visitor_header_formatter.cpp
+++ b/projects/cpp/src/types/formatters/types/visitor_header_formatter.cpp
@@ -39,13 +39,13 @@ namespace types {
 namespace {
 
 class provider final : public formattables::
-        inclusion_dependencies_provider_interface<yarn::object> {
+        inclusion_dependencies_provider_interface<yarn::visitor> {
 public:
     std::string formatter_name() const override;
 
     boost::optional<std::list<std::string> >
         provide(const formattables::inclusion_dependencies_builder_factory& f,
-        const yarn::object& o) const override;
+        const yarn::visitor& v) const override;
 };
 
 std::string provider::formatter_name() const {
@@ -54,17 +54,14 @@ std::string provider::formatter_name() const {
 
 boost::optional<std::list<std::string> >
 provider::provide(const formattables::inclusion_dependencies_builder_factory& f,
-    const yarn::object& o) const {
-
-    if (o.object_type() != yarn::object_types::visitor)
-        return boost::optional<std::list<std::string> >();
+    const yarn::visitor& v) const {
 
     auto builder(f.make());
-    if (o.visits().empty())
+    if (v.visits().empty())
         return boost::optional<std::list<std::string> >();
 
     const auto fwd_fn(traits::forward_declarations_formatter_name());
-    builder.add(o.visits(), fwd_fn);
+    builder.add(v.visits(), fwd_fn);
 
     return builder.build();
 }
diff --git a/projects/cpp/src/types/settings/bundle_repository_factory.cpp b/projects/cpp/src/types/settings/bundle_repository_factory.cpp
index 3b6f744..f93e43e 100644
--- a/projects/cpp/src/types/settings/bundle_repository_factory.cpp
+++ b/projects/cpp/src/types/settings/bundle_repository_factory.cpp
@@ -26,6 +26,8 @@
 #include "dogen/yarn/types/enumeration.hpp"
 #include "dogen/yarn/types/concept.hpp"
 #include "dogen/yarn/types/module.hpp"
+#include "dogen/yarn/types/exception.hpp"
+#include "dogen/yarn/types/visitor.hpp"
 #include "dogen/yarn/types/element_visitor.hpp"
 #include "dogen/cpp/io/settings/bundle_repository_io.hpp"
 #include "dogen/cpp/types/settings/bundle_factory.hpp"
@@ -78,11 +80,13 @@ private:
 
 public:
     using yarn::element_visitor::visit;
-    void visit(const dogen::yarn::object& o) { generate(o); }
-    void visit(const dogen::yarn::enumeration& e) { generate(e); }
-    void visit(const dogen::yarn::primitive& p) { generate(p); }
     void visit(const dogen::yarn::module& m) { generate(m); }
     void visit(const dogen::yarn::concept& c) { generate(c); }
+    void visit(const dogen::yarn::primitive& p) { generate(p); }
+    void visit(const dogen::yarn::enumeration& e) { generate(e); }
+    void visit(const dogen::yarn::object& o) { generate(o); }
+    void visit(const dogen::yarn::exception& e) { generate(e); }
+    void visit(const dogen::yarn::visitor& v) { generate(v); }
 
 public:
     const bundle_repository& result() const { return result_; }
diff --git a/projects/yarn.dia/spec/transformer_spec.cpp b/projects/yarn.dia/spec/transformer_spec.cpp
index a1f4028..d284288 100644
--- a/projects/yarn.dia/spec/transformer_spec.cpp
+++ b/projects/yarn.dia/spec/transformer_spec.cpp
@@ -246,10 +246,10 @@ BOOST_AUTO_TEST_CASE(uml_class_with_exception_stereotype_transforms_into_expecte
     BOOST_LOG_SEV(lg, debug) << "context: " << c;
     BOOST_CHECK(c.model().enumerations().empty());
     BOOST_CHECK(c.model().primitives().empty());
-    BOOST_REQUIRE(c.model().objects().size() == 1);
+    BOOST_CHECK(c.model().objects().empty());
+    BOOST_REQUIRE(c.model().exceptions().size() == 1);
 
-    const auto& e(c.model().objects().begin()->second);
-    BOOST_CHECK(e.object_type() == dogen::yarn::object_types::exception);
+    const auto& e(c.model().exceptions().begin()->second);
     BOOST_REQUIRE(e.name().location().model_module_path().size() == 1);
     BOOST_CHECK(e.name().location().model_module_path().front() ==
         model_name);
@@ -434,9 +434,8 @@ BOOST_AUTO_TEST_CASE(uml_class_with_exception_stereotype_in_package_transforms_i
         }
     }
 
-    BOOST_REQUIRE(c.model().objects().size() == 1);
-    const auto& o(c.model().objects().begin()->second);
-    BOOST_CHECK(o.object_type() == dogen::yarn::object_types::exception);
+    BOOST_REQUIRE(c.model().exceptions().size() == 1);
+    const auto& o(c.model().exceptions().begin()->second);
     BOOST_REQUIRE(o.name().location().model_module_path().size() == 1);
     BOOST_CHECK(o.name().location().model_module_path().front() ==
         model_name);
@@ -692,9 +691,8 @@ BOOST_AUTO_TEST_CASE(uml_class_with_exception_stereotype_in_two_packages_transfo
             == first);
     }
 
-    BOOST_REQUIRE(c.model().objects().size() == 1);
-    const auto& o(c.model().objects().begin()->second);
-    BOOST_CHECK(o.object_type() == dogen::yarn::object_types::exception);
+    BOOST_REQUIRE(c.model().exceptions().size() == 1);
+    const auto& o(c.model().exceptions().begin()->second);
     BOOST_REQUIRE(o.name().location().model_module_path().size() == 1);
     BOOST_CHECK(o.name().location().model_module_path().front() ==
         model_name);
diff --git a/projects/yarn.dia/src/types/transformer.cpp b/projects/yarn.dia/src/types/transformer.cpp
index 3668b7c..ee9d2d0 100644
--- a/projects/yarn.dia/src/types/transformer.cpp
+++ b/projects/yarn.dia/src/types/transformer.cpp
@@ -245,11 +245,11 @@ update_object(yarn::object& o, const processed_object& po, const profile& p) {
 void transformer::to_exception(const processed_object& o, const profile& p) {
     BOOST_LOG_SEV(lg, debug) << "Object is an exception: " << o.id();
 
-    yarn::object e;
-    update_object(e, o, p);
-    e.object_type(yarn::object_types::exception);
-    auto& objects(context_.model().objects());
-    objects.insert(std::make_pair(e.name().qualified(), e));
+    yarn::exception e;
+    update_element(e, o, p);
+
+    auto& exceptions(context_.model().exceptions());
+    exceptions.insert(std::make_pair(e.name().qualified(), e));
 }
 
 void transformer::to_service(const processed_object& o, const profile& p) {
diff --git a/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp b/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
index 9a69147..9356414 100644
--- a/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
+++ b/projects/yarn/include/dogen/yarn/test/mock_intermediate_model_factory.hpp
@@ -260,7 +260,7 @@ public:
     /**
      * @brief Create an exception.
      */
-    object make_exception(const unsigned int i, const name& model_name,
+    exception make_exception(const unsigned int i, const name& model_name,
         const unsigned int module_n = 0) const;
 
     /**
diff --git a/projects/yarn/include/dogen/yarn/types/elements_traversal.hpp b/projects/yarn/include/dogen/yarn/types/elements_traversal.hpp
index 28b5c83..56548fe 100644
--- a/projects/yarn/include/dogen/yarn/types/elements_traversal.hpp
+++ b/projects/yarn/include/dogen/yarn/types/elements_traversal.hpp
@@ -28,7 +28,9 @@
 #include "dogen/yarn/types/intermediate_model.hpp"
 #include "dogen/yarn/types/enumeration.hpp"
 #include "dogen/yarn/types/primitive.hpp"
+#include "dogen/yarn/types/exception.hpp"
 #include "dogen/yarn/types/concept.hpp"
+#include "dogen/yarn/types/visitor.hpp"
 #include "dogen/yarn/types/module.hpp"
 
 namespace dogen {
@@ -56,6 +58,12 @@ inline void elements_traversal(const intermediate_model& m,
 
     for (const auto& pair : m.objects())
         v(pair.second);
+
+    for (const auto& pair : m.exceptions())
+        v(pair.second);
+
+    for (const auto& pair : m.visitors())
+        v(pair.second);
 }
 
 template<typename TraversalVisitor>
@@ -75,6 +83,12 @@ inline void elements_traversal(const intermediate_model& m,
 
     for (auto& pair : m.objects())
         v(pair.second);
+
+    for (auto& pair : m.exceptions())
+        v(pair.second);
+
+    for (auto& pair : m.visitors())
+        v(pair.second);
 }
 
 template<typename TraversalVisitor>
@@ -93,6 +107,12 @@ inline void elements_traversal(intermediate_model& m, TraversalVisitor& v) {
 
     for (auto& pair : m.objects())
         v(pair.second);
+
+    for (auto& pair : m.exceptions())
+        v(pair.second);
+
+    for (auto& pair : m.visitors())
+        v(pair.second);
 }
 /**@}*/
 
diff --git a/projects/yarn/include/dogen/yarn/types/injector.hpp b/projects/yarn/include/dogen/yarn/types/injector.hpp
index 3647e73..7de14e3 100644
--- a/projects/yarn/include/dogen/yarn/types/injector.hpp
+++ b/projects/yarn/include/dogen/yarn/types/injector.hpp
@@ -26,7 +26,6 @@
 #endif
 
 #include <list>
-#include <memory>
 #include "dogen/yarn/types/intermediate_model.hpp"
 
 namespace dogen {
@@ -51,24 +50,11 @@ namespace yarn {
  *
  */
 class injector {
-public:
-    injector() = default;
-    injector(const injector&) = default;
-    ~injector() = default;
-    injector(injector&&) = default;
-    injector& operator=(const injector&) = default;
-
-private:
-    class context;
-
 private:
     /**
-     * @brief Inserts the object into the model's object container.
-     *
-     * @return True if the object did not exist in container, false
-     * otherwise.
+     * @brief Creates the module to represent the global namespace.
      */
-    bool insert(const object& o);
+    module create_global_module() const;
 
     /**
      * @brief Create a visitor for the object o.
@@ -78,26 +64,26 @@ private:
      *
      * @pre leaves must not be empty.
      */
-    object create_visitor(const object& o,
+    visitor create_visitor(const object& o,
         const std::list<name>& leaves) const;
 
     /**
      * @brief Injects an accept operation for the given visitor, to
      * the supplied object and all its leaves.
      */
-    void inject_visited_by(object& root, const std::list<name>& leaves,
-        const name& visitor) const;
+    void inject_visitable_by(object& root, const std::list<name>& leaves,
+        const name& visitor, intermediate_model& m) const;
 
     /**
      * @brief Injects visitors for objects that require them.
      */
-    void inject_visitors();
+    void inject_visitors(intermediate_model& m);
 
     /**
      * @brief Injects the global module, and makes all modules that do
      * not have a containing namespace be contained by it.
      */
-    void inject_global_module();
+    void inject_global_module(intermediate_model& m);
 
 public:
 
@@ -107,9 +93,6 @@ public:
      * @param m Yarn model to operate on.
      */
     void inject(intermediate_model& m);
-
-private:
-    mutable std::shared_ptr<context> context_;
 };
 
 } }
diff --git a/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp b/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
index 1d53082..fc46675 100644
--- a/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
+++ b/projects/yarn/include/dogen/yarn/types/intermediate_model.hpp
@@ -33,7 +33,9 @@
 #include "dogen/yarn/types/module.hpp"
 #include "dogen/yarn/types/object.hpp"
 #include "dogen/yarn/types/concept.hpp"
+#include "dogen/yarn/types/visitor.hpp"
 #include "dogen/yarn/hash/name_hash.hpp"
+#include "dogen/yarn/types/exception.hpp"
 #include "dogen/yarn/types/primitive.hpp"
 #include "dogen/yarn/types/enumeration.hpp"
 #include "dogen/yarn/types/origin_types.hpp"
@@ -68,6 +70,8 @@ public:
         const std::unordered_map<std::string, dogen::yarn::primitive>& primitives,
         const std::unordered_map<std::string, dogen::yarn::enumeration>& enumerations,
         const std::unordered_map<std::string, dogen::yarn::object>& objects,
+        const std::unordered_map<std::string, dogen::yarn::exception>& exceptions,
+        const std::unordered_map<std::string, dogen::yarn::visitor>& visitors,
         const bool is_target,
         const bool has_generatable_types);
 
@@ -189,6 +193,26 @@ public:
     /**@}*/
 
     /**
+     * @brief All exceptions in this model.
+     */
+    /**@{*/
+    const std::unordered_map<std::string, dogen::yarn::exception>& exceptions() const;
+    std::unordered_map<std::string, dogen::yarn::exception>& exceptions();
+    void exceptions(const std::unordered_map<std::string, dogen::yarn::exception>& v);
+    void exceptions(const std::unordered_map<std::string, dogen::yarn::exception>&& v);
+    /**@}*/
+
+    /**
+     * @brief All visitors in this model.
+     */
+    /**@{*/
+    const std::unordered_map<std::string, dogen::yarn::visitor>& visitors() const;
+    std::unordered_map<std::string, dogen::yarn::visitor>& visitors();
+    void visitors(const std::unordered_map<std::string, dogen::yarn::visitor>& v);
+    void visitors(const std::unordered_map<std::string, dogen::yarn::visitor>&& v);
+    /**@}*/
+
+    /**
      * @brief If true, this intermediate model is the target model.
      */
     /**@{*/
@@ -226,6 +250,8 @@ private:
     std::unordered_map<std::string, dogen::yarn::primitive> primitives_;
     std::unordered_map<std::string, dogen::yarn::enumeration> enumerations_;
     std::unordered_map<std::string, dogen::yarn::object> objects_;
+    std::unordered_map<std::string, dogen::yarn::exception> exceptions_;
+    std::unordered_map<std::string, dogen::yarn::visitor> visitors_;
     bool is_target_;
     bool has_generatable_types_;
 };
diff --git a/projects/yarn/include/dogen/yarn/types/object.hpp b/projects/yarn/include/dogen/yarn/types/object.hpp
index 27dc79c..ae59ba3 100644
--- a/projects/yarn/include/dogen/yarn/types/object.hpp
+++ b/projects/yarn/include/dogen/yarn/types/object.hpp
@@ -77,8 +77,7 @@ public:
         const std::list<dogen::yarn::name>& weak_associations,
         const bool is_visitable,
         const bool is_root_parent_visitable,
-        const std::list<dogen::yarn::name>& visits,
-        const std::list<dogen::yarn::name>& visited_by,
+        const std::list<dogen::yarn::name>& visitable_by,
         const dogen::yarn::object_types object_type,
         const std::list<dogen::yarn::name>& modeled_concepts,
         const std::list<dogen::yarn::name>& hash_container_keys);
@@ -264,23 +263,13 @@ public:
     /**@}*/
 
     /**
-     * @brief Elements that are visited by the visitor.
-     */
-    /**@{*/
-    const std::list<dogen::yarn::name>& visits() const;
-    std::list<dogen::yarn::name>& visits();
-    void visits(const std::list<dogen::yarn::name>& v);
-    void visits(const std::list<dogen::yarn::name>&& v);
-    /**@}*/
-
-    /**
      * @brief Elements that visit current type.
      */
     /**@{*/
-    const std::list<dogen::yarn::name>& visited_by() const;
-    std::list<dogen::yarn::name>& visited_by();
-    void visited_by(const std::list<dogen::yarn::name>& v);
-    void visited_by(const std::list<dogen::yarn::name>&& v);
+    const std::list<dogen::yarn::name>& visitable_by() const;
+    std::list<dogen::yarn::name>& visitable_by();
+    void visitable_by(const std::list<dogen::yarn::name>& v);
+    void visitable_by(const std::list<dogen::yarn::name>&& v);
     /**@}*/
 
     /**
@@ -340,8 +329,7 @@ private:
     std::list<dogen::yarn::name> weak_associations_;
     bool is_visitable_;
     bool is_root_parent_visitable_;
-    std::list<dogen::yarn::name> visits_;
-    std::list<dogen::yarn::name> visited_by_;
+    std::list<dogen::yarn::name> visitable_by_;
     dogen::yarn::object_types object_type_;
     std::list<dogen::yarn::name> modeled_concepts_;
     std::list<dogen::yarn::name> hash_container_keys_;
diff --git a/projects/yarn/include/dogen/yarn/types/object_types.hpp b/projects/yarn/include/dogen/yarn/types/object_types.hpp
index da5f964..afe5b86 100644
--- a/projects/yarn/include/dogen/yarn/types/object_types.hpp
+++ b/projects/yarn/include/dogen/yarn/types/object_types.hpp
@@ -37,13 +37,11 @@ namespace yarn {
 enum class object_types : unsigned int {
     invalid = 0, ///< Represents an uninitialised enum
     user_defined_service = 1, ///< The service has been defined by the user.
-    visitor = 2, ///< The service is a system generated visitor.
-    user_defined_value_object = 3, ///< Regular value object with no distinguishing features.
-    exception = 4, ///< Value represents an exception type.
-    smart_pointer = 5, ///< Value is a smart pointer.
-    hash_container = 6, ///< Type is a hash-based container.
-    sequence_container = 7, ///< Type is a sequence container.
-    ordered_container = 8 ///< Type is a ordered container.
+    user_defined_value_object = 2, ///< Regular value object with no distinguishing features.
+    smart_pointer = 3, ///< Value is a smart pointer.
+    hash_container = 4, ///< Type is a hash-based container.
+    sequence_container = 5, ///< Type is a sequence container.
+    ordered_container = 6 ///< Type is a ordered container.
 };
 
 } }
diff --git a/projects/yarn/include/dogen/yarn/types/visitor.hpp b/projects/yarn/include/dogen/yarn/types/visitor.hpp
index 7c58154..100f31b 100644
--- a/projects/yarn/include/dogen/yarn/types/visitor.hpp
+++ b/projects/yarn/include/dogen/yarn/types/visitor.hpp
@@ -25,8 +25,10 @@
 #pragma once
 #endif
 
+#include <list>
 #include <iosfwd>
 #include <algorithm>
+#include "dogen/yarn/types/name.hpp"
 #include "dogen/yarn/types/element.hpp"
 #include "dogen/yarn/serialization/visitor_fwd_ser.hpp"
 
@@ -50,7 +52,8 @@ public:
         const dogen::yarn::origin_types origin_type,
         const std::string& original_model_name,
         const boost::optional<dogen::yarn::name>& contained_by,
-        const bool in_global_module);
+        const bool in_global_module,
+        const std::list<dogen::yarn::name>& visits);
 
 private:
     template<typename Archive>
@@ -80,6 +83,17 @@ public:
     void to_stream(std::ostream& s) const override;
 
 public:
+    /**
+     * @brief Elements that are visitable by the visitor.
+     */
+    /**@{*/
+    const std::list<dogen::yarn::name>& visits() const;
+    std::list<dogen::yarn::name>& visits();
+    void visits(const std::list<dogen::yarn::name>& v);
+    void visits(const std::list<dogen::yarn::name>&& v);
+    /**@}*/
+
+public:
     bool operator==(const visitor& rhs) const;
     bool operator!=(const visitor& rhs) const {
         return !this->operator==(rhs);
@@ -92,6 +106,8 @@ public:
     void swap(visitor& other) noexcept;
     visitor& operator=(visitor other);
 
+private:
+    std::list<dogen::yarn::name> visits_;
 };
 
 } }
diff --git a/projects/yarn/spec/injector_spec.cpp b/projects/yarn/spec/injector_spec.cpp
index ac8b099..540e13d 100644
--- a/projects/yarn/spec/injector_spec.cpp
+++ b/projects/yarn/spec/injector_spec.cpp
@@ -101,9 +101,9 @@ BOOST_AUTO_TEST_CASE(visitable_object_has_visitor_injected) {
     for (auto& pair : m.objects()) {
         const auto& n(pair.second.name());
         if (factory.is_type_name_n(1, n)) {
-            auto& ao(pair.second);
+            auto& o(pair.second);
             BOOST_LOG_SEV(lg, debug) << "found object: " << n.qualified();
-            ao.is_visitable(true);
+            o.is_visitable(true);
         }
     }
     BOOST_LOG_SEV(lg, debug) << "before: " << m;
@@ -112,30 +112,23 @@ BOOST_AUTO_TEST_CASE(visitable_object_has_visitor_injected) {
     i.inject(m);
     BOOST_LOG_SEV(lg, debug) << "after: " << m;
 
-    BOOST_CHECK(m.objects().size() == 3);
-    bool type_one(false), visitor(false);
+    BOOST_CHECK(m.objects().size() == 2);
+    bool type_one(false);
     for (const auto& pair : m.objects()) {
         const auto& n(pair.second.name());
         if (factory.is_type_name_n(1, n)) {
             BOOST_LOG_SEV(lg, debug) << "found object: " << n.qualified();
             type_one = true;
-        } else if (factory.is_type_name_n_visitor(1, n)) {
-            visitor = true;
-            BOOST_LOG_SEV(lg, debug) << "found object: " << n.qualified();
-
-            const auto& o(pair.second);
-            BOOST_CHECK(o.object_type() == object_types::visitor);
-            BOOST_CHECK(!o.is_visitable());
-            BOOST_CHECK(!o.is_immutable());
-            BOOST_CHECK(o.parents().empty());
-            BOOST_CHECK(o.root_parents().empty());
-            BOOST_CHECK(o.modeled_concepts().empty());
-            BOOST_CHECK(o.leaves().empty());
         }
     }
-
     BOOST_CHECK(type_one);
-    BOOST_CHECK(visitor);
+
+    BOOST_REQUIRE(m.visitors().size() == 1);
+    const auto v(m.visitors().begin()->second);
+    BOOST_LOG_SEV(lg, debug) << "found visitor: " << v.name().qualified();
+    BOOST_CHECK(factory.is_type_name_n_visitor(1, v.name()));
+    BOOST_REQUIRE(v.visits().size() == 1);
+    BOOST_CHECK(factory.is_type_name_n(0, v.visits().front()));
 }
 
 BOOST_AUTO_TEST_SUITE_END()
diff --git a/projects/yarn/src/hash/intermediate_model_hash.cpp b/projects/yarn/src/hash/intermediate_model_hash.cpp
index 7a1b13d..61db4d2 100644
--- a/projects/yarn/src/hash/intermediate_model_hash.cpp
+++ b/projects/yarn/src/hash/intermediate_model_hash.cpp
@@ -22,6 +22,8 @@
 #include "dogen/yarn/hash/module_hash.hpp"
 #include "dogen/yarn/hash/object_hash.hpp"
 #include "dogen/yarn/hash/concept_hash.hpp"
+#include "dogen/yarn/hash/visitor_hash.hpp"
+#include "dogen/yarn/hash/exception_hash.hpp"
 #include "dogen/yarn/hash/primitive_hash.hpp"
 #include "dogen/yarn/hash/enumeration_hash.hpp"
 #include "dogen/yarn/hash/origin_types_hash.hpp"
@@ -98,6 +100,24 @@ inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_object(const std
     return seed;
 }
 
+inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_exception(const std::unordered_map<std::string, dogen::yarn::exception>& v) {
+    std::size_t seed(0);
+    for (const auto i : v) {
+        combine(seed, i.first);
+        combine(seed, i.second);
+    }
+    return seed;
+}
+
+inline std::size_t hash_std_unordered_map_std_string_dogen_yarn_visitor(const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
+    std::size_t seed(0);
+    for (const auto i : v) {
+        combine(seed, i.first);
+        combine(seed, i.second);
+    }
+    return seed;
+}
+
 }
 
 namespace dogen {
@@ -117,6 +137,8 @@ std::size_t intermediate_model_hasher::hash(const intermediate_model& v) {
     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_primitive(v.primitives()));
     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_enumeration(v.enumerations()));
     combine(seed, hash_std_unordered_map_std_string_dogen_yarn_object(v.objects()));
+    combine(seed, hash_std_unordered_map_std_string_dogen_yarn_exception(v.exceptions()));
+    combine(seed, hash_std_unordered_map_std_string_dogen_yarn_visitor(v.visitors()));
     combine(seed, v.is_target());
     combine(seed, v.has_generatable_types());
 
diff --git a/projects/yarn/src/hash/object_hash.cpp b/projects/yarn/src/hash/object_hash.cpp
index 183ca28..1f7a5dd 100644
--- a/projects/yarn/src/hash/object_hash.cpp
+++ b/projects/yarn/src/hash/object_hash.cpp
@@ -82,8 +82,7 @@ std::size_t object_hasher::hash(const object& v) {
     combine(seed, hash_std_list_dogen_yarn_name(v.weak_associations()));
     combine(seed, v.is_visitable());
     combine(seed, v.is_root_parent_visitable());
-    combine(seed, hash_std_list_dogen_yarn_name(v.visits()));
-    combine(seed, hash_std_list_dogen_yarn_name(v.visited_by()));
+    combine(seed, hash_std_list_dogen_yarn_name(v.visitable_by()));
     combine(seed, v.object_type());
     combine(seed, hash_std_list_dogen_yarn_name(v.modeled_concepts()));
     combine(seed, hash_std_list_dogen_yarn_name(v.hash_container_keys()));
diff --git a/projects/yarn/src/hash/visitor_hash.cpp b/projects/yarn/src/hash/visitor_hash.cpp
index 500338f..9d623e4 100644
--- a/projects/yarn/src/hash/visitor_hash.cpp
+++ b/projects/yarn/src/hash/visitor_hash.cpp
@@ -18,6 +18,7 @@
  * MA 02110-1301, USA.
  *
  */
+#include "dogen/yarn/hash/name_hash.hpp"
 #include "dogen/yarn/hash/element_hash.hpp"
 #include "dogen/yarn/hash/visitor_hash.hpp"
 
@@ -29,6 +30,14 @@ inline void combine(std::size_t& seed, const HashableType& value) {
     seed ^= hasher(value) + 0x9e3779b9 + (seed << 6) + (seed >> 2);
 }
 
+inline std::size_t hash_std_list_dogen_yarn_name(const std::list<dogen::yarn::name>& v) {
+    std::size_t seed(0);
+    for (const auto i : v) {
+        combine(seed, i);
+    }
+    return seed;
+}
+
 }
 
 namespace dogen {
@@ -38,6 +47,8 @@ std::size_t visitor_hasher::hash(const visitor& v) {
     std::size_t seed(0);
 
     combine(seed, dynamic_cast<const dogen::yarn::element&>(v));
+
+    combine(seed, hash_std_list_dogen_yarn_name(v.visits()));
     return seed;
 }
 
diff --git a/projects/yarn/src/io/intermediate_model_io.cpp b/projects/yarn/src/io/intermediate_model_io.cpp
index 01ecf4b..b864b48 100644
--- a/projects/yarn/src/io/intermediate_model_io.cpp
+++ b/projects/yarn/src/io/intermediate_model_io.cpp
@@ -25,6 +25,8 @@
 #include "dogen/yarn/io/module_io.hpp"
 #include "dogen/yarn/io/object_io.hpp"
 #include "dogen/yarn/io/concept_io.hpp"
+#include "dogen/yarn/io/visitor_io.hpp"
+#include "dogen/yarn/io/exception_io.hpp"
 #include "dogen/yarn/io/primitive_io.hpp"
 #include "dogen/yarn/io/enumeration_io.hpp"
 #include "dogen/yarn/io/origin_types_io.hpp"
@@ -160,6 +162,42 @@ inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::s
 
 }
 
+namespace std {
+
+inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::string, dogen::yarn::exception>& v) {
+    s << "[";
+    for (auto i(v.begin()); i != v.end(); ++i) {
+        if (i != v.begin()) s << ", ";
+        s << "[ { " << "\"__type__\": " << "\"key\"" << ", " << "\"data\": ";
+        s << "\"" << tidy_up_string(i->first) << "\"";
+        s << " }, { " << "\"__type__\": " << "\"value\"" << ", " << "\"data\": ";
+        s << i->second;
+        s << " } ]";
+    }
+    s << " ] ";
+    return s;
+}
+
+}
+
+namespace std {
+
+inline std::ostream& operator<<(std::ostream& s, const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
+    s << "[";
+    for (auto i(v.begin()); i != v.end(); ++i) {
+        if (i != v.begin()) s << ", ";
+        s << "[ { " << "\"__type__\": " << "\"key\"" << ", " << "\"data\": ";
+        s << "\"" << tidy_up_string(i->first) << "\"";
+        s << " }, { " << "\"__type__\": " << "\"value\"" << ", " << "\"data\": ";
+        s << i->second;
+        s << " } ]";
+    }
+    s << " ] ";
+    return s;
+}
+
+}
+
 namespace dogen {
 namespace yarn {
 
@@ -183,6 +221,8 @@ std::ostream& operator<<(std::ostream& s, const intermediate_model& v) {
       << "\"primitives\": " << v.primitives() << ", "
       << "\"enumerations\": " << v.enumerations() << ", "
       << "\"objects\": " << v.objects() << ", "
+      << "\"exceptions\": " << v.exceptions() << ", "
+      << "\"visitors\": " << v.visitors() << ", "
       << "\"is_target\": " << v.is_target() << ", "
       << "\"has_generatable_types\": " << v.has_generatable_types()
       << " }";
diff --git a/projects/yarn/src/io/object_types_io.cpp b/projects/yarn/src/io/object_types_io.cpp
index fdcc533..cde9da8 100644
--- a/projects/yarn/src/io/object_types_io.cpp
+++ b/projects/yarn/src/io/object_types_io.cpp
@@ -37,15 +37,9 @@ std::ostream& operator<<(std::ostream& s, const object_types& v) {
     case object_types::user_defined_service:
         attr = "\"user_defined_service\"";
         break;
-    case object_types::visitor:
-        attr = "\"visitor\"";
-        break;
     case object_types::user_defined_value_object:
         attr = "\"user_defined_value_object\"";
         break;
-    case object_types::exception:
-        attr = "\"exception\"";
-        break;
     case object_types::smart_pointer:
         attr = "\"smart_pointer\"";
         break;
diff --git a/projects/yarn/src/io/visitor_io.cpp b/projects/yarn/src/io/visitor_io.cpp
index bb791dc..3b4460b 100644
--- a/projects/yarn/src/io/visitor_io.cpp
+++ b/projects/yarn/src/io/visitor_io.cpp
@@ -19,6 +19,7 @@
  *
  */
 #include <ostream>
+#include "dogen/yarn/io/name_io.hpp"
 #include "dogen/yarn/io/element_io.hpp"
 #include "dogen/yarn/io/visitor_io.hpp"
 
diff --git a/projects/yarn/src/serialization/intermediate_model_ser.cpp b/projects/yarn/src/serialization/intermediate_model_ser.cpp
index 6c05dbd..6ff2886 100644
--- a/projects/yarn/src/serialization/intermediate_model_ser.cpp
+++ b/projects/yarn/src/serialization/intermediate_model_ser.cpp
@@ -32,6 +32,8 @@
 #include "dogen/yarn/serialization/module_ser.hpp"
 #include "dogen/yarn/serialization/object_ser.hpp"
 #include "dogen/yarn/serialization/concept_ser.hpp"
+#include "dogen/yarn/serialization/visitor_ser.hpp"
+#include "dogen/yarn/serialization/exception_ser.hpp"
 #include "dogen/yarn/serialization/primitive_ser.hpp"
 #include "dogen/yarn/serialization/enumeration_ser.hpp"
 #include "dogen/utility/serialization/unordered_map.hpp"
@@ -58,6 +60,8 @@ void save(Archive& ar,
     ar << make_nvp("primitives", v.primitives_);
     ar << make_nvp("enumerations", v.enumerations_);
     ar << make_nvp("objects", v.objects_);
+    ar << make_nvp("exceptions", v.exceptions_);
+    ar << make_nvp("visitors", v.visitors_);
     ar << make_nvp("is_target", v.is_target_);
     ar << make_nvp("has_generatable_types", v.has_generatable_types_);
 }
@@ -77,6 +81,8 @@ void load(Archive& ar,
     ar >> make_nvp("primitives", v.primitives_);
     ar >> make_nvp("enumerations", v.enumerations_);
     ar >> make_nvp("objects", v.objects_);
+    ar >> make_nvp("exceptions", v.exceptions_);
+    ar >> make_nvp("visitors", v.visitors_);
     ar >> make_nvp("is_target", v.is_target_);
     ar >> make_nvp("has_generatable_types", v.has_generatable_types_);
 }
diff --git a/projects/yarn/src/serialization/object_ser.cpp b/projects/yarn/src/serialization/object_ser.cpp
index 2de37cf..640fe4f 100644
--- a/projects/yarn/src/serialization/object_ser.cpp
+++ b/projects/yarn/src/serialization/object_ser.cpp
@@ -63,8 +63,7 @@ void save(Archive& ar,
     ar << make_nvp("weak_associations", v.weak_associations_);
     ar << make_nvp("is_visitable", v.is_visitable_);
     ar << make_nvp("is_root_parent_visitable", v.is_root_parent_visitable_);
-    ar << make_nvp("visits", v.visits_);
-    ar << make_nvp("visited_by", v.visited_by_);
+    ar << make_nvp("visitable_by", v.visitable_by_);
     ar << make_nvp("object_type", v.object_type_);
     ar << make_nvp("modeled_concepts", v.modeled_concepts_);
     ar << make_nvp("hash_container_keys", v.hash_container_keys_);
@@ -91,8 +90,7 @@ void load(Archive& ar,
     ar >> make_nvp("weak_associations", v.weak_associations_);
     ar >> make_nvp("is_visitable", v.is_visitable_);
     ar >> make_nvp("is_root_parent_visitable", v.is_root_parent_visitable_);
-    ar >> make_nvp("visits", v.visits_);
-    ar >> make_nvp("visited_by", v.visited_by_);
+    ar >> make_nvp("visitable_by", v.visitable_by_);
     ar >> make_nvp("object_type", v.object_type_);
     ar >> make_nvp("modeled_concepts", v.modeled_concepts_);
     ar >> make_nvp("hash_container_keys", v.hash_container_keys_);
diff --git a/projects/yarn/src/serialization/visitor_ser.cpp b/projects/yarn/src/serialization/visitor_ser.cpp
index 866063c..7b82af7 100644
--- a/projects/yarn/src/serialization/visitor_ser.cpp
+++ b/projects/yarn/src/serialization/visitor_ser.cpp
@@ -19,6 +19,7 @@
  *
  */
 #include <boost/serialization/nvp.hpp>
+#include <boost/serialization/list.hpp>
 #include <boost/archive/xml_iarchive.hpp>
 #include <boost/archive/xml_oarchive.hpp>
 #include <boost/archive/text_iarchive.hpp>
@@ -27,6 +28,7 @@
 #include <boost/archive/binary_oarchive.hpp>
 #include <boost/archive/polymorphic_iarchive.hpp>
 #include <boost/archive/polymorphic_oarchive.hpp>
+#include "dogen/yarn/serialization/name_ser.hpp"
 #include "dogen/yarn/serialization/element_ser.hpp"
 #include "dogen/yarn/serialization/visitor_ser.hpp"
 
@@ -42,6 +44,8 @@ void save(Archive& ar,
     const dogen::yarn::visitor& v,
     const unsigned int /*version*/) {
     ar << make_nvp("element", base_object<dogen::yarn::element>(v));
+
+    ar << make_nvp("visits", v.visits_);
 }
 
 template<typename Archive>
@@ -49,6 +53,8 @@ void load(Archive& ar,
     dogen::yarn::visitor& v,
     const unsigned int /*version*/) {
     ar >> make_nvp("element", base_object<dogen::yarn::element>(v));
+
+    ar >> make_nvp("visits", v.visits_);
 }
 
 } }
diff --git a/projects/yarn/src/test/mock_intermediate_model_factory.cpp b/projects/yarn/src/test/mock_intermediate_model_factory.cpp
index a747bee..e8beccf 100644
--- a/projects/yarn/src/test/mock_intermediate_model_factory.cpp
+++ b/projects/yarn/src/test/mock_intermediate_model_factory.cpp
@@ -541,7 +541,7 @@ make_enumeration(const unsigned int i, const name& model_name,
     return r;
 }
 
-object mock_intermediate_model_factory::make_exception(const unsigned int i,
+exception mock_intermediate_model_factory::make_exception(const unsigned int i,
     const name& model_name, const unsigned int module_n) const {
 
     const auto sn(type_name(i));
@@ -550,11 +550,10 @@ object mock_intermediate_model_factory::make_exception(const unsigned int i,
     dogen::yarn::name_factory nf;
     dogen::yarn::name n(nf.build_element_in_model(model_name, sn, ipp));
 
-    object r;
+    exception r;
     r.name(n);
     r.generation_type(generation_types::full_generation);
     r.documentation(documentation);
-    r.object_type(dogen::yarn::object_types::exception);
 
     if (flags_.tagged())
         dynamic_extension_function_(r.extensions());
@@ -646,7 +645,7 @@ make_multi_type_model(const unsigned int n, const unsigned int type_n,
     case object_types::exception:
         for (unsigned int i(0); i < type_n; ++i) {
             const auto e(make_exception(i, r.name(), mod_n));
-            insert_object(r, e);
+            insert_nameable(r.exceptions(), e);
         }
         break;
     default:
diff --git a/projects/yarn/src/test_data/intermediate_model_td.cpp b/projects/yarn/src/test_data/intermediate_model_td.cpp
index 28c2316..60076b1 100644
--- a/projects/yarn/src/test_data/intermediate_model_td.cpp
+++ b/projects/yarn/src/test_data/intermediate_model_td.cpp
@@ -23,6 +23,8 @@
 #include "dogen/yarn/test_data/module_td.hpp"
 #include "dogen/yarn/test_data/object_td.hpp"
 #include "dogen/yarn/test_data/concept_td.hpp"
+#include "dogen/yarn/test_data/visitor_td.hpp"
+#include "dogen/yarn/test_data/exception_td.hpp"
 #include "dogen/yarn/test_data/primitive_td.hpp"
 #include "dogen/yarn/test_data/enumeration_td.hpp"
 #include "dogen/yarn/test_data/origin_types_td.hpp"
@@ -133,6 +135,32 @@ std::unordered_map<std::string, dogen::yarn::object> create_std_unordered_map_st
     return r;
 }
 
+dogen::yarn::exception
+create_dogen_yarn_exception(const unsigned int position) {
+    return dogen::yarn::exception_generator::create(position);
+}
+
+std::unordered_map<std::string, dogen::yarn::exception> create_std_unordered_map_std_string_dogen_yarn_exception(unsigned int position) {
+    std::unordered_map<std::string, dogen::yarn::exception> r;
+    for (unsigned int i(0); i < 4; ++i) {
+        r.insert(std::make_pair(create_std_string(position + i), create_dogen_yarn_exception(position + i)));
+    }
+    return r;
+}
+
+dogen::yarn::visitor
+create_dogen_yarn_visitor(const unsigned int position) {
+    return dogen::yarn::visitor_generator::create(position);
+}
+
+std::unordered_map<std::string, dogen::yarn::visitor> create_std_unordered_map_std_string_dogen_yarn_visitor(unsigned int position) {
+    std::unordered_map<std::string, dogen::yarn::visitor> r;
+    for (unsigned int i(0); i < 4; ++i) {
+        r.insert(std::make_pair(create_std_string(position + i), create_dogen_yarn_visitor(position + i)));
+    }
+    return r;
+}
+
 bool create_bool(const unsigned int position) {
     return (position % 2) == 0;
 }
@@ -157,8 +185,10 @@ populate(const unsigned int position, result_type& v) {
     v.primitives(create_std_unordered_map_std_string_dogen_yarn_primitive(position + 8));
     v.enumerations(create_std_unordered_map_std_string_dogen_yarn_enumeration(position + 9));
     v.objects(create_std_unordered_map_std_string_dogen_yarn_object(position + 10));
-    v.is_target(create_bool(position + 11));
-    v.has_generatable_types(create_bool(position + 12));
+    v.exceptions(create_std_unordered_map_std_string_dogen_yarn_exception(position + 11));
+    v.visitors(create_std_unordered_map_std_string_dogen_yarn_visitor(position + 12));
+    v.is_target(create_bool(position + 13));
+    v.has_generatable_types(create_bool(position + 14));
 }
 
 intermediate_model_generator::result_type
diff --git a/projects/yarn/src/test_data/object_td.cpp b/projects/yarn/src/test_data/object_td.cpp
index 4f70aca..c0857c4 100644
--- a/projects/yarn/src/test_data/object_td.cpp
+++ b/projects/yarn/src/test_data/object_td.cpp
@@ -94,11 +94,10 @@ populate(const unsigned int position, result_type& v) {
     v.weak_associations(create_std_list_dogen_yarn_name(position + 12));
     v.is_visitable(create_bool(position + 13));
     v.is_root_parent_visitable(create_bool(position + 14));
-    v.visits(create_std_list_dogen_yarn_name(position + 15));
-    v.visited_by(create_std_list_dogen_yarn_name(position + 16));
-    v.object_type(create_dogen_yarn_object_types(position + 17));
-    v.modeled_concepts(create_std_list_dogen_yarn_name(position + 18));
-    v.hash_container_keys(create_std_list_dogen_yarn_name(position + 19));
+    v.visitable_by(create_std_list_dogen_yarn_name(position + 15));
+    v.object_type(create_dogen_yarn_object_types(position + 16));
+    v.modeled_concepts(create_std_list_dogen_yarn_name(position + 17));
+    v.hash_container_keys(create_std_list_dogen_yarn_name(position + 18));
 }
 
 object_generator::result_type
diff --git a/projects/yarn/src/test_data/object_types_td.cpp b/projects/yarn/src/test_data/object_types_td.cpp
index 2aae707..ed8395a 100644
--- a/projects/yarn/src/test_data/object_types_td.cpp
+++ b/projects/yarn/src/test_data/object_types_td.cpp
@@ -26,7 +26,7 @@ namespace yarn {
 object_types_generator::object_types_generator() : position_(0) { }
 void object_types_generator::
 populate(const unsigned int position, result_type& v) {
-    v = static_cast<object_types>(position % 9);
+    v = static_cast<object_types>(position % 7);
 }
 
 object_types_generator::result_type
diff --git a/projects/yarn/src/test_data/visitor_td.cpp b/projects/yarn/src/test_data/visitor_td.cpp
index 7cec9fd..cf2f1bc 100644
--- a/projects/yarn/src/test_data/visitor_td.cpp
+++ b/projects/yarn/src/test_data/visitor_td.cpp
@@ -18,9 +18,27 @@
  * MA 02110-1301, USA.
  *
  */
+#include "dogen/yarn/test_data/name_td.hpp"
 #include "dogen/yarn/test_data/element_td.hpp"
 #include "dogen/yarn/test_data/visitor_td.hpp"
 
+namespace {
+
+dogen::yarn::name
+create_dogen_yarn_name(const unsigned int position) {
+    return dogen::yarn::name_generator::create(position);
+}
+
+std::list<dogen::yarn::name> create_std_list_dogen_yarn_name(unsigned int position) {
+    std::list<dogen::yarn::name> r;
+    for (unsigned int i(0); i < 4; ++i) {
+        r.push_back(create_dogen_yarn_name(position + i));
+    }
+    return r;
+}
+
+}
+
 namespace dogen {
 namespace yarn {
 
@@ -29,6 +47,7 @@ visitor_generator::visitor_generator() : position_(0) { }
 void visitor_generator::
 populate(const unsigned int position, result_type& v) {
     dogen::yarn::element_generator::populate(position, v);
+    v.visits(create_std_list_dogen_yarn_name(position + 0));
 }
 
 visitor_generator::result_type
diff --git a/projects/yarn/src/types/injector.cpp b/projects/yarn/src/types/injector.cpp
index 0591859..8edb006 100644
--- a/projects/yarn/src/types/injector.cpp
+++ b/projects/yarn/src/types/injector.cpp
@@ -73,25 +73,17 @@ inline void add_containing_module_to_non_contained_entities(
     }
 }
 
-class injector::context {
-public:
-    context(yarn::intermediate_model& m) : model_(m) { }
-
-public:
-    yarn::intermediate_model& model() { return model_; }
-
-private:
-    yarn::intermediate_model& model_;
-};
-
-bool injector::insert(const object& o) {
-    const auto i(context_->model().objects().insert(
-            std::make_pair(o.name().qualified(), o)));
-
-    return i.second;
+module injector::create_global_module() const {
+    name qn;
+    module r;
+    r.name(qn);
+    r.generation_type(generation_types::no_generation);
+    r.origin_type(origin_types::system);
+    r.documentation(global_module_doc);
+    return r;
 }
 
-object injector::
+visitor injector::
 create_visitor(const object& o, const std::list<name>& leaves) const {
     name_builder b;
     b.simple_name(o.name().simple() + "_" + visitor_name);
@@ -109,12 +101,10 @@ create_visitor(const object& o, const std::list<name>& leaves) const {
     const auto n(b.build());
     BOOST_LOG_SEV(lg, debug) << "Creating visitor: " << n.qualified();
 
-    object r;
+    visitor r;
     r.name(n);
-    r.is_final(true);
     r.generation_type(o.generation_type());
     r.origin_type(origin_types::system);
-    r.object_type(object_types::visitor);
     r.documentation(visitor_doc + o.name().simple());
 
     for (const auto& l : leaves)
@@ -124,29 +114,29 @@ create_visitor(const object& o, const std::list<name>& leaves) const {
     return r;
 }
 
-void injector::inject_visited_by(object& root, const std::list<name>& leaves,
-    const name& visitor) const {
+void injector::inject_visitable_by(object& root, const std::list<name>& leaves,
+    const name& visitor, intermediate_model& m) const {
 
-    root.visited_by().push_back(visitor);
+    root.visitable_by().push_back(visitor);
 
     for (const auto& l : leaves) {
-        auto i(context_->model().objects().find(l.qualified()));
-        if (i == context_->model().objects().end()) {
+        auto i(m.objects().find(l.qualified()));
+        if (i == m.objects().end()) {
             const auto qn(l.qualified());
             BOOST_LOG_SEV(lg, error) << leaf_not_found << qn;
             BOOST_THROW_EXCEPTION(injection_error(leaf_not_found + qn));
         }
 
         auto& leaf(i->second);
-        leaf.visited_by().push_back(visitor);
+        leaf.visitable_by().push_back(visitor);
     }
 }
 
-void injector::inject_visitors() {
+void injector::inject_visitors(intermediate_model& m) {
     BOOST_LOG_SEV(lg, debug) << "Injecting visitors.";
 
-    std::list<object> visitors;
-    for (auto& pair : context_->model().objects()) {
+    std::list<visitor> visitors;
+    for (auto& pair : m.objects()) {
         auto& o(pair.second);
 
         if (!o.is_visitable())
@@ -159,15 +149,17 @@ void injector::inject_visitors() {
         }
 
         const auto v(create_visitor(o, o.leaves()));
+        inject_visitable_by(o, o.leaves(), v.name(), m);
         visitors.push_back(v);
-        inject_visited_by(o, o.leaves(), v.name());
     }
 
     for (const auto v : visitors) {
         BOOST_LOG_SEV(lg, debug) << "Adding visitor: "
                                  << v.name().qualified();
 
-        if (!insert(v)) {
+        const auto pair(std::make_pair(v.name().qualified(), v));
+        const auto i(m.visitors().insert(pair));
+        if (!i.second) {
             const auto qn(v.name().qualified());
             BOOST_LOG_SEV(lg, error) << duplicate_name << qn;
             BOOST_THROW_EXCEPTION(injection_error(duplicate_name + qn));
@@ -177,37 +169,31 @@ void injector::inject_visitors() {
     BOOST_LOG_SEV(lg, debug) << "Done injecting visitors.";
 }
 
-void injector::inject_global_module() {
-    name qn;
+void injector::inject_global_module(intermediate_model& m) {
+    const auto gm(create_global_module());
 
-    auto& model(context_->model());
-    const auto i(model.modules().find(qn.qualified()));
-    if (i != model.modules().end()) {
-        const auto qn(model.name().qualified());
+    const auto gmn(gm.name());
+    const auto i(m.modules().find(gmn.qualified()));
+    if (i != m.modules().end()) {
+        const auto qn(m.name().qualified());
         BOOST_LOG_SEV(lg, error) << model_already_has_global_module << qn;
         BOOST_THROW_EXCEPTION(injection_error(
                 model_already_has_global_module + qn));
     }
-
-    add_containing_module_to_non_contained_entities(qn, model.modules());
-    add_containing_module_to_non_contained_entities(qn, model.concepts());
-    add_containing_module_to_non_contained_entities(qn, model.primitives());
-    add_containing_module_to_non_contained_entities(qn, model.enumerations());
-    add_containing_module_to_non_contained_entities(qn, model.objects());
-
-    module global_module;
-    global_module.name(qn);
-    global_module.generation_type(generation_types::no_generation);
-    global_module.origin_type(origin_types::system);
-    global_module.documentation(global_module_doc);
-    model.modules().insert(std::make_pair(qn.qualified(), global_module));
+    m.modules().insert(std::make_pair(gmn.qualified(), gm));
+
+    add_containing_module_to_non_contained_entities(gmn, m.modules());
+    add_containing_module_to_non_contained_entities(gmn, m.concepts());
+    add_containing_module_to_non_contained_entities(gmn, m.primitives());
+    add_containing_module_to_non_contained_entities(gmn, m.enumerations());
+    add_containing_module_to_non_contained_entities(gmn, m.objects());
+    add_containing_module_to_non_contained_entities(gmn, m.exceptions());
+    add_containing_module_to_non_contained_entities(gmn, m.visitors());
 }
 
 void injector::inject(intermediate_model& m) {
-    context_ = std::unique_ptr<context>(new context(m));
-    inject_visitors();
-    inject_global_module();
-    context_ = std::unique_ptr<context>();
+    inject_visitors(m);
+    inject_global_module(m);
 }
 
 } }
diff --git a/projects/yarn/src/types/intermediate_model.cpp b/projects/yarn/src/types/intermediate_model.cpp
index a0d6b23..8e3e10c 100644
--- a/projects/yarn/src/types/intermediate_model.cpp
+++ b/projects/yarn/src/types/intermediate_model.cpp
@@ -41,6 +41,8 @@ intermediate_model::intermediate_model(
     const std::unordered_map<std::string, dogen::yarn::primitive>& primitives,
     const std::unordered_map<std::string, dogen::yarn::enumeration>& enumerations,
     const std::unordered_map<std::string, dogen::yarn::object>& objects,
+    const std::unordered_map<std::string, dogen::yarn::exception>& exceptions,
+    const std::unordered_map<std::string, dogen::yarn::visitor>& visitors,
     const bool is_target,
     const bool has_generatable_types)
     : name_(name),
@@ -54,6 +56,8 @@ intermediate_model::intermediate_model(
       primitives_(primitives),
       enumerations_(enumerations),
       objects_(objects),
+      exceptions_(exceptions),
+      visitors_(visitors),
       is_target_(is_target),
       has_generatable_types_(has_generatable_types) { }
 
@@ -70,6 +74,8 @@ void intermediate_model::swap(intermediate_model& other) noexcept {
     swap(primitives_, other.primitives_);
     swap(enumerations_, other.enumerations_);
     swap(objects_, other.objects_);
+    swap(exceptions_, other.exceptions_);
+    swap(visitors_, other.visitors_);
     swap(is_target_, other.is_target_);
     swap(has_generatable_types_, other.has_generatable_types_);
 }
@@ -86,6 +92,8 @@ bool intermediate_model::operator==(const intermediate_model& rhs) const {
         primitives_ == rhs.primitives_ &&
         enumerations_ == rhs.enumerations_ &&
         objects_ == rhs.objects_ &&
+        exceptions_ == rhs.exceptions_ &&
+        visitors_ == rhs.visitors_ &&
         is_target_ == rhs.is_target_ &&
         has_generatable_types_ == rhs.has_generatable_types_;
 }
@@ -256,6 +264,38 @@ void intermediate_model::objects(const std::unordered_map<std::string, dogen::ya
     objects_ = std::move(v);
 }
 
+const std::unordered_map<std::string, dogen::yarn::exception>& intermediate_model::exceptions() const {
+    return exceptions_;
+}
+
+std::unordered_map<std::string, dogen::yarn::exception>& intermediate_model::exceptions() {
+    return exceptions_;
+}
+
+void intermediate_model::exceptions(const std::unordered_map<std::string, dogen::yarn::exception>& v) {
+    exceptions_ = v;
+}
+
+void intermediate_model::exceptions(const std::unordered_map<std::string, dogen::yarn::exception>&& v) {
+    exceptions_ = std::move(v);
+}
+
+const std::unordered_map<std::string, dogen::yarn::visitor>& intermediate_model::visitors() const {
+    return visitors_;
+}
+
+std::unordered_map<std::string, dogen::yarn::visitor>& intermediate_model::visitors() {
+    return visitors_;
+}
+
+void intermediate_model::visitors(const std::unordered_map<std::string, dogen::yarn::visitor>& v) {
+    visitors_ = v;
+}
+
+void intermediate_model::visitors(const std::unordered_map<std::string, dogen::yarn::visitor>&& v) {
+    visitors_ = std::move(v);
+}
+
 bool intermediate_model::is_target() const {
     return is_target_;
 }
diff --git a/projects/yarn/src/types/modules_expander.cpp b/projects/yarn/src/types/modules_expander.cpp
index 20d632f..ef0e401 100644
--- a/projects/yarn/src/types/modules_expander.cpp
+++ b/projects/yarn/src/types/modules_expander.cpp
@@ -47,11 +47,13 @@ private:
     void process(const name& n);
 
 public:
-    void operator()(dogen::yarn::object& o) { process(o.name()); }
-    void operator()(dogen::yarn::enumeration& e) { process(e.name()); }
-    void operator()(dogen::yarn::primitive& p) { process(p.name()); }
     void operator()(dogen::yarn::module& m) { process(m.name()); }
     void operator()(dogen::yarn::concept& c) { process(c.name()); }
+    void operator()(dogen::yarn::primitive& p) { process(p.name()); }
+    void operator()(dogen::yarn::enumeration& e) { process(e.name()); }
+    void operator()(dogen::yarn::object& o) { process(o.name()); }
+    void operator()(dogen::yarn::exception& e) { process(e.name()); }
+    void operator()(dogen::yarn::visitor& v) { process(v.name()); }
 
 public:
     const std::unordered_map<std::string, std::list<std::string>>&
@@ -85,11 +87,13 @@ private:
     void update(element& e);
 
 public:
-    void operator()(dogen::yarn::object& o) { update(o); }
-    void operator()(dogen::yarn::enumeration& e) { update(e); }
-    void operator()(dogen::yarn::primitive& p) { update(p); }
     void operator()(dogen::yarn::module& m) { update(m); }
     void operator()(dogen::yarn::concept& c) { update(c); }
+    void operator()(dogen::yarn::primitive& p) { update(p); }
+    void operator()(dogen::yarn::enumeration& e) { update(e); }
+    void operator()(dogen::yarn::object& o) { update(o); }
+    void operator()(dogen::yarn::exception& e) { update(e); }
+    void operator()(dogen::yarn::visitor& v) { update(v); }
 
 public:
     intermediate_model& model_;
diff --git a/projects/yarn/src/types/object.cpp b/projects/yarn/src/types/object.cpp
index d62e4af..2c273fb 100644
--- a/projects/yarn/src/types/object.cpp
+++ b/projects/yarn/src/types/object.cpp
@@ -109,8 +109,7 @@ object::object(
     const std::list<dogen::yarn::name>& weak_associations,
     const bool is_visitable,
     const bool is_root_parent_visitable,
-    const std::list<dogen::yarn::name>& visits,
-    const std::list<dogen::yarn::name>& visited_by,
+    const std::list<dogen::yarn::name>& visitable_by,
     const dogen::yarn::object_types object_type,
     const std::list<dogen::yarn::name>& modeled_concepts,
     const std::list<dogen::yarn::name>& hash_container_keys)
@@ -138,8 +137,7 @@ object::object(
       weak_associations_(weak_associations),
       is_visitable_(is_visitable),
       is_root_parent_visitable_(is_root_parent_visitable),
-      visits_(visits),
-      visited_by_(visited_by),
+      visitable_by_(visitable_by),
       object_type_(object_type),
       modeled_concepts_(modeled_concepts),
       hash_container_keys_(hash_container_keys) { }
@@ -171,8 +169,7 @@ void object::to_stream(std::ostream& s) const {
       << "\"weak_associations\": " << weak_associations_ << ", "
       << "\"is_visitable\": " << is_visitable_ << ", "
       << "\"is_root_parent_visitable\": " << is_root_parent_visitable_ << ", "
-      << "\"visits\": " << visits_ << ", "
-      << "\"visited_by\": " << visited_by_ << ", "
+      << "\"visitable_by\": " << visitable_by_ << ", "
       << "\"object_type\": " << object_type_ << ", "
       << "\"modeled_concepts\": " << modeled_concepts_ << ", "
       << "\"hash_container_keys\": " << hash_container_keys_
@@ -198,8 +195,7 @@ void object::swap(object& other) noexcept {
     swap(weak_associations_, other.weak_associations_);
     swap(is_visitable_, other.is_visitable_);
     swap(is_root_parent_visitable_, other.is_root_parent_visitable_);
-    swap(visits_, other.visits_);
-    swap(visited_by_, other.visited_by_);
+    swap(visitable_by_, other.visitable_by_);
     swap(object_type_, other.object_type_);
     swap(modeled_concepts_, other.modeled_concepts_);
     swap(hash_container_keys_, other.hash_container_keys_);
@@ -228,8 +224,7 @@ bool object::operator==(const object& rhs) const {
         weak_associations_ == rhs.weak_associations_ &&
         is_visitable_ == rhs.is_visitable_ &&
         is_root_parent_visitable_ == rhs.is_root_parent_visitable_ &&
-        visits_ == rhs.visits_ &&
-        visited_by_ == rhs.visited_by_ &&
+        visitable_by_ == rhs.visitable_by_ &&
         object_type_ == rhs.object_type_ &&
         modeled_concepts_ == rhs.modeled_concepts_ &&
         hash_container_keys_ == rhs.hash_container_keys_;
@@ -425,36 +420,20 @@ void object::is_root_parent_visitable(const bool v) {
     is_root_parent_visitable_ = v;
 }
 
-const std::list<dogen::yarn::name>& object::visits() const {
-    return visits_;
+const std::list<dogen::yarn::name>& object::visitable_by() const {
+    return visitable_by_;
 }
 
-std::list<dogen::yarn::name>& object::visits() {
-    return visits_;
+std::list<dogen::yarn::name>& object::visitable_by() {
+    return visitable_by_;
 }
 
-void object::visits(const std::list<dogen::yarn::name>& v) {
-    visits_ = v;
+void object::visitable_by(const std::list<dogen::yarn::name>& v) {
+    visitable_by_ = v;
 }
 
-void object::visits(const std::list<dogen::yarn::name>&& v) {
-    visits_ = std::move(v);
-}
-
-const std::list<dogen::yarn::name>& object::visited_by() const {
-    return visited_by_;
-}
-
-std::list<dogen::yarn::name>& object::visited_by() {
-    return visited_by_;
-}
-
-void object::visited_by(const std::list<dogen::yarn::name>& v) {
-    visited_by_ = v;
-}
-
-void object::visited_by(const std::list<dogen::yarn::name>&& v) {
-    visited_by_ = std::move(v);
+void object::visitable_by(const std::list<dogen::yarn::name>&& v) {
+    visitable_by_ = std::move(v);
 }
 
 dogen::yarn::object_types object::object_type() const {
diff --git a/projects/yarn/src/types/transformer.cpp b/projects/yarn/src/types/transformer.cpp
index 2017868..d54371f 100644
--- a/projects/yarn/src/types/transformer.cpp
+++ b/projects/yarn/src/types/transformer.cpp
@@ -58,11 +58,13 @@ private:
     }
 
 public:
-    void operator()(const dogen::yarn::object& o) { generate(o); }
-    void operator()(const dogen::yarn::enumeration& e) { generate(e); }
-    void operator()(const dogen::yarn::primitive& p) { generate(p); }
     void operator()(const dogen::yarn::module& m) { generate(m); }
     void operator()(const dogen::yarn::concept& c) { generate(c); }
+    void operator()(const dogen::yarn::primitive& p) { generate(p); }
+    void operator()(const dogen::yarn::enumeration& e) { generate(e); }
+    void operator()(const dogen::yarn::object& o) { generate(o); }
+    void operator()(const dogen::yarn::exception& e) { generate(e); }
+    void operator()(const dogen::yarn::visitor& v) { generate(v); }
 
 public:
     const model& result() const { return result_; }
diff --git a/projects/yarn/src/types/visitor.cpp b/projects/yarn/src/types/visitor.cpp
index 39d9d6d..520bb63 100644
--- a/projects/yarn/src/types/visitor.cpp
+++ b/projects/yarn/src/types/visitor.cpp
@@ -19,9 +19,24 @@
  *
  */
 #include <ostream>
+#include "dogen/yarn/io/name_io.hpp"
 #include "dogen/yarn/io/element_io.hpp"
 #include "dogen/yarn/types/visitor.hpp"
 
+namespace std {
+
+inline std::ostream& operator<<(std::ostream& s, const std::list<dogen::yarn::name>& v) {
+    s << "[ ";
+    for (auto i(v.begin()); i != v.end(); ++i) {
+        if (i != v.begin()) s << ", ";
+        s << *i;
+    }
+    s << "] ";
+    return s;
+}
+
+}
+
 namespace dogen {
 namespace yarn {
 
@@ -33,7 +48,8 @@ visitor::visitor(
     const dogen::yarn::origin_types origin_type,
     const std::string& original_model_name,
     const boost::optional<dogen::yarn::name>& contained_by,
-    const bool in_global_module)
+    const bool in_global_module,
+    const std::list<dogen::yarn::name>& visits)
     : dogen::yarn::element(
       documentation,
       extensions,
@@ -42,19 +58,24 @@ visitor::visitor(
       origin_type,
       original_model_name,
       contained_by,
-      in_global_module) { }
+      in_global_module),
+      visits_(visits) { }
 
 void visitor::to_stream(std::ostream& s) const {
     s << " { "
       << "\"__type__\": " << "\"dogen::yarn::visitor\"" << ", "
       << "\"__parent_0__\": ";
     element::to_stream(s);
-    s << " }";
+    s << ", "
+      << "\"visits\": " << visits_
+      << " }";
 }
 
 void visitor::swap(visitor& other) noexcept {
     element::swap(other);
 
+    using std::swap;
+    swap(visits_, other.visits_);
 }
 
 bool visitor::equals(const dogen::yarn::element& other) const {
@@ -64,7 +85,8 @@ bool visitor::equals(const dogen::yarn::element& other) const {
 }
 
 bool visitor::operator==(const visitor& rhs) const {
-    return element::compare(rhs);
+    return element::compare(rhs) &&
+        visits_ == rhs.visits_;
 }
 
 visitor& visitor::operator=(visitor other) {
@@ -73,4 +95,20 @@ visitor& visitor::operator=(visitor other) {
     return *this;
 }
 
+const std::list<dogen::yarn::name>& visitor::visits() const {
+    return visits_;
+}
+
+std::list<dogen::yarn::name>& visitor::visits() {
+    return visits_;
+}
+
+void visitor::visits(const std::list<dogen::yarn::name>& v) {
+    visits_ = v;
+}
+
+void visitor::visits(const std::list<dogen::yarn::name>&& v) {
+    visits_ = std::move(v);
+}
+
 } }
diff --git a/test_data/yarn_dia/expected/all_primitives.yarnxml b/test_data/yarn_dia/expected/all_primitives.yarnxml
index 4ba561b..2271660 100644
--- a/test_data/yarn_dia/expected/all_primitives.yarnxml
+++ b/test_data/yarn_dia/expected/all_primitives.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>all_primitives</simple>
 		<qualified>&lt;all_primitives&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,36 +24,36 @@
 	<origin_type>1</origin_type>
 	<original_model_name>all_primitives</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;all_primitives&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="19" tracking_level="0" version="0">
+							<item class_id="21" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="20" tracking_level="0" version="0">
-									<value class_id="21" tracking_level="0" version="1">
+								<second class_id="22" tracking_level="0" version="0">
+									<value class_id="23" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_1">
-											<value class_id="22" tracking_level="0" version="0"></value>
+											<value class_id="24" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -105,40 +105,40 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="23" tracking_level="0" version="0">
+					<contained_by class_id="25" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="24" tracking_level="0" version="0">
+				<members class_id="26" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;all_primitives&gt;&lt;a_class&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_4">
+			<second class_id="7" tracking_level="1" version="0" object_id="_4">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -175,14 +175,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>13</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -192,7 +192,7 @@
 							</fields>
 						</extensions>
 						<name>bool_property</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -211,7 +211,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -690,7 +690,7 @@
 						<unparsed_type>float</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -722,15 +722,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -742,6 +738,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/boost_model.yarnxml b/test_data/yarn_dia/expected/boost_model.yarnxml
index 2b7174c..439b738 100644
--- a/test_data/yarn_dia/expected/boost_model.yarnxml
+++ b/test_data/yarn_dia/expected/boost_model.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>boost_model</simple>
 		<qualified>&lt;boost_model&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>boost_model</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;boost_model&gt;&lt;pkg1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>11</count>
 		<bucket_count>23</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;boost_model&gt;&lt;class_h&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -220,14 +220,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -237,7 +237,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -256,7 +256,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -267,7 +267,7 @@
 						<unparsed_type>boost::property_tree::ptree</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -299,15 +299,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -436,15 +432,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -592,15 +584,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -769,15 +757,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -906,15 +890,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1277,15 +1257,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1531,15 +1507,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1746,14 +1718,10 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
+				</visitable_by>
 				<object_type>1</object_type>
 				<modeled_concepts>
 					<count>0</count>
@@ -2000,15 +1968,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2332,15 +2296,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2508,15 +2468,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2528,6 +2484,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/class_in_a_package.yarnxml b/test_data/yarn_dia/expected/class_in_a_package.yarnxml
index 2f694a1..2ac7b45 100644
--- a/test_data/yarn_dia/expected/class_in_a_package.yarnxml
+++ b/test_data/yarn_dia/expected/class_in_a_package.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>class_in_a_package</simple>
 		<qualified>&lt;class_in_a_package&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>class_in_a_package</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;class_in_a_package&gt;&lt;package1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;class_in_a_package&gt;&lt;package1&gt;&lt;first_class&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -221,14 +221,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>2</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -238,7 +238,7 @@
 							</fields>
 						</extensions>
 						<name>public_attribute</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -257,7 +257,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -307,7 +307,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -339,15 +339,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -359,6 +355,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/class_without_attributes.yarnxml b/test_data/yarn_dia/expected/class_without_attributes.yarnxml
index 72a2f7f..4a54394 100644
--- a/test_data/yarn_dia/expected/class_without_attributes.yarnxml
+++ b/test_data/yarn_dia/expected/class_without_attributes.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>class_without_attributes</simple>
 		<qualified>&lt;class_without_attributes&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>class_without_attributes</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;class_without_attributes&gt;&lt;package_1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;class_without_attributes&gt;&lt;package_1&gt;&lt;class_1&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -221,7 +221,7 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
@@ -229,7 +229,7 @@
 					<count>0</count>
 					<item_version>0</item_version>
 				</local_properties>
-				<inherited_properties class_id="31" tracking_level="0" version="0">
+				<inherited_properties class_id="33" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -261,15 +261,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -281,6 +277,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="34" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="35" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/class_without_package.yarnxml b/test_data/yarn_dia/expected/class_without_package.yarnxml
index b10deec..4cec608 100644
--- a/test_data/yarn_dia/expected/class_without_package.yarnxml
+++ b/test_data/yarn_dia/expected/class_without_package.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>class_without_package</simple>
 		<qualified>&lt;class_without_package&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,36 +24,36 @@
 	<origin_type>1</origin_type>
 	<original_model_name>class_without_package</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;class_without_package&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="19" tracking_level="0" version="0">
+							<item class_id="21" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="20" tracking_level="0" version="0">
-									<value class_id="21" tracking_level="0" version="1">
+								<second class_id="22" tracking_level="0" version="0">
+									<value class_id="23" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_1">
-											<value class_id="22" tracking_level="0" version="0"></value>
+											<value class_id="24" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -105,40 +105,40 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="23" tracking_level="0" version="0">
+					<contained_by class_id="25" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="24" tracking_level="0" version="0">
+				<members class_id="26" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;class_without_package&gt;&lt;class_1&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_4">
+			<second class_id="7" tracking_level="1" version="0" object_id="_4">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -175,14 +175,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -192,7 +192,7 @@
 							</fields>
 						</extensions>
 						<name>an_attribute</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -211,7 +211,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -222,7 +222,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -254,15 +254,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -274,6 +270,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/classes_inout_package.yarnxml b/test_data/yarn_dia/expected/classes_inout_package.yarnxml
index c6762dd..0a09e6f 100644
--- a/test_data/yarn_dia/expected/classes_inout_package.yarnxml
+++ b/test_data/yarn_dia/expected/classes_inout_package.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>classes_inout_package</simple>
 		<qualified>&lt;classes_inout_package&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>classes_inout_package</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;classes_inout_package&gt;&lt;package_1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;classes_inout_package&gt;&lt;class_2&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -220,14 +220,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -237,7 +237,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -256,7 +256,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -267,7 +267,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -299,15 +299,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -437,15 +433,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -457,6 +449,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/classes_without_package.yarnxml b/test_data/yarn_dia/expected/classes_without_package.yarnxml
index c40901b..8cc63de 100644
--- a/test_data/yarn_dia/expected/classes_without_package.yarnxml
+++ b/test_data/yarn_dia/expected/classes_without_package.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>classes_without_package</simple>
 		<qualified>&lt;classes_without_package&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,36 +24,36 @@
 	<origin_type>1</origin_type>
 	<original_model_name>classes_without_package</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;classes_without_package&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="19" tracking_level="0" version="0">
+							<item class_id="21" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="20" tracking_level="0" version="0">
-									<value class_id="21" tracking_level="0" version="1">
+								<second class_id="22" tracking_level="0" version="0">
+									<value class_id="23" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_1">
-											<value class_id="22" tracking_level="0" version="0"></value>
+											<value class_id="24" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -105,40 +105,40 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="23" tracking_level="0" version="0">
+					<contained_by class_id="25" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="24" tracking_level="0" version="0">
+				<members class_id="26" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>5</count>
 		<bucket_count>11</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;classes_without_package&gt;&lt;class_5&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_4">
+			<second class_id="7" tracking_level="1" version="0" object_id="_4">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -175,14 +175,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -192,7 +192,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -211,7 +211,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -222,7 +222,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -254,15 +254,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -391,15 +387,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -528,15 +520,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -665,15 +653,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -802,15 +786,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -822,6 +802,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/comments.yarnxml b/test_data/yarn_dia/expected/comments.yarnxml
index b8ad5ce..e907960 100644
--- a/test_data/yarn_dia/expected/comments.yarnxml
+++ b/test_data/yarn_dia/expected/comments.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>comments</simple>
 		<qualified>&lt;comments&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,37 +24,37 @@
 	<origin_type>1</origin_type>
 	<original_model_name>comments</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>3</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;comments&gt;&lt;package&gt;&lt;package2&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation>package2
 </documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>1</count>
 							<bucket_count>2</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="19" tracking_level="0" version="0">
+							<item class_id="21" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="20" tracking_level="0" version="0">
-									<value class_id="21" tracking_level="0" version="1">
+								<second class_id="22" tracking_level="0" version="0">
+									<value class_id="23" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_1">
-											<value class_id="22" tracking_level="0" version="0"></value>
+											<value class_id="24" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -85,12 +85,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="23" tracking_level="0" version="0">
+					<contained_by class_id="25" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="24" tracking_level="0" version="0">
+				<members class_id="26" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -235,28 +235,28 @@ This comment will be applied to the model namespace itself.
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;comments&gt;&lt;multi_line&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_8">
+			<second class_id="7" tracking_level="1" version="0" object_id="_8">
 				<element>
 					<documentation>first line
 
@@ -297,7 +297,7 @@ third line with &quot;quote&quot;
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
@@ -305,7 +305,7 @@ third line with &quot;quote&quot;
 					<count>0</count>
 					<item_version>0</item_version>
 				</local_properties>
-				<inherited_properties class_id="31" tracking_level="0" version="0">
+				<inherited_properties class_id="33" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -337,15 +337,11 @@ third line with &quot;quote&quot;
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -403,7 +399,7 @@ third line with &quot;quote&quot;
 				<local_properties>
 					<count>3</count>
 					<item_version>0</item_version>
-					<item class_id="32" tracking_level="0" version="0">
+					<item class_id="34" tracking_level="0" version="0">
 						<documentation>another brief comment
 </documentation>
 						<extensions>
@@ -414,7 +410,7 @@ third line with &quot;quote&quot;
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="33" tracking_level="0" version="0">
+						<type class_id="35" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -433,7 +429,7 @@ third line with &quot;quote&quot;
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="34" tracking_level="0" version="0">
+							<children class_id="36" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -557,15 +553,11 @@ a second line
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -577,6 +569,16 @@ a second line
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/empty.yarnxml b/test_data/yarn_dia/expected/empty.yarnxml
index 125cc69..720d972 100644
--- a/test_data/yarn_dia/expected/empty.yarnxml
+++ b/test_data/yarn_dia/expected/empty.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>empty</simple>
 		<qualified>&lt;empty&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>empty</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;empty&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,38 +72,48 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="21" tracking_level="0" version="0">
+	<concepts class_id="23" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="22" tracking_level="0" version="0">
+	<primitives class_id="24" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="23" tracking_level="0" version="0">
+	<enumerations class_id="25" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="24" tracking_level="0" version="0">
+	<objects class_id="26" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</objects>
+	<exceptions class_id="27" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="28" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/empty_package.yarnxml b/test_data/yarn_dia/expected/empty_package.yarnxml
index 20e9ce3..273f52a 100644
--- a/test_data/yarn_dia/expected/empty_package.yarnxml
+++ b/test_data/yarn_dia/expected/empty_package.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>empty_package</simple>
 		<qualified>&lt;empty_package&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>empty_package</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;empty_package&gt;&lt;package_1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -129,26 +129,36 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="21" tracking_level="0" version="0">
+	<concepts class_id="23" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="22" tracking_level="0" version="0">
+	<primitives class_id="24" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="23" tracking_level="0" version="0">
+	<enumerations class_id="25" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="24" tracking_level="0" version="0">
+	<objects class_id="26" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</objects>
+	<exceptions class_id="27" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="28" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/enumeration.yarnxml b/test_data/yarn_dia/expected/enumeration.yarnxml
index 0b62200..e104d0a 100644
--- a/test_data/yarn_dia/expected/enumeration.yarnxml
+++ b/test_data/yarn_dia/expected/enumeration.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>enumeration</simple>
 		<qualified>&lt;enumeration&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>enumeration</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;enumeration&gt;&lt;pkg1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,21 +162,21 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>3</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="28" tracking_level="0" version="0">
+		<item class_id="30" tracking_level="0" version="0">
 			<first>&lt;enumeration&gt;&lt;pkg1&gt;&lt;shape_types&gt;</first>
 			<second class_id="4" tracking_level="1" version="0" object_id="_5">
 				<element>
@@ -234,10 +234,10 @@
 						</internal_module_path>
 					</location>
 				</underlying_type>
-				<enumerators class_id="29" tracking_level="0" version="0">
+				<enumerators class_id="31" tracking_level="0" version="0">
 					<count>5</count>
 					<item_version>0</item_version>
-					<item class_id="30" tracking_level="0" version="0">
+					<item class_id="32" tracking_level="0" version="0">
 						<documentation>Represents an uninitialised enum</documentation>
 						<name>invalid</name>
 						<value>0</value>
@@ -446,13 +446,13 @@ this is a long comment
 			</second>
 		</item>
 	</enumerations>
-	<objects class_id="31" tracking_level="0" version="0">
+	<objects class_id="33" tracking_level="0" version="0">
 		<count>1</count>
 		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="32" tracking_level="0" version="0">
+		<item class_id="34" tracking_level="0" version="0">
 			<first>&lt;enumeration&gt;&lt;a_class&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_8">
+			<second class_id="7" tracking_level="1" version="0" object_id="_8">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -489,14 +489,14 @@ this is a long comment
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="33" tracking_level="0" version="0">
+				<all_properties class_id="35" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>3</count>
 					<item_version>0</item_version>
-					<item class_id="34" tracking_level="0" version="0">
+					<item class_id="36" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -506,7 +506,7 @@ this is a long comment
 							</fields>
 						</extensions>
 						<name>colour_type</name>
-						<type class_id="35" tracking_level="0" version="0">
+						<type class_id="37" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -525,7 +525,7 @@ this is a long comment
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="36" tracking_level="0" version="0">
+							<children class_id="38" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -614,7 +614,7 @@ this is a long comment
 						<unparsed_type>pkg1::shape_types</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="37" tracking_level="0" version="0">
+				<inherited_properties class_id="39" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -646,15 +646,11 @@ this is a long comment
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -666,6 +662,16 @@ this is a long comment
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="40" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="41" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/exception.yarnxml b/test_data/yarn_dia/expected/exception.yarnxml
index 54ad9f9..3d632d4 100644
--- a/test_data/yarn_dia/expected/exception.yarnxml
+++ b/test_data/yarn_dia/expected/exception.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>exception</simple>
 		<qualified>&lt;exception&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>exception</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;exception&gt;&lt;pkg&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
-		<count>3</count>
-		<bucket_count>5</bucket_count>
+	<objects class_id="30" tracking_level="0" version="0">
+		<count>1</count>
+		<bucket_count>2</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;exception&gt;&lt;a_class&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -220,14 +220,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -237,7 +237,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -256,7 +256,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -267,7 +267,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -299,15 +299,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -318,9 +314,14 @@
 				</hash_container_keys>
 			</second>
 		</item>
-		<item>
+	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>2</count>
+		<bucket_count>5</bucket_count>
+		<item_version>0</item_version>
+		<item class_id="38" tracking_level="0" version="0">
 			<first>&lt;exception&gt;&lt;pkg&gt;&lt;catastrophic_error&gt;</first>
-			<second object_id="_6">
+			<second class_id="5" tracking_level="1" version="0" object_id="_6">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -358,63 +359,6 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties>
-					<count>0</count>
-					<item_version>0</item_version>
-				</all_properties>
-				<local_properties>
-					<count>0</count>
-					<item_version>0</item_version>
-				</local_properties>
-				<inherited_properties>
-					<count>0</count>
-					<bucket_count>1</bucket_count>
-					<item_version>0</item_version>
-				</inherited_properties>
-				<is_immutable>0</is_immutable>
-				<is_fluent>0</is_fluent>
-				<is_parent>0</is_parent>
-				<is_child>0</is_child>
-				<is_final>1</is_final>
-				<root_parents>
-					<count>0</count>
-					<item_version>0</item_version>
-				</root_parents>
-				<parents>
-					<count>0</count>
-					<item_version>0</item_version>
-				</parents>
-				<leaves>
-					<count>0</count>
-					<item_version>0</item_version>
-				</leaves>
-				<regular_associations>
-					<count>0</count>
-					<item_version>0</item_version>
-				</regular_associations>
-				<weak_associations>
-					<count>0</count>
-					<item_version>0</item_version>
-				</weak_associations>
-				<is_visitable>0</is_visitable>
-				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>4</object_type>
-				<modeled_concepts>
-					<count>0</count>
-					<item_version>0</item_version>
-				</modeled_concepts>
-				<hash_container_keys>
-					<count>0</count>
-					<item_version>0</item_version>
-				</hash_container_keys>
 			</second>
 		</item>
 		<item>
@@ -457,66 +401,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties>
-					<count>0</count>
-					<item_version>0</item_version>
-				</all_properties>
-				<local_properties>
-					<count>0</count>
-					<item_version>0</item_version>
-				</local_properties>
-				<inherited_properties>
-					<count>0</count>
-					<bucket_count>1</bucket_count>
-					<item_version>0</item_version>
-				</inherited_properties>
-				<is_immutable>0</is_immutable>
-				<is_fluent>0</is_fluent>
-				<is_parent>0</is_parent>
-				<is_child>0</is_child>
-				<is_final>1</is_final>
-				<root_parents>
-					<count>0</count>
-					<item_version>0</item_version>
-				</root_parents>
-				<parents>
-					<count>0</count>
-					<item_version>0</item_version>
-				</parents>
-				<leaves>
-					<count>0</count>
-					<item_version>0</item_version>
-				</leaves>
-				<regular_associations>
-					<count>0</count>
-					<item_version>0</item_version>
-				</regular_associations>
-				<weak_associations>
-					<count>0</count>
-					<item_version>0</item_version>
-				</weak_associations>
-				<is_visitable>0</is_visitable>
-				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>4</object_type>
-				<modeled_concepts>
-					<count>0</count>
-					<item_version>0</item_version>
-				</modeled_concepts>
-				<hash_container_keys>
-					<count>0</count>
-					<item_version>0</item_version>
-				</hash_container_keys>
 			</second>
 		</item>
-	</objects>
+	</exceptions>
+	<visitors class_id="39" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/std_model.yarnxml b/test_data/yarn_dia/expected/std_model.yarnxml
index 5210ba8..bcebcd6 100644
--- a/test_data/yarn_dia/expected/std_model.yarnxml
+++ b/test_data/yarn_dia/expected/std_model.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>std_model</simple>
 		<qualified>&lt;std_model&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>std_model</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;std_model&gt;&lt;pkg1&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -93,12 +93,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -162,28 +162,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>13</count>
 		<bucket_count>23</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;std_model&gt;&lt;primitives&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_5">
+			<second class_id="7" tracking_level="1" version="0" object_id="_5">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -220,14 +220,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>8</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -237,7 +237,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -256,7 +256,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -540,7 +540,7 @@
 						<unparsed_type>std::uint64_t</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -572,15 +572,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -749,15 +745,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -886,15 +878,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1101,15 +1089,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1433,15 +1417,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1765,15 +1745,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1953,15 +1929,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2285,15 +2257,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2461,15 +2429,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2676,15 +2640,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2930,14 +2890,10 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
+				</visitable_by>
 				<object_type>1</object_type>
 				<modeled_concepts>
 					<count>0</count>
@@ -3145,15 +3101,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3301,15 +3253,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3321,6 +3269,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/trivial_inheritance.yarnxml b/test_data/yarn_dia/expected/trivial_inheritance.yarnxml
index 1af851d..d96db0f 100644
--- a/test_data/yarn_dia/expected/trivial_inheritance.yarnxml
+++ b/test_data/yarn_dia/expected/trivial_inheritance.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>trivial_inheritance</simple>
 		<qualified>&lt;trivial_inheritance&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>trivial_inheritance</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>5</count>
 		<bucket_count>11</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;trivial_inheritance&gt;&lt;pkg4&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -98,12 +98,12 @@ in the context of inheritance.
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_2">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -302,28 +302,28 @@ in the context of inheritance.
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>23</count>
 		<bucket_count>47</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;trivial_inheritance&gt;&lt;move_ctor_empty_descendant&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_8">
+			<second class_id="7" tracking_level="1" version="0" object_id="_8">
 				<element>
 					<documentation>Descendant class for scenario that tests code generated move contructors.
 </documentation>
@@ -361,7 +361,7 @@ in the context of inheritance.
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
@@ -369,7 +369,7 @@ in the context of inheritance.
 					<count>0</count>
 					<item_version>0</item_version>
 				</local_properties>
-				<inherited_properties class_id="31" tracking_level="0" version="0">
+				<inherited_properties class_id="33" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -420,15 +420,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -486,7 +482,7 @@ in the context of inheritance.
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="32" tracking_level="0" version="0">
+					<item class_id="34" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -496,7 +492,7 @@ in the context of inheritance.
 							</fields>
 						</extensions>
 						<name>prop_1</name>
-						<type class_id="33" tracking_level="0" version="0">
+						<type class_id="35" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -515,7 +511,7 @@ in the context of inheritance.
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="34" tracking_level="0" version="0">
+							<children class_id="36" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -578,15 +574,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -676,15 +668,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>1</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -814,15 +802,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -953,15 +937,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1051,15 +1031,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1189,15 +1165,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1306,15 +1278,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1462,15 +1430,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1599,15 +1563,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1757,15 +1717,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -1874,15 +1830,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2011,15 +1963,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2167,15 +2115,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2265,14 +2209,10 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
+				</visitable_by>
 				<object_type>1</object_type>
 				<modeled_concepts>
 					<count>0</count>
@@ -2421,15 +2361,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2578,15 +2514,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2676,14 +2608,10 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
+				</visitable_by>
 				<object_type>1</object_type>
 				<modeled_concepts>
 					<count>0</count>
@@ -2832,15 +2760,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -2949,15 +2873,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3066,15 +2986,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3222,15 +3138,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3380,15 +3292,11 @@ in the context of inheritance.
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visits>
-				<visited_by>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -3400,6 +3308,16 @@ in the context of inheritance.
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
diff --git a/test_data/yarn_dia/expected/two_layers_with_objects.yarnxml b/test_data/yarn_dia/expected/two_layers_with_objects.yarnxml
index 8bdc1da..afc3235 100644
--- a/test_data/yarn_dia/expected/two_layers_with_objects.yarnxml
+++ b/test_data/yarn_dia/expected/two_layers_with_objects.yarnxml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <!DOCTYPE boost_serialization>
 <boost_serialization signature="serialization::archive" version="13">
-<entity class_id="8" tracking_level="0" version="0">
-	<name class_id="9" tracking_level="0" version="0">
+<entity class_id="10" tracking_level="0" version="0">
+	<name class_id="11" tracking_level="0" version="0">
 		<simple>two_layers_with_objects</simple>
 		<qualified>&lt;two_layers_with_objects&gt;</qualified>
-		<location class_id="10" tracking_level="0" version="0">
-			<external_module_path class_id="11" tracking_level="0" version="0">
+		<location class_id="12" tracking_level="0" version="0">
+			<external_module_path class_id="13" tracking_level="0" version="0">
 				<count>0</count>
 				<item_version>0</item_version>
 			</external_module_path>
@@ -24,27 +24,27 @@
 	<origin_type>1</origin_type>
 	<original_model_name>two_layers_with_objects</original_model_name>
 	<generation_type>0</generation_type>
-	<references class_id="12" tracking_level="0" version="0">
+	<references class_id="14" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</references>
-	<leaves class_id="13" tracking_level="0" version="0">
+	<leaves class_id="15" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</leaves>
-	<modules class_id="14" tracking_level="0" version="0">
+	<modules class_id="16" tracking_level="0" version="0">
 		<count>3</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="15" tracking_level="0" version="0">
+		<item class_id="17" tracking_level="0" version="0">
 			<first>&lt;two_layers_with_objects&gt;&lt;Package_2&gt;</first>
-			<second class_id="5" tracking_level="1" version="0" object_id="_0">
-				<element class_id="16" tracking_level="0" version="0">
+			<second class_id="6" tracking_level="1" version="0" object_id="_0">
+				<element class_id="18" tracking_level="0" version="0">
 					<documentation></documentation>
-					<extensions class_id="17" tracking_level="0" version="0">
-						<fields class_id="18" tracking_level="0" version="0">
+					<extensions class_id="19" tracking_level="0" version="0">
+						<fields class_id="20" tracking_level="0" version="0">
 							<count>0</count>
 							<bucket_count>1</bucket_count>
 							<item_version>0</item_version>
@@ -72,12 +72,12 @@
 					<generation_type>1</generation_type>
 					<origin_type>1</origin_type>
 					<original_model_name></original_model_name>
-					<contained_by class_id="19" tracking_level="0" version="0">
+					<contained_by class_id="21" tracking_level="0" version="0">
 						<initialized>0</initialized>
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<members class_id="20" tracking_level="0" version="0">
+				<members class_id="22" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</members>
@@ -138,12 +138,12 @@
 							<count>3</count>
 							<bucket_count>5</bucket_count>
 							<item_version>0</item_version>
-							<item class_id="21" tracking_level="0" version="0">
+							<item class_id="23" tracking_level="0" version="0">
 								<first>dia.comment</first>
-								<second class_id="22" tracking_level="0" version="0">
-									<value class_id="23" tracking_level="0" version="1">
+								<second class_id="24" tracking_level="0" version="0">
+									<value class_id="25" tracking_level="0" version="1">
 										<px class_id="1" tracking_level="1" version="0" object_id="_3">
-											<value class_id="24" tracking_level="0" version="0"></value>
+											<value class_id="26" tracking_level="0" version="0"></value>
 											<content>true</content>
 										</px>
 									</value>
@@ -207,28 +207,28 @@
 			</second>
 		</item>
 	</modules>
-	<concepts class_id="25" tracking_level="0" version="0">
+	<concepts class_id="27" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</concepts>
-	<primitives class_id="26" tracking_level="0" version="0">
+	<primitives class_id="28" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</primitives>
-	<enumerations class_id="27" tracking_level="0" version="0">
+	<enumerations class_id="29" tracking_level="0" version="0">
 		<count>0</count>
 		<bucket_count>1</bucket_count>
 		<item_version>0</item_version>
 	</enumerations>
-	<objects class_id="28" tracking_level="0" version="0">
+	<objects class_id="30" tracking_level="0" version="0">
 		<count>2</count>
 		<bucket_count>5</bucket_count>
 		<item_version>0</item_version>
-		<item class_id="29" tracking_level="0" version="0">
+		<item class_id="31" tracking_level="0" version="0">
 			<first>&lt;two_layers_with_objects&gt;&lt;Package_2&gt;&lt;class_2&gt;</first>
-			<second class_id="6" tracking_level="1" version="0" object_id="_6">
+			<second class_id="7" tracking_level="1" version="0" object_id="_6">
 				<element>
 					<documentation></documentation>
 					<extensions>
@@ -266,14 +266,14 @@
 					</contained_by>
 					<in_global_module>0</in_global_module>
 				</element>
-				<all_properties class_id="30" tracking_level="0" version="0">
+				<all_properties class_id="32" tracking_level="0" version="0">
 					<count>0</count>
 					<item_version>0</item_version>
 				</all_properties>
 				<local_properties>
 					<count>1</count>
 					<item_version>0</item_version>
-					<item class_id="31" tracking_level="0" version="0">
+					<item class_id="33" tracking_level="0" version="0">
 						<documentation></documentation>
 						<extensions>
 							<fields>
@@ -283,7 +283,7 @@
 							</fields>
 						</extensions>
 						<name>prop_0</name>
-						<type class_id="32" tracking_level="0" version="0">
+						<type class_id="34" tracking_level="0" version="0">
 							<type>
 								<simple></simple>
 								<qualified></qualified>
@@ -302,7 +302,7 @@
 									</internal_module_path>
 								</location>
 							</type>
-							<children class_id="33" tracking_level="0" version="0">
+							<children class_id="35" tracking_level="0" version="0">
 								<count>0</count>
 								<item_version>0</item_version>
 							</children>
@@ -313,7 +313,7 @@
 						<unparsed_type>int</unparsed_type>
 					</item>
 				</local_properties>
-				<inherited_properties class_id="34" tracking_level="0" version="0">
+				<inherited_properties class_id="36" tracking_level="0" version="0">
 					<count>0</count>
 					<bucket_count>1</bucket_count>
 					<item_version>0</item_version>
@@ -345,15 +345,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -483,15 +479,11 @@
 				</weak_associations>
 				<is_visitable>0</is_visitable>
 				<is_root_parent_visitable>0</is_root_parent_visitable>
-				<visits>
+				<visitable_by>
 					<count>0</count>
 					<item_version>0</item_version>
-				</visits>
-				<visited_by>
-					<count>0</count>
-					<item_version>0</item_version>
-				</visited_by>
-				<object_type>3</object_type>
+				</visitable_by>
+				<object_type>2</object_type>
 				<modeled_concepts>
 					<count>0</count>
 					<item_version>0</item_version>
@@ -503,6 +495,16 @@
 			</second>
 		</item>
 	</objects>
+	<exceptions class_id="37" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</exceptions>
+	<visitors class_id="38" tracking_level="0" version="0">
+		<count>0</count>
+		<bucket_count>1</bucket_count>
+		<item_version>0</item_version>
+	</visitors>
 	<is_target>1</is_target>
 	<has_generatable_types>0</has_generatable_types>
 </entity>
